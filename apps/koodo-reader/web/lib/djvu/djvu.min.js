var DjVu=function(){"use strict";function t(){var e={VERSION:"0.5.3",IS_DEBUG:!1,setDebugMode:t=>e.IS_DEBUG=t};const i=self.TextDecoder?new self.TextDecoder:{decode(t){const e=function(t){var e,i,r=[];e=0;for(;e<t.length;)switch((i=t[e++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r.push(i);break;case 12:case 13:r.push((31&i)<<6|63&t[e++]);break;case 14:r.push((15&i)<<12|(63&t[e++])<<6|63&t[e++]);break;case 15:r.push((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])}return r.map(t=>t>1114111?120:t)}(t);return String.fromCodePoint(...e)}};function r(t){return i.decode(t)}const n=65536,s=20971520/n;class a{constructor(t=0){this.memory=new WebAssembly.Memory({initial:Math.ceil(t/n),maximum:65536}),this.assignBufferFromMemory(),this.offset=0,this.offsetMarks={}}assignBufferFromMemory(){this.buffer=this.memory.buffer,this.viewer=new DataView(this.buffer)}reset(){this.offset=0,this.offsetMarks={}}saveOffsetMark(t){return this.offsetMarks[t]=this.offset,this}writeByte(t){return this.checkOffset(1),this.viewer.setUint8(this.offset++,t),this}writeStr(t){var e,i;return this.writeArray((e=function(t){for(var e=[],i=0;i<t.length;i++){var r=t.codePointAt(i);e.push(r),r>65535&&i++}return e}(t),i=[],e.forEach(t=>{t<128?i.push(t):t<2048?(i.push(192|t>>6),i.push(128|63&t)):t<65536?(i.push(224|t>>12),i.push(128|t>>6&63),i.push(128|63&t)):(i.push(240|t>>18),i.push(128|t>>12&63),i.push(128|t>>6&63),i.push(128|63&t))}),new Uint8Array(i))),this}writeInt32(t){return this.checkOffset(4),this.viewer.setInt32(this.offset,t),this.offset+=4,this}rewriteInt32(t,e){var i=t;"string"==typeof i&&(i=this.offsetMarks[t],this.offsetMarks[t]+=4),this.viewer.setInt32(i,e)}rewriteSize(t){if(!this.offsetMarks[t])throw new Error("Unexisting offset mark");var e=this.offsetMarks[t];this.viewer.setInt32(e,this.offset-e-4)}getBuffer(){return this.offset===this.buffer.byteLength?this.buffer:this.buffer.slice(0,this.offset)}checkOffset(t=0){const e=this.offset+t>this.buffer.byteLength;return e&&this._expand(t),e}_expand(t){this.memory.grow(Math.max(Math.ceil(t/n),Math.min(this.memory.buffer.byteLength/n,s))),this.assignBufferFromMemory()}jump(t){return(t=+t)>0&&this.checkOffset(t),this.offset+=t,this}writeByteStream(t){this.writeArray(t.toUint8Array())}writeArray(t){for(;this.checkOffset(t.length););new Uint8Array(this.buffer).set(t,this.offset),this.offset+=t.length}writeBuffer(t){this.writeArray(new Uint8Array(t))}writeStrNT(t){this.writeStr(t),this.writeByte(0)}writeInt16(t){return this.checkOffset(2),this.viewer.setInt16(this.offset,t),this.offset+=2,this}writeUint16(t){return this.checkOffset(2),this.viewer.setUint16(this.offset,t),this.offset+=2,this}writeInt24(t){return this.writeByte(t>>16&255).writeByte(t>>8&255).writeByte(255&t),this}}class o{constructor(t){this.bsw=t||new a,this.a=0,this.scount=0,this.byte=0,this.delay=25,this.subend=0,this.buffer=16777215,this.nrun=0}outbit(t){this.delay>0?this.delay<255&&(this.delay-=1):(this.byte=this.byte<<1|t,8==++this.scount&&(this.bsw.writeByte(this.byte),this.scount=0,this.byte=0))}zemit(t){switch(this.buffer=(this.buffer<<1)+t,t=this.buffer>>24,this.buffer=16777215&this.buffer,t){case 1:for(this.outbit(1);this.nrun-- >0;)this.outbit(0);this.nrun=0;break;case 255:for(this.outbit(0);this.nrun-- >0;)this.outbit(1);this.nrun=0;break;case 0:this.nrun+=1;break;default:throw new Exception("ZPEncoder::zemit() error!")}}encode(t,e,i){if(t=+t,!e)return this._ptencode(t,32768+(this.a>>1));var r=this.a+this.p[e[i]];if(t!=(1&e[i])){r>(n=24576+(r+this.a>>2))&&(r=n),e[i]=this.dn[e[i]],r=65536-r,this.subend+=r,this.a+=r}else{if(!(r>=32768))return void(this.a=r);var n;r>(n=24576+(r+this.a>>2))&&(r=n),this.a>=this.m[e[i]]&&(e[i]=this.up[e[i]]),this.a=r}for(;this.a>=32768;)this.zemit(1-(this.subend>>15)),this.subend=65535&this.subend<<1,this.a=65535&this.a<<1}IWencode(t){this._ptencode(t,32768+(this.a+this.a+this.a>>3))}_ptencode(t,e){for(t?(e=65536-e,this.subend+=e,this.a+=e):this.a=e;this.a>=32768;)this.zemit(1-(this.subend>>15)),this.subend=65535&this.subend<<1,this.a=65535&this.a<<1}eflush(){for(this.subend>32768?this.subend=65536:this.subend>0&&(this.subend=32768);16777215!=this.buffer||this.subend;)this.zemit(1-(this.subend>>15)),this.subend=65535&this.subend<<1;for(this.outbit(1);this.nrun-- >0;)this.outbit(0);for(this.nrun=0;this.scount>0;)this.outbit(1);this.delay=255}}class h{constructor(t){this.bs=t,this.a=0,this.c=this.bs.byte(),this.c<<=8;var e=this.bs.byte();this.c|=e,this.z=0,this.d=0,this.f=Math.min(this.c,32767),this.ffzt=new Int8Array(256);for(var i=0;i<256;i++){this.ffzt[i]=0;for(var r=i;128&r;r<<=1)this.ffzt[i]+=1}this.delay=25,this.scount=0,this.buffer=0,this.preload()}preload(){for(;this.scount<=24;){var t=this.bs.byte();this.buffer=this.buffer<<8|t,this.scount+=8}}ffz(t){return t>=65280?this.ffzt[255&t]+8:this.ffzt[t>>8&255]}decode(t,e){if(!t)return this._ptdecode(32768+(this.a>>1));if(this.b=1&t[e],this.z=this.a+this.p[t[e]],this.z<=this.f)return this.a=this.z,this.b;if(this.d=24576+(this.a+this.z>>2),this.z>this.d&&(this.z=this.d),this.z>this.c){this.b=1-this.b,this.z=65536-this.z,this.a+=this.z,this.c+=this.z,t[e]=this.dn[t[e]];var i=this.ffz(this.a);this.scount-=i,this.a=65535&this.a<<i,this.c=65535&(this.c<<i|this.buffer>>this.scount&(1<<i)-1)}else this.a>=this.m[t[e]]&&(t[e]=this.up[t[e]]),this.scount--,this.a=65535&this.z<<1,this.c=65535&(this.c<<1|this.buffer>>this.scount&1);return this.scount<16&&this.preload(),this.f=Math.min(this.c,32767),this.b}IWdecode(){return this._ptdecode(32768+(this.a+this.a+this.a>>3))}_ptdecode(t){if(this.b=0,t>this.c){this.b=1,t=65536-t,this.a+=t,this.c+=t;var e=this.ffz(this.a);this.scount-=e,this.a=65535&this.a<<e,this.c=65535&(this.c<<e|this.buffer>>this.scount&(1<<e)-1)}else this.b=0,this.scount--,this.a=65535&t<<1,this.c=65535&(this.c<<1|this.buffer>>this.scount&1);return this.scount<16&&this.preload(),this.f=Math.min(this.c,32767),this.b}}o.prototype.p=h.prototype.p=Uint16Array.of(32768,32768,32768,27581,27581,23877,23877,20921,20921,18451,18451,16341,16341,14513,14513,12917,12917,11517,11517,10277,10277,9131,9131,8071,8071,7099,7099,6213,6213,5411,5411,4691,4691,4047,4047,3477,3477,2973,2973,2531,2531,2145,2145,1809,1809,1521,1521,1273,1273,1061,1061,881,881,729,729,601,601,493,493,403,403,329,329,267,267,213,213,165,165,123,123,87,87,59,59,35,35,19,19,7,7,1,1,22165,9454,32768,3376,18458,1153,13689,378,9455,123,6520,40,4298,13,2909,52,1930,160,1295,279,856,490,564,324,371,564,245,851,161,1477,282,975,426,645,646,427,979,282,1477,186,2221,122,3276,491,4866,742,7041,1118,9455,1680,10341,2526,14727,3528,11417,4298,15199,2909,22165,1930,32768,1295,9454,856,3376,564,1153,371,378,245,123,161,40,282,13,426,52,646,160,979,279,1477,490,2221,324,3276,564,4866,851,7041,1477,9455,975,11124,645,8221,427,5909,282,4023,186,2663,491,1767,742,1174,1118,781,1680,518,2526,341,3528,225,11124,148,8221,392,5909,594,4023,899,2663,1351,1767,2018,1174,3008,781,4472,518,6618,341,9455,225,12814,148,17194,392,17533,594,24270,899,32768,1351,18458,2018,13689,3008,9455,4472,6520,6618,10341,9455,14727,12814,11417,17194,15199,17533,22165,24270,32768,32768,22165,18458,18458),o.prototype.m=h.prototype.m=Uint16Array.of(0,0,0,4261,4261,7976,7976,11219,11219,14051,14051,16524,16524,18685,18685,20573,20573,22224,22224,23665,23665,24923,24923,26021,26021,26978,26978,27810,27810,28532,28532,29158,29158,29700,29700,30166,30166,30568,30568,30914,30914,31210,31210,31463,31463,31678,31678,31861,31861,32015,32015,32145,32145,32254,32254,32346,32346,32422,32422,32486,32486,32538,32538,32581,32581,32619,32619,32653,32653,32682,32682,32707,32707,32727,32727,32743,32743,32754,32754,32762,32762,32767,32767,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),o.prototype.up=h.prototype.up=Uint8Array.of(84,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,81,82,9,86,5,88,89,90,91,92,93,94,95,96,97,82,99,76,101,70,103,66,105,106,107,66,109,60,111,56,69,114,65,116,61,118,57,120,53,122,49,124,43,72,39,60,33,56,29,52,23,48,23,42,137,38,21,140,15,142,9,144,141,146,147,148,149,150,151,152,153,154,155,70,157,66,81,62,75,58,69,54,65,50,167,44,65,40,59,34,55,30,175,24,177,178,179,180,181,182,183,184,69,186,59,188,55,190,51,192,47,194,41,196,37,198,199,72,201,62,203,58,205,54,207,50,209,46,211,40,213,36,215,30,217,26,219,20,71,14,61,14,57,8,53,228,49,230,45,232,39,234,35,138,29,24,25,240,19,22,13,16,13,10,7,244,249,10,89,230),o.prototype.dn=h.prototype.dn=Uint8Array.of(145,4,3,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,85,226,6,176,143,138,141,112,135,104,133,100,129,98,127,72,125,102,123,60,121,110,119,108,117,54,115,48,113,134,59,132,55,130,51,128,47,126,41,62,37,66,31,54,25,50,131,46,17,40,15,136,7,32,139,172,9,170,85,168,248,166,247,164,197,162,95,160,173,158,165,156,161,60,159,56,71,52,163,48,59,42,171,38,169,32,53,26,47,174,193,18,191,222,189,218,187,216,185,214,61,212,53,210,49,208,45,206,39,204,195,202,31,200,243,64,239,56,237,52,235,48,233,44,231,38,229,34,227,28,225,22,223,16,221,220,63,8,55,224,51,2,47,87,43,246,37,244,33,238,27,236,21,16,15,8,241,242,7,10,245,2,1,83,250,2,143,246);class f{constructor(t,e){var i=Math.ceil(t*e/8);this.height=e,this.width=t,this.innerArray=new Uint8Array(i)}getBits(t,e,i){if(!this.hasRow(t)||e>=this.width)return 0;e<0&&(i+=e,e=0);for(var r=t*this.width+e,n=r>>3,s=7&r,a=32768>>>s,o=this.innerArray[n]<<8|(this.innerArray[n+1]||0),h=this.width-e,f=i<h?i:h,l=1;l<f;l++)a|=32768>>>s+l;return(o&a)>>>16-s-i}get(t,e){if(!this.hasRow(t)||e<0||e>=this.width)return 0;var i=t*this.width+e,r=i>>3,n=128>>(7&i);return this.innerArray[r]&n?1:0}set(t,e){var i=t*this.width+e,r=i>>3,n=128>>(7&i);this.innerArray[r]|=n}hasRow(t){return t>=0&&t<this.height}removeEmptyEdges(){var t=0,e=0,i=0,r=0;t:for(var n=0;n<this.height;n++){for(var s=0;s<this.width;s++)if(this.get(n,s))break t;t++}t:for(n=this.height-1;n>=0;n--){for(s=0;s<this.width;s++)if(this.get(n,s))break t;e++}t:for(s=0;s<this.width;s++){for(n=0;n<this.height;n++)if(this.get(n,s))break t;i++}t:for(s=this.width-1;s>=0;s--){for(n=0;n<this.height;n++)if(this.get(n,s))break t;r++}if(e||t||i||r){for(var a=this.width-i-r,o=this.height-e-t,h=new f(a,o),l=(n=t,0);l<o;l++,n++){s=i;for(var u=0;u<a;u++,s++)this.get(n,s)&&h.set(l,u)}return h}return this}}class l{constructor(){this.ctx=[0],this._left=null,this._right=null}get left(){return this._left||(this._left=new l),this._left}get right(){return this._right||(this._right=new l),this._right}}class u{constructor(){this.arr=new Array(3),this.fill(0),this.index=-1}add(t){3==++this.index&&(this.index=0),this.arr[this.index]=t}getVal(){return this.arr[0]>=this.arr[1]&&this.arr[0]<=this.arr[2]||this.arr[0]<=this.arr[1]&&this.arr[0]>=this.arr[2]?this.arr[0]:this.arr[1]>=this.arr[0]&&this.arr[1]<=this.arr[2]||this.arr[1]<=this.arr[0]&&this.arr[1]>=this.arr[2]?this.arr[1]:this.arr[2]}fill(t){this.arr[0]=this.arr[1]=this.arr[2]=t}}class c{constructor(t,e,i=null){this.code=t,this.message=e,i&&(this.additionalData=i)}}class d extends c{constructor(){super(k.INCORRECT_FILE_FORMAT,"The provided file is not a .djvu file!")}}class p extends c{constructor(t){super(k.NO_SUCH_PAGE,"There is no page with the number "+t+" !"),this.pageNumber=t}}class g extends c{constructor(t="",e=null){super(k.FILE_IS_CORRUPTED,"The file is corrupted! "+t,e)}}class m extends c{constructor(t){super(k.DATA_CANNOT_BE_TRANSFERRED,"The data cannot be transferred from the worker to the main page! Perhaps, you requested a complex object like DjVuPage, but only simple objects can be transferred between workers."),this.tasks=t}}class b extends c{constructor(t){super(k.INCORRECT_TASK,"The task contains an incorrect sequence of functions!"),this.task=t}}class _ extends c{constructor(){super(k.NO_BASE_URL,"The base URL is required for the indirect djvu to load components, but no base URL was provided to the document constructor!")}}function w(t){var e="";return t.pageNumber?e=t.dependencyId?`A dependency ${t.dependencyId} for the page number ${t.pageNumber} can't be loaded!\n`:`The page number ${t.pageNumber} can't be loaded!`:t.dependencyId&&(e=`A dependency ${t.dependencyId} can't be loaded!\n`),e}class y extends c{constructor(t,e={pageNumber:null,dependencyId:null}){var i=w(e);super(k.UNSUCCESSFUL_REQUEST,i+"\n"+`The request to ${t.responseURL} wasn't successful.\n`+`The response status is ${t.status}.\n`+`The response status text is: "${t.statusText}".`),this.status=t.status,this.statusText=t.statusText,this.url=t.responseURL,e.pageNumber&&(this.pageNumber=e.pageNumber),e.dependencyId&&(this.dependencyId=e.dependencyId)}}class v extends c{constructor(t={pageNumber:null,dependencyId:null,url:null}){super(k.NETWORK_ERROR,w(t)+"\nA network error occurred! Check your network connection!"),t.pageNumber&&(this.pageNumber=t.pageNumber),t.dependencyId&&(this.dependencyId=t.dependencyId),t.url&&(this.url=t.url)}}const k=Object.freeze({FILE_IS_CORRUPTED:"FILE_IS_CORRUPTED",INCORRECT_FILE_FORMAT:"INCORRECT_FILE_FORMAT",NO_SUCH_PAGE:"NO_SUCH_PAGE",UNEXPECTED_ERROR:"UNEXPECTED_ERROR",DATA_CANNOT_BE_TRANSFERRED:"DATA_CANNOT_BE_TRANSFERRED",INCORRECT_TASK:"INCORRECT_TASK",NO_BASE_URL:"NO_BASE_URL",NETWORK_ERROR:"NETWORK_ERROR",UNSUCCESSFUL_REQUEST:"UNSUCCESSFUL_REQUEST"});class E{constructor(t){this.id=t.readStr4(),this.length=t.getInt32(),this.bs=t}toString(){return this.id+" "+this.length+"\n"}}class x extends E{constructor(t){super(t),this.id+=":"+t.readStr4()}toString(t=""){return super.toString()+"    "+t.replace(/\n/g,"\n    ")+"\n"}}class I extends E{constructor(t){super(t),this.header=new S(t)}toString(){return this.id+" "+this.length+this.header.toString()}}class C extends E{constructor(t){if(super(t),this.length<5)throw new g("The INFO chunk is shorter than 5 bytes!");this.width=t.getInt16(),this.height=t.getInt16(),this.minver=t.getInt8(),this.majver=this.length>5?t.getInt8():0,this.length>7?(this.dpi=t.getUint8(),this.dpi|=t.getUint8()<<8):this.dpi=300,this.gamma=this.length>8?t.getInt8():22,this.flags=this.length>9?t.getInt8():0,(this.dpi<25||this.dpi>6e3)&&(this.dpi=300),this.gamma<3&&(this.gamma=3),this.gamma>50&&(this.gamma=50)}toString(){var t=super.toString();return t+="{width:"+this.width+", height:"+this.height+", minver:"+this.minver+", majver:"+this.majver+", dpi:"+this.dpi+", gamma:"+this.gamma+", flags:"+this.flags+"}\n"}}class S{constructor(t){if(this.serial=t.getUint8(),this.slices=t.getUint8(),!this.serial){this.majver=t.getUint8(),this.grayscale=this.majver>>7,this.minver=t.getUint8(),this.width=t.getUint16(),this.height=t.getUint16();var e=t.getUint8();this.delayInit=127&e,128&!e&&console.warn("Old image reconstruction should be applied!")}}toString(){return"\n"+JSON.stringify(this)+"\n"}}class A extends E{constructor(t){super(t),this.ref=this.bs.readStrUTF()}toString(){var t=super.toString();return t+="{Reference: "+this.ref+"}\n"}}class T extends A{}class B{constructor(t,e){this.id=t,this.e=e}toString(){return`Error creating ${this.id}: ${this.e.toString()}\n`}}class R extends E{constructor(t){super(t),this.zp=new h(this.bs),this.directBitmapCtx=new Uint8Array(1024),this.refinementBitmapCtx=new Uint8Array(2048),this.offsetTypeCtx=[0],this.resetNumContexts()}resetNumContexts(){this.recordTypeCtx=new l,this.imageSizeCtx=new l,this.symbolWidthCtx=new l,this.symbolHeightCtx=new l,this.inheritDictSizeCtx=new l,this.hoffCtx=new l,this.voffCtx=new l,this.shoffCtx=new l,this.svoffCtx=new l,this.symbolIndexCtx=new l,this.symbolHeightDiffCtx=new l,this.symbolWidthDiffCtx=new l,this.commentLengthCtx=new l,this.commentOctetCtx=new l,this.horizontalAbsLocationCtx=new l,this.verticalAbsLocationCtx=new l}decodeNum(t,e,i){var r,n=!1;r=0;for(var s=1,a=4294967295;1!=a;){var o=t>=r||e>=r&&this.zp.decode(i.ctx,0);switch(i=o?i.right:i.left,s){case 1:if(n=!o){var h=-t-1;t=-e-1,e=h}s=2,r=1;break;case 2:o?r+=r+1:(s=3,1==(a=(r+1)/2)?r=0:r-=a/2);break;case 3:1!=(a/=2)?o?r+=a/2:r-=a/2:o||r--}}return n?-r-1:r}decodeBitmap(t,e){for(var i=new f(t,e),r=e-1;r>=0;r--)for(var n=0;n<t;n++){var s=this.getCtxIndex(i,r,n);this.zp.decode(this.directBitmapCtx,s)&&i.set(r,n)}return i}getCtxIndex(t,e,i){var r=0,n=e+2;return t.hasRow(n)&&(r=t.getBits(n,i-1,3)<<7),n--,t.hasRow(n)&&(r|=t.getBits(n,i-2,5)<<2),r|=t.getBits(e,i-2,2)}decodeBitmapRef(t,e,i){for(var r=new f(t,e),n=this.alignBitmaps(r,i),s=e-1;s>=0;s--)for(var a=0;a<t;a++)this.zp.decode(this.refinementBitmapCtx,this.getCtxIndexRef(r,i,n,s,a))&&r.set(s,a);return r}getCtxIndexRef(t,e,i,r,n){var s=0,a=r+1;t.hasRow(a)&&(s=t.getBits(a,n-1,3)<<8),s|=t.get(r,n-1)<<7,a=r+i.rowshift+1;var o=n+i.colshift;return s|=e.hasRow(a)?e.get(a,o)<<6:0,a--,e.hasRow(a)&&(s|=e.getBits(a,o-1,3)<<3),a--,e.hasRow(a)&&(s|=e.getBits(a,o-1,3)),s}alignBitmaps(t,e){var i,r,n=t.width-1;return i=t.height-1>>1,r=n>>1,{rowshift:(e.height-1>>1)-i,colshift:(e.width-1>>1)-r}}decodeComment(){for(var t=this.decodeNum(0,262142,this.commentLengthCtx),e=new Uint8Array(t),i=0;i<t;e[i++]=this.decodeNum(0,255,this.commentOctetCtx));return e}drawBitmap(t){for(var e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height),i=0;i<t.height;i++)for(var r=0;r<t.width;r++){var n=t.get(i,r)?0:255,s=4*((t.height-i-1)*t.width+r);e.data[s]=n,e.data[s+1]=n,e.data[s+2]=n,e.data[s+3]=255}Globals.drawImage(e)}}class L extends R{constructor(t){super(t),this.dict=[],this.isDecoded=!1}decode(t){if(!this.isDecoded){var e,i,r,n,s,a,o=this.decodeNum(0,11,this.recordTypeCtx);if(9==o){var h=this.decodeNum(0,262142,this.inheritDictSizeCtx);t.decode(),this.dict=t.dict.slice(0,h),o=this.decodeNum(0,11,this.recordTypeCtx)}if(this.decodeNum(0,262142,this.imageSizeCtx),this.decodeNum(0,262142,this.imageSizeCtx),this.zp.decode([0],0))throw new Error("Bad flag!!!");for(o=this.decodeNum(0,11,this.recordTypeCtx);11!==o;){switch(o){case 2:e=this.decodeNum(0,262142,this.symbolWidthCtx),s=this.decodeNum(0,262142,this.symbolHeightCtx),a=this.decodeBitmap(e,s),this.dict.push(a);break;case 5:n=this.decodeNum(0,this.dict.length-1,this.symbolIndexCtx),i=this.decodeNum(-262143,262142,this.symbolWidthDiffCtx),r=this.decodeNum(-262143,262142,this.symbolHeightDiffCtx);var f=this.dict[n],l=this.decodeBitmapRef(f.width+i,r+f.height,f);this.dict.push(l.removeEmptyEdges());break;case 9:console.log("RESET DICT"),this.resetNumContexts();break;case 10:this.decodeComment();break;default:throw new Error("Unsupported type in JB2Dict: "+o)}if((o=this.decodeNum(0,11,this.recordTypeCtx))>11){console.error("TYPE ERROR "+o);break}}this.isDecoded=!0}}}class D extends E{}class z extends x{constructor(t){super(t),this.innerChunk=null,this.init()}init(){for(;!this.bs.isEmpty();){var t=this.bs.readStr4(),e=this.bs.getInt32();this.bs.jump(-8);var i=this.bs.fork(e+8);switch(this.bs.jump(8+e+(1&e?1:0)),t){case"Djbz":this.innerChunk=new L(i);break;case"ANTa":case"ANTz":this.innerChunk=new D(i);break;default:this.innerChunk=new E(i),console.error("Unsupported chunk inside the DJVI chunk: ",t)}}}toString(){return super.toString(this.innerChunk.toString())}}class O extends R{constructor(t){super(t),this.dict=[],this.initialDictLength=0,this.blitList=[],this.init()}addBlit(t,e,i){this.blitList.push({bitmap:t,x:e,y:i})}init(){var t=this.decodeNum(0,11,this.recordTypeCtx);if(9==t&&(this.initialDictLength=this.decodeNum(0,262142,this.inheritDictSizeCtx),t=this.decodeNum(0,11,this.recordTypeCtx)),this.width=this.decodeNum(0,262142,this.imageSizeCtx)||200,this.height=this.decodeNum(0,262142,this.imageSizeCtx)||200,this.bitmap=!1,this.lastLeft=0,this.lastBottom=this.height-1,this.firstLeft=-1,this.firstBottom=this.height-1,this.zp.decode([0],0))throw new Error("Bad flag!!!");this.baseline=new u}toString(){var t=super.toString();return t+="{width: "+this.width+", height: "+this.height+"}\n"}decode(t){this.initialDictLength&&(t.decode(),this.dict=t.dict.slice(0,this.initialDictLength));for(var e,i,r,n,s=this.decodeNum(0,11,this.recordTypeCtx);11!==s;){switch(s){case 1:e=this.decodeNum(0,262142,this.symbolWidthCtx),i=this.decodeNum(0,262142,this.symbolHeightCtx),n=this.decodeBitmap(e,i);var a=this.decodeSymbolCoords(n.width,n.height);this.addBlit(n,a.x,a.y),this.dict.push(n.removeEmptyEdges());break;case 2:e=this.decodeNum(0,262142,this.symbolWidthCtx),i=this.decodeNum(0,262142,this.symbolHeightCtx),n=this.decodeBitmap(e,i),this.dict.push(n.removeEmptyEdges());break;case 3:e=this.decodeNum(0,262142,this.symbolWidthCtx),i=this.decodeNum(0,262142,this.symbolHeightCtx),n=this.decodeBitmap(e,i);a=this.decodeSymbolCoords(n.width,n.height);this.addBlit(n,a.x,a.y);break;case 4:r=this.decodeNum(0,this.dict.length-1,this.symbolIndexCtx);var o=this.decodeNum(-262143,262142,this.symbolWidthDiffCtx),h=this.decodeNum(-262143,262142,this.symbolHeightDiffCtx),f=this.dict[r],l=this.decodeBitmapRef(f.width+o,h+f.height,f);a=this.decodeSymbolCoords(l.width,l.height);this.addBlit(l,a.x,a.y),this.dict.push(l.removeEmptyEdges());break;case 5:r=this.decodeNum(0,this.dict.length-1,this.symbolIndexCtx),o=this.decodeNum(-262143,262142,this.symbolWidthDiffCtx),h=this.decodeNum(-262143,262142,this.symbolHeightDiffCtx);f=this.dict[r],l=this.decodeBitmapRef(f.width+o,h+f.height,f);this.dict.push(l.removeEmptyEdges());break;case 6:r=this.decodeNum(0,this.dict.length-1,this.symbolIndexCtx);o=this.decodeNum(-262143,262142,this.symbolWidthDiffCtx),h=this.decodeNum(-262143,262142,this.symbolHeightDiffCtx),f=this.dict[r],l=this.decodeBitmapRef(f.width+o,h+f.height,f),a=this.decodeSymbolCoords(l.width,l.height);this.addBlit(l,a.x,a.y);break;case 7:r=this.decodeNum(0,this.dict.length-1,this.symbolIndexCtx),n=this.dict[r];a=this.decodeSymbolCoords(n.width,n.height);this.addBlit(n,a.x,a.y);break;case 8:e=this.decodeNum(0,262142,this.symbolWidthCtx),i=this.decodeNum(0,262142,this.symbolHeightCtx),n=this.decodeBitmap(e,i);a=this.decodeAbsoluteLocationCoords(n.width,n.height);this.addBlit(n,a.x,a.y);break;case 9:console.log("RESET NUM CONTEXTS"),this.resetNumContexts();break;case 10:this.decodeComment();break;default:throw new Error("Unsupported type in JB2Image: "+s)}if((s=this.decodeNum(0,11,this.recordTypeCtx))>11){console.error("TYPE ERROR "+s);break}}}decodeAbsoluteLocationCoords(t,e){return{x:this.decodeNum(1,this.width,this.horizontalAbsLocationCtx),y:this.decodeNum(1,this.height,this.verticalAbsLocationCtx)-e}}decodeSymbolCoords(t,e){var i,r,n=this.zp.decode(this.offsetTypeCtx,0),s=n?this.hoffCtx:this.shoffCtx,a=n?this.voffCtx:this.svoffCtx,o=this.decodeNum(-262143,262142,s),h=this.decodeNum(-262143,262142,a);return n?(i=this.firstLeft+o,r=this.firstBottom+h-e+1,this.firstLeft=i,this.firstBottom=r,this.baseline.fill(r)):(i=this.lastRight+o,r=this.baseline.getVal()+h),this.baseline.add(r),this.lastRight=i+t-1,{x:i,y:r}}copyToBitmap(t,e,i){this.bitmap||(this.bitmap=new f(this.width,this.height));for(var r=i,n=0;n<t.height;n++,r++)for(var s=e,a=0;a<t.width;a++,s++)t.get(n,a)&&this.bitmap.set(r,s)}getBitmap(){return this.bitmap||this.blitList.forEach(t=>this.copyToBitmap(t.bitmap,t.x,t.y)),this.bitmap}getMaskImage(){var t=new ImageData(this.width,this.height),i=t.data,r=performance.now();i.fill(255);for(var n=0;n<this.blitList.length;n++)for(var s=this.blitList[n],a=s.bitmap,o=s.y,h=0;h<a.height;h++,o++)for(var f=s.x,l=0;l<a.width;l++,f++){if(a.get(h,l))i[4*((this.height-o-1)*this.width+f)]=0}return e.IS_DEBUG&&console.log("JB2Image mask image creating time = ",performance.now()-r),t}getImage(t=null,i=!1){t&&t.getDataSize()!==this.blitList.length&&(t=null);var r=new Uint8ClampedArray(this.width*this.height*4),n=performance.now();r.fill(255);for(var s={r:0,g:0,b:0},a=i?0:255,o=0;o<this.blitList.length;o++)for(var h=this.blitList[o],f=t?t.getPixelByBlitIndex(o):s,l=h.bitmap,u=h.y,c=0;c<l.height;c++,u++)for(var d=h.x,p=0;p<l.width;p++,d++)if(l.get(c,p)){var g=(this.height-u-1)*this.width+d<<2;r[g]=f.r,r[1|g]=f.g,r[2|g]=f.b,r[3|g]=a}return e.IS_DEBUG&&console.log("JB2Image creating time = ",performance.now()-n),new ImageData(r,this.width,this.height)}getImageFromBitmap(){this.getBitmap();for(var t=performance.now(),i=new ImageData(this.width,this.height),r=0;r<this.height;r++)for(var n=0;n<this.width;n++){var s=this.bitmap.get(r,n)?0:255,a=4*((this.height-r-1)*this.width+n);i.data[a]=s,i.data[a+1]=s,i.data[a+2]=s,i.data[a+3]=255}return e.IS_DEBUG&&console.log("JB2Image creating time = ",performance.now()-t),i}}class U{constructor(t,e,i){this._buffer=t,this.offsetx=e||0,this.offset=0,this._length=i||t.byteLength,this._length+e>t.byteLength&&(this._length=t.byteLength-e,console.error("Incorrect length in ByteStream!")),this.viewer=new DataView(this._buffer,this.offsetx,this._length)}get length(){return this._length}get buffer(){return this._buffer}getUint8Array(t=this.remainingLength()){var e=this.offset;return this.offset+=t,new Uint8Array(this._buffer,this.offsetx+e,t)}toUint8Array(){return new Uint8Array(this._buffer,this.offsetx,this._length)}remainingLength(){return this._length-this.offset}reset(){this.offset=0}byte(){return this.offset>=this._length?(this.offset++,255):this.viewer.getUint8(this.offset++)}getInt8(){return this.viewer.getInt8(this.offset++)}getInt16(){var t=this.viewer.getInt16(this.offset);return this.offset+=2,t}getUint16(){var t=this.viewer.getUint16(this.offset);return this.offset+=2,t}getInt32(){var t=this.viewer.getInt32(this.offset);return this.offset+=4,t}getUint8(){return this.viewer.getUint8(this.offset++)}getInt24(){var t=this.getUint24();return 8388608&t?-1*(16777215-val+1):t}getUint24(){return this.byte()<<16|this.byte()<<8|this.byte()}jump(t){return this.offset+=t,this}setOffset(t){this.offset=t}readStr4(){return String.fromCharCode(...this.getUint8Array(4))}readStrNT(){for(var t=[],e=this.getUint8();e;)t.push(e),e=this.getUint8();return r(new Uint8Array(t))}readStrUTF(t){return r(this.getUint8Array(t))}fork(t=this.remainingLength()){return new U(this._buffer,this.offsetx+this.offset,t)}clone(){return new U(this._buffer,this.offsetx,this._length)}isEmpty(){return this.offset>=this._length}}class N{constructor(t){this.zp=t,this.maxblock=4096,this.FREQMAX=4,this.CTXIDS=3,this.ctx=new Uint8Array(300),this.size=0,this.blocksize=0,this.data=null}decode_raw(t){for(var e=1,i=1<<t;e<i;){e=e<<1|this.zp.decode()}return e-i}decode_binary(t,e){var i=1,r=1<<e;for(t--;i<r;){i=i<<1|this.zp.decode(this.ctx,t+i)}return i-r}_decode(){if(this.size=this.decode_raw(24),!this.size)return 0;if(this.size>1024*this.maxblock)throw new Error("Too big block. Error");this.blocksize<this.size?(this.blocksize=this.size,this.data=new Uint8Array(this.blocksize)):null==this.data&&(this.data=new Uint8Array(this.blocksize));var t=0;this.zp.decode()&&(t++,this.zp.decode()&&t++);for(var e=new Uint8Array(256),i=0;i<256;i++)e[i]=i;var r=new Array(this.FREQMAX);for(i=0;i<this.FREQMAX;r[i++]=0);var n=4,s=3,a=-1;for(i=0;i<this.size;i++){var o=this.CTXIDS-1;o>s&&(o=s);var h,f=0;switch(0){default:if(0!=this.zp.decode(this.ctx,f+o)){s=0,this.data[i]=e[s];break}if(f+=this.CTXIDS,0!=this.zp.decode(this.ctx,f+o)){s=1,this.data[i]=e[s];break}if(f+=this.CTXIDS,0!=this.zp.decode(this.ctx,f+0)){s=2+this.decode_binary(f+1,1),this.data[i]=e[s];break}if(f+=2,0!=this.zp.decode(this.ctx,f+0)){s=4+this.decode_binary(f+1,2),this.data[i]=e[s];break}if(f+=4,0!=this.zp.decode(this.ctx,f+0)){s=8+this.decode_binary(f+1,3),this.data[i]=e[s];break}if(f+=8,0!=this.zp.decode(this.ctx,f+0)){s=16+this.decode_binary(f+1,4),this.data[i]=e[s];break}if(f+=16,0!=this.zp.decode(this.ctx,f+0)){s=32+this.decode_binary(f+1,5),this.data[i]=e[s];break}if(f+=32,0!=this.zp.decode(this.ctx,f+0)){s=64+this.decode_binary(f+1,6),this.data[i]=e[s];break}if(f+=64,0!=this.zp.decode(this.ctx,f+0)){s=128+this.decode_binary(f+1,7),this.data[i]=e[s];break}s=256,this.data[i]=0,a=i;continue}if((n+=n>>t)>268435456)for(n>>=24,r[0]>>=24,r[1]>>=24,r[2]>>=24,r[3]>>=24,h=4;h<this.FREQMAX;h++)r[h]>>=24;var l=n;for(s<this.FREQMAX&&(l+=r[s]),h=s;h>=this.FREQMAX;h--)e[h]=e[h-1];for(;h>0&&(4294967295&l)>=(4294967295&r[h-1]);h--)e[h]=e[h-1],r[h]=r[h-1];e[h]=this.data[i],r[h]=l}if(a<1||a>=this.size)throw new Error("BZZ byte stream is corrupted");for(var u=new Uint32Array(this.size),c=0;c<this.size;u[c++]=0);var d=new Array(256);for(i=0;i<256;d[i++]=0);for(i=0;i<a;i++){var p=this.data[i];u[i]=p<<24|16777215&d[255&p],d[255&p]++}for(i=a+1;i<this.size;i++){p=this.data[i];u[i]=p<<24|16777215&d[255&p],d[255&p]++}var g=1;for(i=0;i<256;i++){var m=d[i];d[i]=g,g+=m}c=0;for(g=this.size-1;g>0;){var b=u[c];p=u[c]>>24;this.data[--g]=255&p,c=d[255&p]+(16777215&b)}if(c!=a)throw new Error("BZZ byte stream is corrupted");return this.size}getByteStream(){for(var t,e;e=this._decode();){t||(t=new a(e-1));var i=new Uint8Array(this.data.buffer,0,e-1);t.writeArray(i)}return this.data=null,new U(t.getBuffer())}static decodeByteStream(t){return new N(new h(t)).getByteStream()}}class M extends E{constructor(t){var i=performance.now();if(super(t),this.pixel={r:0,g:0,b:0},this.version=t.getUint8(),127&this.version)throw"Bad Djvu Pallete version!";if(this.palleteSize=t.getInt16(),this.palleteSize<0||this.palleteSize>65535)throw"Bad Djvu Pallete size!";if(this.colorArray=t.getUint8Array(3*this.palleteSize),128&this.version){if(this.dataSize=t.getInt24(),this.dataSize<0)throw"Bad Djvu Pallete data size!";var r=N.decodeByteStream(t.fork());this.colorIndices=new Int16Array(this.dataSize);for(var n=0;n<this.dataSize;n++){var s=r.getInt16();if(s<0||s>=this.palleteSize)throw"Bad Djvu Pallete index! "+s;this.colorIndices[n]=s}}e.IS_DEBUG&&console.log("DjvuPalette time ",performance.now()-i)}getDataSize(){return this.dataSize}getPixelByBlitIndex(t){var e=3*this.colorIndices[t];return this.pixel.r=this.colorArray[e+2],this.pixel.g=this.colorArray[e+1],this.pixel.b=this.colorArray[e],this.pixel}toString(){var t=super.toString();return t+="Pallete size: "+this.palleteSize+"\n",t+="Data size: "+this.dataSize+"\n"}}class P{constructor(){this.quant_lo=Uint32Array.of(16384,32768,32768,65536,65536,65536,65536,65536,65536,65536,65536,65536,131072,131072,131072,131072),this.quant_hi=Uint32Array.of(0,131072,131072,262144,262144,262144,524288,262144,262144,524288),this.bucketstate=new Uint8Array(16),this.coeffstate=new Array(16);for(var t=new ArrayBuffer(256),e=0;e<16;e++)this.coeffstate[e]=new Uint8Array(t,e<<4,16);this.bbstate=0,this.decodeBucketCtx=new Uint8Array(1),this.decodeCoefCtx=new Uint8Array(80),this.activateCoefCtx=new Uint8Array(16),this.inreaseCoefCtx=new Uint8Array(1),this.curband=0}getBandBuckets(t){return this.bandBuckets[t]}is_null_slice(){if(0==this.curband){for(var t=1,e=0;e<16;e++){var i=this.quant_lo[e];this.coeffstate[0][e]=1,i>0&&i<32768&&(this.coeffstate[0][e]=8,t=0)}return t}return!((i=this.quant_hi[this.curband])>0&&i<32768)}finish_code_slice(){if(this.quant_hi[this.curband]=this.quant_hi[this.curband]>>1,0===this.curband)for(var t=0;t<16;t++)this.quant_lo[t]=this.quant_lo[t]>>1;this.curband++,10===this.curband&&(this.curband=0)}}function F(t){return(t=t+32>>6)<-128?-128:t>=128?127:t}P.prototype.ZERO=1,P.prototype.ACTIVE=2,P.prototype.NEW=4,P.prototype.UNK=8,P.prototype.zigzagRow=Uint8Array.of(0,0,16,16,0,0,16,16,8,8,24,24,8,8,24,24,0,0,16,16,0,0,16,16,8,8,24,24,8,8,24,24,4,4,20,20,4,4,20,20,12,12,28,28,12,12,28,28,4,4,20,20,4,4,20,20,12,12,28,28,12,12,28,28,0,0,16,16,0,0,16,16,8,8,24,24,8,8,24,24,0,0,16,16,0,0,16,16,8,8,24,24,8,8,24,24,4,4,20,20,4,4,20,20,12,12,28,28,12,12,28,28,4,4,20,20,4,4,20,20,12,12,28,28,12,12,28,28,2,2,18,18,2,2,18,18,10,10,26,26,10,10,26,26,2,2,18,18,2,2,18,18,10,10,26,26,10,10,26,26,6,6,22,22,6,6,22,22,14,14,30,30,14,14,30,30,6,6,22,22,6,6,22,22,14,14,30,30,14,14,30,30,2,2,18,18,2,2,18,18,10,10,26,26,10,10,26,26,2,2,18,18,2,2,18,18,10,10,26,26,10,10,26,26,6,6,22,22,6,6,22,22,14,14,30,30,14,14,30,30,6,6,22,22,6,6,22,22,14,14,30,30,14,14,30,30,0,0,16,16,0,0,16,16,8,8,24,24,8,8,24,24,0,0,16,16,0,0,16,16,8,8,24,24,8,8,24,24,4,4,20,20,4,4,20,20,12,12,28,28,12,12,28,28,4,4,20,20,4,4,20,20,12,12,28,28,12,12,28,28,0,0,16,16,0,0,16,16,8,8,24,24,8,8,24,24,0,0,16,16,0,0,16,16,8,8,24,24,8,8,24,24,4,4,20,20,4,4,20,20,12,12,28,28,12,12,28,28,4,4,20,20,4,4,20,20,12,12,28,28,12,12,28,28,2,2,18,18,2,2,18,18,10,10,26,26,10,10,26,26,2,2,18,18,2,2,18,18,10,10,26,26,10,10,26,26,6,6,22,22,6,6,22,22,14,14,30,30,14,14,30,30,6,6,22,22,6,6,22,22,14,14,30,30,14,14,30,30,2,2,18,18,2,2,18,18,10,10,26,26,10,10,26,26,2,2,18,18,2,2,18,18,10,10,26,26,10,10,26,26,6,6,22,22,6,6,22,22,14,14,30,30,14,14,30,30,6,6,22,22,6,6,22,22,14,14,30,30,14,14,30,30,1,1,17,17,1,1,17,17,9,9,25,25,9,9,25,25,1,1,17,17,1,1,17,17,9,9,25,25,9,9,25,25,5,5,21,21,5,5,21,21,13,13,29,29,13,13,29,29,5,5,21,21,5,5,21,21,13,13,29,29,13,13,29,29,1,1,17,17,1,1,17,17,9,9,25,25,9,9,25,25,1,1,17,17,1,1,17,17,9,9,25,25,9,9,25,25,5,5,21,21,5,5,21,21,13,13,29,29,13,13,29,29,5,5,21,21,5,5,21,21,13,13,29,29,13,13,29,29,3,3,19,19,3,3,19,19,11,11,27,27,11,11,27,27,3,3,19,19,3,3,19,19,11,11,27,27,11,11,27,27,7,7,23,23,7,7,23,23,15,15,31,31,15,15,31,31,7,7,23,23,7,7,23,23,15,15,31,31,15,15,31,31,3,3,19,19,3,3,19,19,11,11,27,27,11,11,27,27,3,3,19,19,3,3,19,19,11,11,27,27,11,11,27,27,7,7,23,23,7,7,23,23,15,15,31,31,15,15,31,31,7,7,23,23,7,7,23,23,15,15,31,31,15,15,31,31,1,1,17,17,1,1,17,17,9,9,25,25,9,9,25,25,1,1,17,17,1,1,17,17,9,9,25,25,9,9,25,25,5,5,21,21,5,5,21,21,13,13,29,29,13,13,29,29,5,5,21,21,5,5,21,21,13,13,29,29,13,13,29,29,1,1,17,17,1,1,17,17,9,9,25,25,9,9,25,25,1,1,17,17,1,1,17,17,9,9,25,25,9,9,25,25,5,5,21,21,5,5,21,21,13,13,29,29,13,13,29,29,5,5,21,21,5,5,21,21,13,13,29,29,13,13,29,29,3,3,19,19,3,3,19,19,11,11,27,27,11,11,27,27,3,3,19,19,3,3,19,19,11,11,27,27,11,11,27,27,7,7,23,23,7,7,23,23,15,15,31,31,15,15,31,31,7,7,23,23,7,7,23,23,15,15,31,31,15,15,31,31,3,3,19,19,3,3,19,19,11,11,27,27,11,11,27,27,3,3,19,19,3,3,19,19,11,11,27,27,11,11,27,27,7,7,23,23,7,7,23,23,15,15,31,31,15,15,31,31,7,7,23,23,7,7,23,23,15,15,31,31,15,15,31,31),P.prototype.zigzagCol=Uint8Array.of(0,16,0,16,8,24,8,24,0,16,0,16,8,24,8,24,4,20,4,20,12,28,12,28,4,20,4,20,12,28,12,28,0,16,0,16,8,24,8,24,0,16,0,16,8,24,8,24,4,20,4,20,12,28,12,28,4,20,4,20,12,28,12,28,2,18,2,18,10,26,10,26,2,18,2,18,10,26,10,26,6,22,6,22,14,30,14,30,6,22,6,22,14,30,14,30,2,18,2,18,10,26,10,26,2,18,2,18,10,26,10,26,6,22,6,22,14,30,14,30,6,22,6,22,14,30,14,30,0,16,0,16,8,24,8,24,0,16,0,16,8,24,8,24,4,20,4,20,12,28,12,28,4,20,4,20,12,28,12,28,0,16,0,16,8,24,8,24,0,16,0,16,8,24,8,24,4,20,4,20,12,28,12,28,4,20,4,20,12,28,12,28,2,18,2,18,10,26,10,26,2,18,2,18,10,26,10,26,6,22,6,22,14,30,14,30,6,22,6,22,14,30,14,30,2,18,2,18,10,26,10,26,2,18,2,18,10,26,10,26,6,22,6,22,14,30,14,30,6,22,6,22,14,30,14,30,1,17,1,17,9,25,9,25,1,17,1,17,9,25,9,25,5,21,5,21,13,29,13,29,5,21,5,21,13,29,13,29,1,17,1,17,9,25,9,25,1,17,1,17,9,25,9,25,5,21,5,21,13,29,13,29,5,21,5,21,13,29,13,29,3,19,3,19,11,27,11,27,3,19,3,19,11,27,11,27,7,23,7,23,15,31,15,31,7,23,7,23,15,31,15,31,3,19,3,19,11,27,11,27,3,19,3,19,11,27,11,27,7,23,7,23,15,31,15,31,7,23,7,23,15,31,15,31,1,17,1,17,9,25,9,25,1,17,1,17,9,25,9,25,5,21,5,21,13,29,13,29,5,21,5,21,13,29,13,29,1,17,1,17,9,25,9,25,1,17,1,17,9,25,9,25,5,21,5,21,13,29,13,29,5,21,5,21,13,29,13,29,3,19,3,19,11,27,11,27,3,19,3,19,11,27,11,27,7,23,7,23,15,31,15,31,7,23,7,23,15,31,15,31,3,19,3,19,11,27,11,27,3,19,3,19,11,27,11,27,7,23,7,23,15,31,15,31,7,23,7,23,15,31,15,31,0,16,0,16,8,24,8,24,0,16,0,16,8,24,8,24,4,20,4,20,12,28,12,28,4,20,4,20,12,28,12,28,0,16,0,16,8,24,8,24,0,16,0,16,8,24,8,24,4,20,4,20,12,28,12,28,4,20,4,20,12,28,12,28,2,18,2,18,10,26,10,26,2,18,2,18,10,26,10,26,6,22,6,22,14,30,14,30,6,22,6,22,14,30,14,30,2,18,2,18,10,26,10,26,2,18,2,18,10,26,10,26,6,22,6,22,14,30,14,30,6,22,6,22,14,30,14,30,0,16,0,16,8,24,8,24,0,16,0,16,8,24,8,24,4,20,4,20,12,28,12,28,4,20,4,20,12,28,12,28,0,16,0,16,8,24,8,24,0,16,0,16,8,24,8,24,4,20,4,20,12,28,12,28,4,20,4,20,12,28,12,28,2,18,2,18,10,26,10,26,2,18,2,18,10,26,10,26,6,22,6,22,14,30,14,30,6,22,6,22,14,30,14,30,2,18,2,18,10,26,10,26,2,18,2,18,10,26,10,26,6,22,6,22,14,30,14,30,6,22,6,22,14,30,14,30,1,17,1,17,9,25,9,25,1,17,1,17,9,25,9,25,5,21,5,21,13,29,13,29,5,21,5,21,13,29,13,29,1,17,1,17,9,25,9,25,1,17,1,17,9,25,9,25,5,21,5,21,13,29,13,29,5,21,5,21,13,29,13,29,3,19,3,19,11,27,11,27,3,19,3,19,11,27,11,27,7,23,7,23,15,31,15,31,7,23,7,23,15,31,15,31,3,19,3,19,11,27,11,27,3,19,3,19,11,27,11,27,7,23,7,23,15,31,15,31,7,23,7,23,15,31,15,31,1,17,1,17,9,25,9,25,1,17,1,17,9,25,9,25,5,21,5,21,13,29,13,29,5,21,5,21,13,29,13,29,1,17,1,17,9,25,9,25,1,17,1,17,9,25,9,25,5,21,5,21,13,29,13,29,5,21,5,21,13,29,13,29,3,19,3,19,11,27,11,27,3,19,3,19,11,27,11,27,7,23,7,23,15,31,15,31,7,23,7,23,15,31,15,31,3,19,3,19,11,27,11,27,3,19,3,19,11,27,11,27,7,23,7,23,15,31,15,31,7,23,7,23,15,31,15,31),P.prototype.bandBuckets=[{from:0,to:0},{from:1,to:1},{from:2,to:2},{from:3,to:3},{from:4,to:7},{from:8,to:11},{from:12,to:15},{from:16,to:31},{from:32,to:47},{from:48,to:63}];class j{constructor(t,e,i){this.width=t.width,this.yArray=t.array,this.cbArray=e?e.array:null,this.crArray=i?i.array:null,this.writePixel=e?this.writeColoredPixel:this.writeGrayScalePixel}writeGrayScalePixel(t,e,i){const r=127-F(this.yArray[t]);e[i]=r,e[1|i]=r,e[2|i]=r}writeColoredPixel(t,e,i){const r=F(this.yArray[t]),n=F(this.cbArray[t]),s=F(this.crArray[t]),a=s+(s>>1),o=r+128-(n>>2);e[i]=r+128+a,e[1|i]=o-(a>>1),e[2|i]=o+(n<<1)}}class Z{constructor(t,e){this.width=t,this.array=new Int16Array(t*e)}get(t,e){return this.array[t*this.width+e]}set(t,e,i){this.array[t*this.width+e]=i}sub(t,e,i){this.array[t*this.width+e]-=i}add(t,e,i){this.array[t*this.width+e]+=i}}class H extends Array{constructor(t,e){super(e),this.height=e,this.width=t;for(var i=0;i<e;i++)this[i]=new Int16Array(t)}}class W{constructor(t,e,i=!1){if(this.array=new Int16Array(t,e,1024),i){this.buckets=new Array(64);for(var r=0;r<64;r++)this.buckets[r]=new Int16Array(t,e,16),e+=32}}setBucketCoef(t,e,i){this.array[t<<4|e]=i}getBucketCoef(t,e){return this.array[t<<4|e]}getCoef(t){return this.array[t]}setCoef(t,e){this.array[t]=e}static createBlockArray(t){for(var e=new Array(t),i=new ArrayBuffer(t<<11),r=0;r<t;r++)e[r]=new W(i,r<<11);return e}}class G{constructor(){this.buffer=null,this.offset=0,this.retainedMemory=0,this.usedMemory=0}ensureBuffer(){return(!this.buffer||this.offset>=this.buffer.byteLength)&&(this.buffer=new ArrayBuffer(10<<20),this.offset=0,this.retainedMemory+=this.buffer.byteLength),this.buffer}allocateBucket(){this.ensureBuffer();const t=new Int16Array(this.buffer,this.offset,16);return this.offset+=32,this.usedMemory+=32,t}}class q{constructor(t){this.buckets=new Array(64),this.mm=t}setBucketCoef(t,e,i){this.buckets[t]||(this.buckets[t]=this.mm.allocateBucket()),this.buckets[t][e]=i}getBucketCoef(t,e){return this.buckets[t]?this.buckets[t][e]:0}getCoef(t){return this.getBucketCoef(t>>4,15&t)}setCoef(t,e){return this.setBucketCoef(t>>4,15&t,e)}static createBlockArray(t){const e=new G,i=new Array(t);for(var r=0;r<t;r++)i[r]=new q(e);return i}}class Y extends P{constructor(){super()}init(t){this.info=t;var e=Math.ceil(this.info.width/32)*Math.ceil(this.info.height/32);this.blocks=q.createBlockArray(e)}decodeSlice(t,e){this.info||this.init(e),this.zp=t,this.is_null_slice()||this.blocks.forEach(t=>{this.preliminaryFlagComputation(t),this.blockBandDecodingPass()&&(this.bucketDecodingPass(t,this.curband),this.newlyActiveCoefficientDecodingPass(t,this.curband)),this.previouslyActiveCoefficientDecodingPass(t)}),this.finish_code_slice()}previouslyActiveCoefficientDecodingPass(t){for(var e=0,i=this.quant_hi[this.curband],r=this.getBandBuckets(this.curband),n=r.from;n<=r.to;n++,e++)for(var s=0;s<16;s++)if(2&this.coeffstate[e][s]){this.curband||(i=this.quant_lo[s]);var a=0,o=t.getBucketCoef(n,s),h=Math.abs(o);h<=3*i?(a=this.zp.decode(this.inreaseCoefCtx,0),h+=i>>2):a=this.zp.IWdecode(),h+=a?i>>1:(i>>1)-i,t.setBucketCoef(n,s,o<0?-h:h)}}newlyActiveCoefficientDecodingPass(t,e){for(var i=0,r=this.getBandBuckets(e),n=this.quant_hi[this.curband],s=r.from;s<=r.to;s++,i++)if(4&this.bucketstate[i]){var a=0;2&this.bucketstate[i]&&(a=8);for(var o=0,h=0;h<16;h++)8&this.coeffstate[i][h]&&o++;for(h=0;h<16;h++)if(8&this.coeffstate[i][h]){var f=Math.min(7,o);if(this.zp.decode(this.activateCoefCtx,a+f)){var l=this.zp.IWdecode()?-1:1;o=0,this.curband||(n=this.quant_lo[h]),t.setBucketCoef(s,h,l*(n+(n>>1)-(n>>3)))}o&&o--}}}bucketDecodingPass(t,e){for(var i=this.getBandBuckets(e),r=0,n=i.from;n<=i.to;n++,r++)if(8&this.bucketstate[r]){var s=0;if(e){for(var a=4*n,o=a;o<a+4;o++)t.getCoef(o)&&s++;4===s&&s--}2&this.bbstate&&(s|=4),this.zp.decode(this.decodeCoefCtx,s+8*e)&&(this.bucketstate[r]|=4)}}blockBandDecodingPass(){var t=this.getBandBuckets(this.curband);return t.to-t.from+1<16||2&this.bbstate?this.bbstate|=4:8&this.bbstate&&this.zp.decode(this.decodeBucketCtx,0)&&(this.bbstate|=4),4&this.bbstate}preliminaryFlagComputation(t){this.bbstate=0;var e=0,i=this.getBandBuckets(this.curband);if(this.curband)for(var r=0,n=i.from;n<=i.to;n++,r++){e=0;for(var s=0;s<16;s++)0===t.getBucketCoef(n,s)?this.coeffstate[r][s]=8:this.coeffstate[r][s]=2,e|=this.coeffstate[r][s];this.bucketstate[r]=e,this.bbstate|=e}else{for(s=0;s<16;s++)1!==this.coeffstate[0][s]&&(0===t.getBucketCoef(0,s)?this.coeffstate[0][s]=8:this.coeffstate[0][s]=2),e|=this.coeffstate[0][s];this.bucketstate[0]=e,this.bbstate|=e}}getBytemap(){for(var t=performance.now(),i=32*Math.ceil(this.info.width/32),r=32*Math.ceil(this.info.height/32),n=Math.ceil(this.info.height/32),s=Math.ceil(this.info.width/32),a=new Z(i,r),o=0;o<n;o++)for(var h=0;h<s;h++)for(var f=this.blocks[o*s+h],l=0;l<1024;l++)a.set(this.zigzagRow[l]+(o<<5),this.zigzagCol[l]+(h<<5),f.getCoef(l));return e.IS_DEBUG&&console.time("inverseTime"),this.inverseWaveletTransform(a),e.IS_DEBUG&&console.timeEnd("inverseTime"),e.IS_DEBUG&&console.log("getBytemap time = ",performance.now()-t),a}inverseWaveletTransform(t){for(var e,i,r,n,s,a,o,h,f,l,u=this.info.height,c=this.info.width,d=16,p=4;0!==d;d>>=1,p--){for(a=(r=u-1>>p)-3,s=0;s<c;s+=d){for(n=0,h=0,f=0,l=1>r?0:t.get(1<<p,s),n=0;n<=r;n+=2)o=h,e=(h=f)+(f=l),i=o+(l=n+3>r?0:t.get(n+3<<p,s)),t.sub(n<<p,s,(e<<3)+e-i+16>>5);for(n=1,h=t.get(n-1<<p,s),n+1<=r?(f=t.get(n+1<<p,s),t.add(n<<p,s,h+f+1>>1)):t.add(n<<p,s,h),a>=3&&(l=t.get(n+3<<p,s)),n=3;n<=a;n+=2)o=h,h=f,f=l,l=t.get(n+3<<p,s),e=h+f,t.add(n<<p,s,(e<<3)+e-(o+l)+8>>4);for(;n<=r;n+=2)h=f,f=l,l=0,n+1<=r?t.add(n<<p,s,h+f+1>>1):t.add(n<<p,s,h)}for(a=(r=c-1>>p)-3,s=0;s<u;s+=d){for(n=0,h=0,f=0,l=1>r?0:t.get(s,1<<p),n=0;n<=r;n+=2)o=h,e=(h=f)+(f=l),i=o+(l=n+3>r?0:t.get(s,n+3<<p)),t.sub(s,n<<p,(e<<3)+e-i+16>>5);for(n=1,h=t.get(s,n-1<<p),n+1<=r?(f=t.get(s,n+1<<p),t.add(s,n<<p,h+f+1>>1)):t.add(s,n<<p,h),a>=3&&(l=t.get(s,n+3<<p)),n=3;n<=a;n+=2)o=h,h=f,f=l,l=t.get(s,n+3<<p),e=h+f,t.add(s,n<<p,(e<<3)+e-(o+l)+8>>4);for(;n<=r;n+=2)h=f,f=l,l=0,n+1<=r?t.add(s,n<<p,h+f+1>>1):t.add(s,n<<p,h)}}}}class V{constructor(){this.info=null,this.pixelmap=null,this.resetCodecs()}resetCodecs(){this.ycodec=new Y,this.crcodec=this.crcodec?new Y:null,this.cbcodec=this.cbcodec?new Y:null,this.cslice=0}decodeChunk(t,e){this.info?this.info.slices=e.slices:(this.info=e,e.grayscale||(this.crcodec=new Y,this.cbcodec=new Y));for(var i=0;i<this.info.slices;i++)this.cslice++,this.ycodec.decodeSlice(t,e),this.crcodec&&this.cbcodec&&this.cslice>this.info.delayInit&&(this.cbcodec.decodeSlice(t,e),this.crcodec.decodeSlice(t,e))}createPixelmap(){var t=performance.now(),i=this.ycodec.getBytemap(),r=this.cbcodec?this.cbcodec.getBytemap():null,n=this.crcodec?this.crcodec.getBytemap():null,s=performance.now();this.pixelmap=new j(i,r,n),e.IS_DEBUG&&console.log("Pixelmap constructor time = ",performance.now()-s),e.IS_DEBUG&&console.log("IWImage.createPixelmap time = ",performance.now()-t),this.resetCodecs()}getImage(){const t=performance.now();this.pixelmap||this.createPixelmap();const i=this.info.width,r=this.info.height,n=new ImageData(i,r),s=t=>{const e=t*this.pixelmap.width;let s=(r-t-1)*i<<2;for(let t=0;t<i;t++)this.pixelmap.writePixel(e+t,n.data,s),n.data[3|s]=255,s+=4};for(let t=0;t<r;t++)s(t);return e.IS_DEBUG&&console.log("IWImage.getImage time = ",performance.now()-t),n}}class X extends E{constructor(t){super(t),this.isDecoded=!1,this.dbs="TXTz"===this.id?null:this.bs}decode(){this.isDecoded||(this.dbs||(this.dbs=N.decodeByteStream(this.bs)),this.textLength=this.dbs.getInt24(),this.utf8array=this.dbs.getUint8Array(this.textLength),this.version=this.dbs.getUint8(),1!==this.version&&console.warn("The version in "+this.id+" isn't equal to 1!"),this.pageZone=this.dbs.isEmpty()?null:this.decodeZone(),this.isDecoded=!0)}decodeZone(t=null,e=null){var i=this.dbs.getUint8(),r=this.dbs.getUint16()-32768,n=this.dbs.getUint16()-32768,s=this.dbs.getUint16()-32768,a=this.dbs.getUint16()-32768,o=this.dbs.getUint16()-32768,h=this.dbs.getInt24();e?(1===i||4===i||5===i?(r+=e.x,n=e.y-(n+a)):(r=r+e.x+e.width,n+=e.y),o+=e.textStart+e.textLength):t&&(r+=t.x,n=t.y+t.height-(n+a),o+=t.textStart);var f={type:i,x:r,y:n,width:s,height:a,textStart:o,textLength:h},l=this.dbs.getInt24();if(l){for(var u=new Array(l),c=null,d=0;d<l;d++)c=this.decodeZone(f,c),u[d]=c;f.children=u}return f}getText(){return this.decode(),this.text=this.text||r(this.utf8array),this.text}getPageZone(){return this.decode(),this.pageZone}getNormalizedZones(){if(this.decode(),!this.pageZone)return null;if(this.normalizedZones)return this.normalizedZones;this.normalizedZones=[];var t={};const e=i=>{if(i.children)i.children.forEach(t=>e(t));else{var n=i.x.toString()+i.y+i.width+i.height,s=r(this.utf8array.slice(i.textStart,i.textStart+i.textLength));t[n]?t[n].text+=s:(t[n]={x:i.x,y:i.y,width:i.width,height:i.height,text:s},this.normalizedZones.push(t[n]))}};return e(this.pageZone),this.normalizedZones}toString(){this.decode();var t="Text length = "+this.textLength+"\n";return super.toString()+t}}var K="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Q(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}var J,$=(function(t,e){t.exports=function t(e,i,r){function n(a,o){if(!i[a]){if(!e[a]){var h=Q;if(!o&&h)return h(a,!0);if(s)return s(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var l=i[a]={exports:{}};e[a][0].call(l.exports,function(t){var i=e[a][1][t];return n(i||t)},l,l.exports,t,e,i,r)}return i[a].exports}for(var s=Q,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(t,e,i){(function(e){let r=t("./interlace"),n=[function(){},function(t,e,i,r){if(r===e.length)throw new Error("Ran out of data");let n=e[r];t[i]=n,t[i+1]=n,t[i+2]=n,t[i+3]=255},function(t,e,i,r){if(r+1>=e.length)throw new Error("Ran out of data");let n=e[r];t[i]=n,t[i+1]=n,t[i+2]=n,t[i+3]=e[r+1]},function(t,e,i,r){if(r+2>=e.length)throw new Error("Ran out of data");t[i]=e[r],t[i+1]=e[r+1],t[i+2]=e[r+2],t[i+3]=255},function(t,e,i,r){if(r+3>=e.length)throw new Error("Ran out of data");t[i]=e[r],t[i+1]=e[r+1],t[i+2]=e[r+2],t[i+3]=e[r+3]}],s=[function(){},function(t,e,i,r){let n=e[0];t[i]=n,t[i+1]=n,t[i+2]=n,t[i+3]=r},function(t,e,i){let r=e[0];t[i]=r,t[i+1]=r,t[i+2]=r,t[i+3]=e[1]},function(t,e,i,r){t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=r},function(t,e,i){t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3]}];function a(t,e,i,r,s,a){let o=t.width,h=t.height,f=t.index;for(let t=0;t<h;t++)for(let h=0;h<o;h++){let o=i(h,t,f);n[r](e,s,o,a),a+=r}return a}function o(t,e,i,r,n,a){let o=t.width,h=t.height,f=t.index;for(let t=0;t<h;t++){for(let h=0;h<o;h++){let o=n.get(r),l=i(h,t,f);s[r](e,o,l,a)}n.resetAfterLine()}}i.dataToBitMap=function(t,i){let n,s,h=i.width,f=i.height,l=i.depth,u=i.bpp,c=i.interlace;8!==l&&(n=function(t,e){let i=[],r=0;function n(){if(r===t.length)throw new Error("Ran out of data");let n,s,a,o,h,f,l,u,c=t[r];switch(r++,e){default:throw new Error("unrecognised depth");case 16:l=t[r],r++,i.push((c<<8)+l);break;case 4:l=15&c,u=c>>4,i.push(u,l);break;case 2:h=3&c,f=c>>2&3,l=c>>4&3,u=c>>6&3,i.push(u,l,f,h);break;case 1:n=1&c,s=c>>1&1,a=c>>2&1,o=c>>3&1,h=c>>4&1,f=c>>5&1,l=c>>6&1,u=c>>7&1,i.push(u,l,f,h,o,a,s,n)}}return{get:function(t){for(;i.length<t;)n();let e=i.slice(0,t);return i=i.slice(t),e},resetAfterLine:function(){i.length=0},end:function(){if(r!==t.length)throw new Error("extra data found")}}}(t,l)),s=l<=8?e.alloc(h*f*4):new Uint16Array(h*f*4);let d,p,g=Math.pow(2,l)-1,m=0;if(c)d=r.getImagePasses(h,f),p=r.getInterlaceIterator(h,f);else{let t=0;p=function(){let e=t;return t+=4,e},d=[{width:h,height:f}]}for(let e=0;e<d.length;e++)8===l?m=a(d[e],s,p,u,t,m):o(d[e],s,p,u,n,g);if(8===l){if(m!==t.length)throw new Error("extra data found")}else n.end();return s}}).call(this,t("buffer").Buffer)},{"./interlace":11,buffer:28}],2:[function(t,e,i){(function(i){let r=t("./constants");e.exports=function(t,e,n,s){let a=-1!==[r.COLORTYPE_COLOR_ALPHA,r.COLORTYPE_ALPHA].indexOf(s.colorType);if(s.colorType===s.inputColorType){let e=function(){let t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256!==new Int16Array(t)[0]}();if(8===s.bitDepth||16===s.bitDepth&&e)return t}let o=16!==s.bitDepth?t:new Uint16Array(t.buffer),h=255,f=r.COLORTYPE_TO_BPP_MAP[s.inputColorType];4!==f||s.inputHasAlpha||(f=3);let l=r.COLORTYPE_TO_BPP_MAP[s.colorType];16===s.bitDepth&&(h=65535,l*=2);let u=i.alloc(e*n*l),c=0,d=0,p=s.bgColor||{};function g(){let t,e,i,n=h;switch(s.inputColorType){case r.COLORTYPE_COLOR_ALPHA:n=o[c+3],t=o[c],e=o[c+1],i=o[c+2];break;case r.COLORTYPE_COLOR:t=o[c],e=o[c+1],i=o[c+2];break;case r.COLORTYPE_ALPHA:n=o[c+1],t=o[c],e=t,i=t;break;case r.COLORTYPE_GRAYSCALE:t=o[c],e=t,i=t;break;default:throw new Error("input color type:"+s.inputColorType+" is not supported at present")}return s.inputHasAlpha&&(a||(n/=h,t=Math.min(Math.max(Math.round((1-n)*p.red+n*t),0),h),e=Math.min(Math.max(Math.round((1-n)*p.green+n*e),0),h),i=Math.min(Math.max(Math.round((1-n)*p.blue+n*i),0),h))),{red:t,green:e,blue:i,alpha:n}}void 0===p.red&&(p.red=h),void 0===p.green&&(p.green=h),void 0===p.blue&&(p.blue=h);for(let t=0;t<n;t++)for(let t=0;t<e;t++){let t=g();switch(s.colorType){case r.COLORTYPE_COLOR_ALPHA:case r.COLORTYPE_COLOR:8===s.bitDepth?(u[d]=t.red,u[d+1]=t.green,u[d+2]=t.blue,a&&(u[d+3]=t.alpha)):(u.writeUInt16BE(t.red,d),u.writeUInt16BE(t.green,d+2),u.writeUInt16BE(t.blue,d+4),a&&u.writeUInt16BE(t.alpha,d+6));break;case r.COLORTYPE_ALPHA:case r.COLORTYPE_GRAYSCALE:{let e=(t.red+t.green+t.blue)/3;8===s.bitDepth?(u[d]=e,a&&(u[d+1]=t.alpha)):(u.writeUInt16BE(e,d),a&&u.writeUInt16BE(t.alpha,d+2));break}default:throw new Error("unrecognised color Type "+s.colorType)}c+=f,d+=l}return u}}).call(this,t("buffer").Buffer)},{"./constants":4,buffer:28}],3:[function(t,e,i){(function(i,r){let n=t("util"),s=t("stream"),a=e.exports=function(){s.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};n.inherits(a,s),a.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e}),i.nextTick(function(){this._process(),this._paused&&this._reads&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}.bind(this))},a.prototype.write=function(t,e){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;let i;return i=r.isBuffer(t)?t:r.from(t,e||this._encoding),this._buffers.push(i),this._buffered+=i.length,this._process(),this._reads&&0===this._reads.length&&(this._paused=!0),this.writable&&!this._paused},a.prototype.end=function(t,e){t&&this.write(t,e),this.writable=!1,this._buffers&&(0===this._buffers.length?this._end():(this._buffers.push(null),this._process()))},a.prototype.destroySoon=a.prototype.end,a.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("Unexpected end of input")),this.destroy()},a.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},a.prototype._processReadAllowingLess=function(t){this._reads.shift();let e=this._buffers[0];e.length>t.length?(this._buffered-=t.length,this._buffers[0]=e.slice(t.length),t.func.call(this,e.slice(0,t.length))):(this._buffered-=e.length,this._buffers.shift(),t.func.call(this,e))},a.prototype._processRead=function(t){this._reads.shift();let e=0,i=0,n=r.alloc(t.length);for(;e<t.length;){let r=this._buffers[i++],s=Math.min(r.length,t.length-e);r.copy(n,e,0,s),e+=s,s!==r.length&&(this._buffers[--i]=r.slice(s))}i>0&&this._buffers.splice(0,i),this._buffered-=t.length,t.func.call(this,n)},a.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){let t=this._reads[0];if(t.allowLess)this._processReadAllowingLess(t);else{if(!(this._buffered>=t.length))break;this._processRead(t)}}this._buffers&&!this.writable&&this._end()}catch(t){this.emit("error",t)}}}).call(this,t("_process"),t("buffer").Buffer)},{_process:47,buffer:28,stream:63,util:67}],4:[function(t,e,i){e.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],5:[function(t,e,i){let r=[];!function(){for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;r[t]=e}}();let n=e.exports=function(){this._crc=-1};n.prototype.write=function(t){for(let e=0;e<t.length;e++)this._crc=r[255&(this._crc^t[e])]^this._crc>>>8;return!0},n.prototype.crc32=function(){return-1^this._crc},n.crc32=function(t){let e=-1;for(let i=0;i<t.length;i++)e=r[255&(e^t[i])]^e>>>8;return-1^e}},{}],6:[function(t,e,i){(function(i){let r=t("./paeth-predictor"),n={0:function(t,e,i,r,n){for(let s=0;s<i;s++)r[n+s]=t[e+s]},1:function(t,e,i,r,n,s){for(let a=0;a<i;a++){let i=a>=s?t[e+a-s]:0,o=t[e+a]-i;r[n+a]=o}},2:function(t,e,i,r,n){for(let s=0;s<i;s++){let a=e>0?t[e+s-i]:0,o=t[e+s]-a;r[n+s]=o}},3:function(t,e,i,r,n,s){for(let a=0;a<i;a++){let o=a>=s?t[e+a-s]:0,h=e>0?t[e+a-i]:0,f=t[e+a]-(o+h>>1);r[n+a]=f}},4:function(t,e,i,n,s,a){for(let o=0;o<i;o++){let h=o>=a?t[e+o-a]:0,f=e>0?t[e+o-i]:0,l=e>0&&o>=a?t[e+o-(i+a)]:0,u=t[e+o]-r(h,f,l);n[s+o]=u}}},s={0:function(t,e,i){let r=0,n=e+i;for(let i=e;i<n;i++)r+=Math.abs(t[i]);return r},1:function(t,e,i,r){let n=0;for(let s=0;s<i;s++){let i=s>=r?t[e+s-r]:0,a=t[e+s]-i;n+=Math.abs(a)}return n},2:function(t,e,i){let r=0,n=e+i;for(let s=e;s<n;s++){let n=e>0?t[s-i]:0,a=t[s]-n;r+=Math.abs(a)}return r},3:function(t,e,i,r){let n=0;for(let s=0;s<i;s++){let a=s>=r?t[e+s-r]:0,o=e>0?t[e+s-i]:0,h=t[e+s]-(a+o>>1);n+=Math.abs(h)}return n},4:function(t,e,i,n){let s=0;for(let a=0;a<i;a++){let o=a>=n?t[e+a-n]:0,h=e>0?t[e+a-i]:0,f=e>0&&a>=n?t[e+a-(i+n)]:0,l=t[e+a]-r(o,h,f);s+=Math.abs(l)}return s}};e.exports=function(t,e,r,a,o){let h;if("filterType"in a&&-1!==a.filterType){if("number"!=typeof a.filterType)throw new Error("unrecognised filter types");h=[a.filterType]}else h=[0,1,2,3,4];16===a.bitDepth&&(o*=2);let f=e*o,l=0,u=0,c=i.alloc((f+1)*r),d=h[0];for(let e=0;e<r;e++){if(h.length>1){let e=1/0;for(let i=0;i<h.length;i++){let r=s[h[i]](t,u,f,o);r<e&&(d=h[i],e=r)}}c[l]=d,l++,n[d](t,u,f,c,l,o),l+=f,u+=f}return c}}).call(this,t("buffer").Buffer)},{"./paeth-predictor":15,buffer:28}],7:[function(t,e,i){(function(i){let r=t("util"),n=t("./chunkstream"),s=t("./filter-parse"),a=e.exports=function(t){n.call(this);let e=[],r=this;this._filter=new s(t,{read:this.read.bind(this),write:function(t){e.push(t)},complete:function(){r.emit("complete",i.concat(e))}}),this._filter.start()};r.inherits(a,n)}).call(this,t("buffer").Buffer)},{"./chunkstream":3,"./filter-parse":9,buffer:28,util:67}],8:[function(t,e,i){(function(e){let r=t("./sync-reader"),n=t("./filter-parse");i.process=function(t,i){let s=[],a=new r(t),o=new n(i,{read:a.read.bind(a),write:function(t){s.push(t)},complete:function(){}});return o.start(),a.process(),e.concat(s)}}).call(this,t("buffer").Buffer)},{"./filter-parse":9,"./sync-reader":22,buffer:28}],9:[function(t,e,i){(function(i){let r=t("./interlace"),n=t("./paeth-predictor");function s(t,e,i){let r=t*e;return 8!==i&&(r=Math.ceil(r/(8/i))),r}let a=e.exports=function(t,e){let i=t.width,n=t.height,a=t.interlace,o=t.bpp,h=t.depth;if(this.read=e.read,this.write=e.write,this.complete=e.complete,this._imageIndex=0,this._images=[],a){let t=r.getImagePasses(i,n);for(let e=0;e<t.length;e++)this._images.push({byteWidth:s(t[e].width,o,h),height:t[e].height,lineIndex:0})}else this._images.push({byteWidth:s(i,o,h),height:n,lineIndex:0});this._xComparison=8===h?o:16===h?2*o:1};a.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},a.prototype._unFilterType1=function(t,e,i){let r=this._xComparison,n=r-1;for(let s=0;s<i;s++){let i=t[1+s],a=s>n?e[s-r]:0;e[s]=i+a}},a.prototype._unFilterType2=function(t,e,i){let r=this._lastLine;for(let n=0;n<i;n++){let i=t[1+n],s=r?r[n]:0;e[n]=i+s}},a.prototype._unFilterType3=function(t,e,i){let r=this._xComparison,n=r-1,s=this._lastLine;for(let a=0;a<i;a++){let i=t[1+a],o=s?s[a]:0,h=a>n?e[a-r]:0,f=Math.floor((h+o)/2);e[a]=i+f}},a.prototype._unFilterType4=function(t,e,i){let r=this._xComparison,s=r-1,a=this._lastLine;for(let o=0;o<i;o++){let i=t[1+o],h=a?a[o]:0,f=o>s?e[o-r]:0,l=o>s&&a?a[o-r]:0,u=n(f,h,l);e[o]=i+u}},a.prototype._reverseFilterLine=function(t){let e,r=t[0],n=this._images[this._imageIndex],s=n.byteWidth;if(0===r)e=t.slice(1,s+1);else switch(e=i.alloc(s),r){case 1:this._unFilterType1(t,e,s);break;case 2:this._unFilterType2(t,e,s);break;case 3:this._unFilterType3(t,e,s);break;case 4:this._unFilterType4(t,e,s);break;default:throw new Error("Unrecognised filter type - "+r)}this.write(e),n.lineIndex++,n.lineIndex>=n.height?(this._lastLine=null,this._imageIndex++,n=this._images[this._imageIndex]):this._lastLine=e,n?this.read(n.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}}).call(this,t("buffer").Buffer)},{"./interlace":11,"./paeth-predictor":15,buffer:28}],10:[function(t,e,i){(function(t){e.exports=function(e,i){let r=i.depth,n=i.width,s=i.height,a=i.colorType,o=i.transColor,h=i.palette,f=e;return 3===a?function(t,e,i,r,n){let s=0;for(let a=0;a<r;a++)for(let r=0;r<i;r++){let i=n[t[s]];if(!i)throw new Error("index "+t[s]+" not in palette");for(let t=0;t<4;t++)e[s+t]=i[t];s+=4}}(e,f,n,s,h):(o&&function(t,e,i,r,n){let s=0;for(let a=0;a<r;a++)for(let r=0;r<i;r++){let i=!1;if(1===n.length?n[0]===t[s]&&(i=!0):n[0]===t[s]&&n[1]===t[s+1]&&n[2]===t[s+2]&&(i=!0),i)for(let t=0;t<4;t++)e[s+t]=0;s+=4}}(e,f,n,s,o),8!==r&&(16===r&&(f=t.alloc(n*s*4)),function(t,e,i,r,n){let s=Math.pow(2,n)-1,a=0;for(let n=0;n<r;n++)for(let r=0;r<i;r++){for(let i=0;i<4;i++)e[a+i]=Math.floor(255*t[a+i]/s+.5);a+=4}}(e,f,n,s,r))),f}}).call(this,t("buffer").Buffer)},{buffer:28}],11:[function(t,e,i){let r=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];i.getImagePasses=function(t,e){let i=[],n=t%8,s=e%8,a=(t-n)/8,o=(e-s)/8;for(let t=0;t<r.length;t++){let e=r[t],h=a*e.x.length,f=o*e.y.length;for(let t=0;t<e.x.length&&e.x[t]<n;t++)h++;for(let t=0;t<e.y.length&&e.y[t]<s;t++)f++;h>0&&f>0&&i.push({width:h,height:f,index:t})}return i},i.getInterlaceIterator=function(t){return function(e,i,n){let s=e%r[n].x.length,a=(e-s)/r[n].x.length*8+r[n].x[s],o=i%r[n].y.length,h=(i-o)/r[n].y.length*8+r[n].y[o];return 4*a+h*t*4}}},{}],12:[function(t,e,i){(function(i){let r=t("util"),n=t("stream"),s=t("./constants"),a=t("./packer"),o=e.exports=function(t){n.call(this);let e=t||{};this._packer=new a(e),this._deflate=this._packer.createDeflate(),this.readable=!0};r.inherits(o,n),o.prototype.pack=function(t,e,r,n){this.emit("data",i.from(s.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(e,r)),n&&this.emit("data",this._packer.packGAMA(n));let a=this._packer.filterData(t,e,r);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(t){this.emit("data",this._packer.packIDAT(t))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(a)}}).call(this,t("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:28,stream:63,util:67}],13:[function(t,e,i){(function(i){let r=!0,n=t("zlib");n.deflateSync||(r=!1);let s=t("./constants"),a=t("./packer");e.exports=function(t,e){if(!r)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let o=e||{},h=new a(o),f=[];f.push(i.from(s.PNG_SIGNATURE)),f.push(h.packIHDR(t.width,t.height)),t.gamma&&f.push(h.packGAMA(t.gamma));let l=h.filterData(t.data,t.width,t.height),u=n.deflateSync(l,h.getDeflateOptions());if(l=null,!u||!u.length)throw new Error("bad png - invalid compressed data response");return f.push(h.packIDAT(u)),f.push(h.packIEND()),i.concat(f)}}).call(this,t("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:28,zlib:27}],14:[function(t,e,i){(function(i){let r=t("./constants"),n=t("./crc"),s=t("./bitpacker"),a=t("./filter-pack"),o=t("zlib"),h=e.exports=function(t){if(this._options=t,t.deflateChunkSize=t.deflateChunkSize||32768,t.deflateLevel=null!=t.deflateLevel?t.deflateLevel:9,t.deflateStrategy=null!=t.deflateStrategy?t.deflateStrategy:3,t.inputHasAlpha=null==t.inputHasAlpha||t.inputHasAlpha,t.deflateFactory=t.deflateFactory||o.createDeflate,t.bitDepth=t.bitDepth||8,t.colorType="number"==typeof t.colorType?t.colorType:r.COLORTYPE_COLOR_ALPHA,t.inputColorType="number"==typeof t.inputColorType?t.inputColorType:r.COLORTYPE_COLOR_ALPHA,-1===[r.COLORTYPE_GRAYSCALE,r.COLORTYPE_COLOR,r.COLORTYPE_COLOR_ALPHA,r.COLORTYPE_ALPHA].indexOf(t.colorType))throw new Error("option color type:"+t.colorType+" is not supported at present");if(-1===[r.COLORTYPE_GRAYSCALE,r.COLORTYPE_COLOR,r.COLORTYPE_COLOR_ALPHA,r.COLORTYPE_ALPHA].indexOf(t.inputColorType))throw new Error("option input color type:"+t.inputColorType+" is not supported at present");if(8!==t.bitDepth&&16!==t.bitDepth)throw new Error("option bit depth:"+t.bitDepth+" is not supported at present")};h.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},h.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},h.prototype.filterData=function(t,e,i){let n=s(t,e,i,this._options),o=r.COLORTYPE_TO_BPP_MAP[this._options.colorType],h=a(n,e,i,this._options,o);return h},h.prototype._packChunk=function(t,e){let r=e?e.length:0,s=i.alloc(r+12);return s.writeUInt32BE(r,0),s.writeUInt32BE(t,4),e&&e.copy(s,8),s.writeInt32BE(n.crc32(s.slice(4,s.length-4)),s.length-4),s},h.prototype.packGAMA=function(t){let e=i.alloc(4);return e.writeUInt32BE(Math.floor(t*r.GAMMA_DIVISION),0),this._packChunk(r.TYPE_gAMA,e)},h.prototype.packIHDR=function(t,e){let n=i.alloc(13);return n.writeUInt32BE(t,0),n.writeUInt32BE(e,4),n[8]=this._options.bitDepth,n[9]=this._options.colorType,n[10]=0,n[11]=0,n[12]=0,this._packChunk(r.TYPE_IHDR,n)},h.prototype.packIDAT=function(t){return this._packChunk(r.TYPE_IDAT,t)},h.prototype.packIEND=function(){return this._packChunk(r.TYPE_IEND,null)}}).call(this,t("buffer").Buffer)},{"./bitpacker":2,"./constants":4,"./crc":5,"./filter-pack":6,buffer:28,zlib:27}],15:[function(t,e,i){e.exports=function(t,e,i){let r=t+e-i,n=Math.abs(r-t),s=Math.abs(r-e),a=Math.abs(r-i);return n<=s&&n<=a?t:s<=a?e:i}},{}],16:[function(t,e,i){let r=t("util"),n=t("zlib"),s=t("./chunkstream"),a=t("./filter-parse-async"),o=t("./parser"),h=t("./bitmapper"),f=t("./format-normaliser"),l=e.exports=function(t){s.call(this),this._parser=new o(t,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=t,this.writable=!0,this._parser.start()};r.inherits(l,s),l.prototype._handleError=function(t){this.emit("error",t),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",function(){})),this.errord=!0},l.prototype._inflateData=function(t){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=n.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{let t=1+(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3),e=t*this._bitmapInfo.height,i=Math.max(e,n.Z_MIN_CHUNK);this._inflate=n.createInflate({chunkSize:i});let r=e,s=this.emit.bind(this,"error");this._inflate.on("error",function(t){r&&s(t)}),this._filter.on("complete",this._complete.bind(this));let a=this._filter.write.bind(this._filter);this._inflate.on("data",function(t){r&&(t.length>r&&(t=t.slice(0,r)),r-=t.length,a(t))}),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(t)},l.prototype._handleMetaData=function(t){this._metaData=t,this._bitmapInfo=Object.create(t),this._filter=new a(this._bitmapInfo)},l.prototype._handleTransColor=function(t){this._bitmapInfo.transColor=t},l.prototype._handlePalette=function(t){this._bitmapInfo.palette=t},l.prototype._simpleTransparency=function(){this._metaData.alpha=!0},l.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},l.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"))},l.prototype._complete=function(t){if(this.errord)return;let e;try{let i=h.dataToBitMap(t,this._bitmapInfo);e=f(i,this._bitmapInfo),i=null}catch(t){return void this._handleError(t)}this.emit("parsed",e)}},{"./bitmapper":1,"./chunkstream":3,"./filter-parse-async":7,"./format-normaliser":10,"./parser":18,util:67,zlib:27}],17:[function(t,e,i){(function(i){let r=!0,n=t("zlib"),s=t("./sync-inflate");n.deflateSync||(r=!1);let a=t("./sync-reader"),o=t("./filter-parse-sync"),h=t("./parser"),f=t("./bitmapper"),l=t("./format-normaliser");e.exports=function(t,e){if(!r)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let u,c,d,p=[],g=new a(t),m=new h(e,{read:g.read.bind(g),error:function(t){u=t},metadata:function(t){c=t},gamma:function(t){d=t},palette:function(t){c.palette=t},transColor:function(t){c.transColor=t},inflateData:function(t){p.push(t)},simpleTransparency:function(){c.alpha=!0}});if(m.start(),g.process(),u)throw u;let b,_=i.concat(p);if(p.length=0,c.interlace)b=n.inflateSync(_);else{let t=1+(c.width*c.bpp*c.depth+7>>3),e=t*c.height;b=s(_,{chunkSize:e,maxLength:e})}if(_=null,!b||!b.length)throw new Error("bad png - invalid inflate data response");let w=o.process(b,c);_=null;let y=f.dataToBitMap(w,c);w=null;let v=l(y,c);return c.data=v,c.gamma=d||0,c}}).call(this,t("buffer").Buffer)},{"./bitmapper":1,"./filter-parse-sync":8,"./format-normaliser":10,"./parser":18,"./sync-inflate":21,"./sync-reader":22,buffer:28,zlib:27}],18:[function(t,e,i){(function(i){let r=t("./constants"),n=t("./crc"),s=e.exports=function(t,e){this._options=t,t.checkCRC=!1!==t.checkCRC,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[r.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[r.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[r.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[r.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[r.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[r.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=e.read,this.error=e.error,this.metadata=e.metadata,this.gamma=e.gamma,this.transColor=e.transColor,this.palette=e.palette,this.parsed=e.parsed,this.inflateData=e.inflateData,this.finished=e.finished,this.simpleTransparency=e.simpleTransparency,this.headersFinished=e.headersFinished||function(){}};s.prototype.start=function(){this.read(r.PNG_SIGNATURE.length,this._parseSignature.bind(this))},s.prototype._parseSignature=function(t){let e=r.PNG_SIGNATURE;for(let i=0;i<e.length;i++)if(t[i]!==e[i])return void this.error(new Error("Invalid file signature"));this.read(8,this._parseChunkBegin.bind(this))},s.prototype._parseChunkBegin=function(t){let e=t.readUInt32BE(0),s=t.readUInt32BE(4),a="";for(let e=4;e<8;e++)a+=String.fromCharCode(t[e]);let o=Boolean(32&t[4]);if(this._hasIHDR||s===r.TYPE_IHDR){if(this._crc=new n,this._crc.write(i.from(a)),this._chunks[s])return this._chunks[s](e);o?this.read(e+4,this._skipChunk.bind(this)):this.error(new Error("Unsupported critical chunk type "+a))}else this.error(new Error("Expected IHDR on beggining"))},s.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},s.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},s.prototype._parseChunkEnd=function(t){let e=t.readInt32BE(0),i=this._crc.crc32();this._options.checkCRC&&i!==e?this.error(new Error("Crc error - "+e+" - "+i)):this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},s.prototype._handleIHDR=function(t){this.read(t,this._parseIHDR.bind(this))},s.prototype._parseIHDR=function(t){this._crc.write(t);let e=t.readUInt32BE(0),i=t.readUInt32BE(4),n=t[8],s=t[9],a=t[10],o=t[11],h=t[12];if(8!==n&&4!==n&&2!==n&&1!==n&&16!==n)return void this.error(new Error("Unsupported bit depth "+n));if(!(s in r.COLORTYPE_TO_BPP_MAP))return void this.error(new Error("Unsupported color type"));if(0!==a)return void this.error(new Error("Unsupported compression method"));if(0!==o)return void this.error(new Error("Unsupported filter method"));if(0!==h&&1!==h)return void this.error(new Error("Unsupported interlace method"));this._colorType=s;let f=r.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:e,height:i,depth:n,interlace:Boolean(h),palette:Boolean(s&r.COLORTYPE_PALETTE),color:Boolean(s&r.COLORTYPE_COLOR),alpha:Boolean(s&r.COLORTYPE_ALPHA),bpp:f,colorType:s}),this._handleChunkEnd()},s.prototype._handlePLTE=function(t){this.read(t,this._parsePLTE.bind(this))},s.prototype._parsePLTE=function(t){this._crc.write(t);let e=Math.floor(t.length/3);for(let i=0;i<e;i++)this._palette.push([t[3*i],t[3*i+1],t[3*i+2],255]);this.palette(this._palette),this._handleChunkEnd()},s.prototype._handleTRNS=function(t){this.simpleTransparency(),this.read(t,this._parseTRNS.bind(this))},s.prototype._parseTRNS=function(t){if(this._crc.write(t),this._colorType===r.COLORTYPE_PALETTE_COLOR){if(0===this._palette.length)return void this.error(new Error("Transparency chunk must be after palette"));if(t.length>this._palette.length)return void this.error(new Error("More transparent colors than palette size"));for(let e=0;e<t.length;e++)this._palette[e][3]=t[e];this.palette(this._palette)}this._colorType===r.COLORTYPE_GRAYSCALE&&this.transColor([t.readUInt16BE(0)]),this._colorType===r.COLORTYPE_COLOR&&this.transColor([t.readUInt16BE(0),t.readUInt16BE(2),t.readUInt16BE(4)]),this._handleChunkEnd()},s.prototype._handleGAMA=function(t){this.read(t,this._parseGAMA.bind(this))},s.prototype._parseGAMA=function(t){this._crc.write(t),this.gamma(t.readUInt32BE(0)/r.GAMMA_DIVISION),this._handleChunkEnd()},s.prototype._handleIDAT=function(t){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-t,this._parseIDAT.bind(this,t))},s.prototype._parseIDAT=function(t,e){if(this._crc.write(e),this._colorType===r.COLORTYPE_PALETTE_COLOR&&0===this._palette.length)throw new Error("Expected palette not found");this.inflateData(e);let i=t-e.length;i>0?this._handleIDAT(i):this._handleChunkEnd()},s.prototype._handleIEND=function(t){this.read(t,this._parseIEND.bind(this))},s.prototype._parseIEND=function(t){this._crc.write(t),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}}).call(this,t("buffer").Buffer)},{"./constants":4,"./crc":5,buffer:28}],19:[function(t,e,i){let r=t("./parser-sync"),n=t("./packer-sync");i.read=function(t,e){return r(t,e||{})},i.write=function(t,e){return n(t,e)}},{"./packer-sync":13,"./parser-sync":17}],20:[function(t,e,i){(function(e,r){let n=t("util"),s=t("stream"),a=t("./parser-async"),o=t("./packer-async"),h=t("./png-sync"),f=i.PNG=function(t){s.call(this),t=t||{},this.width=0|t.width,this.height=0|t.height,this.data=this.width>0&&this.height>0?r.alloc(4*this.width*this.height):null,t.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new a(t),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",function(t){this.data=t,this.emit("parsed",t)}.bind(this)),this._packer=new o(t),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};n.inherits(f,s),f.sync=h,f.prototype.pack=function(){return this.data&&this.data.length?(e.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this)),this):(this.emit("error","No data provided"),this)},f.prototype.parse=function(t,e){if(e){let t,i;t=function(t){this.removeListener("error",i),this.data=t,e(null,this)}.bind(this),i=function(i){this.removeListener("parsed",t),e(i,null)}.bind(this),this.once("parsed",t),this.once("error",i)}return this.end(t),this},f.prototype.write=function(t){return this._parser.write(t),!0},f.prototype.end=function(t){this._parser.end(t)},f.prototype._metadata=function(t){this.width=t.width,this.height=t.height,this.emit("metadata",t)},f.prototype._gamma=function(t){this.gamma=t},f.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},f.bitblt=function(t,e,i,r,n,s,a,o){if(r|=0,n|=0,s|=0,a|=0,o|=0,(i|=0)>t.width||r>t.height||i+n>t.width||r+s>t.height)throw new Error("bitblt reading outside image");if(a>e.width||o>e.height||a+n>e.width||o+s>e.height)throw new Error("bitblt writing outside image");for(let h=0;h<s;h++)t.data.copy(e.data,(o+h)*e.width+a<<2,(r+h)*t.width+i<<2,(r+h)*t.width+i+n<<2)},f.prototype.bitblt=function(t,e,i,r,n,s,a){return f.bitblt(this,t,e,i,r,n,s,a),this},f.adjustGamma=function(t){if(t.gamma){for(let e=0;e<t.height;e++)for(let i=0;i<t.width;i++){let r=t.width*e+i<<2;for(let e=0;e<3;e++){let i=t.data[r+e]/255;i=Math.pow(i,1/2.2/t.gamma),t.data[r+e]=Math.round(255*i)}}t.gamma=0}},f.prototype.adjustGamma=function(){f.adjustGamma(this)}}).call(this,t("_process"),t("buffer").Buffer)},{"./packer-async":12,"./parser-async":16,"./png-sync":19,_process:47,buffer:28,stream:63,util:67}],21:[function(t,e,i){(function(r,n){let s=t("assert").ok,a=t("zlib"),o=t("util"),h=t("buffer").kMaxLength;function f(t){if(!(this instanceof f))return new f(t);t&&t.chunkSize<a.Z_MIN_CHUNK&&(t.chunkSize=a.Z_MIN_CHUNK),a.Inflate.call(this,t),this._offset=void 0===this._offset?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,t&&null!=t.maxLength&&(this._maxLength=t.maxLength)}function l(t,e){e&&r.nextTick(e),t._handle&&(t._handle.close(),t._handle=null)}function u(t,e){return function(t,e){if("string"==typeof e&&(e=n.from(e)),!(e instanceof n))throw new TypeError("Not a string or buffer");let i=t._finishFlushFlag;return null==i&&(i=a.Z_FINISH),t._processChunk(e,i)}(new f(e),t)}f.prototype._processChunk=function(t,e,i){if("function"==typeof i)return a.Inflate._processChunk.call(this,t,e,i);let r,o,f=this,u=t&&t.length,c=this._chunkSize-this._offset,d=this._maxLength,p=0,g=[],m=0;function b(t,e){if(f._hadError)return;let i=c-e;if(s(i>=0,"have should not go down"),i>0){let t=f._buffer.slice(f._offset,f._offset+i);if(f._offset+=i,t.length>d&&(t=t.slice(0,d)),g.push(t),m+=t.length,0==(d-=t.length))return!1}return(0===e||f._offset>=f._chunkSize)&&(c=f._chunkSize,f._offset=0,f._buffer=n.allocUnsafe(f._chunkSize)),0===e&&(p+=u-t,u=t,!0)}this.on("error",function(t){r=t}),s(this._handle,"zlib binding closed");do{o=(o=this._handle.writeSync(e,t,p,u,this._buffer,this._offset,c))||this._writeState}while(!this._hadError&&b(o[0],o[1]));if(this._hadError)throw r;if(m>=h)throw l(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+h.toString(16)+" bytes");let _=n.concat(g,m);return l(this),_},o.inherits(f,a.Inflate),e.exports=i=u,i.Inflate=f,i.createInflate=function(t){return new f(t)},i.inflateSync=u}).call(this,t("_process"),t("buffer").Buffer)},{_process:47,assert:23,buffer:28,util:67,zlib:27}],22:[function(t,e,i){let r=e.exports=function(t){this._buffer=t,this._reads=[]};r.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e})},r.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){let t=this._reads[0];if(!this._buffer.length||!(this._buffer.length>=t.length||t.allowLess))break;{this._reads.shift();let e=this._buffer;this._buffer=e.slice(t.length),t.func.call(this,e.slice(0,t.length))}}return this._reads.length>0?new Error("There are some read requests waitng on finished stream"):this._buffer.length>0?new Error("unrecognised content at end of stream"):void 0}},{}],23:[function(t,e,i){(function(i){function r(t,e){if(t===e)return 0;for(var i=t.length,r=e.length,n=0,s=Math.min(i,r);n<s;++n)if(t[n]!==e[n]){i=t[n],r=e[n];break}return i<r?-1:r<i?1:0}function n(t){return i.Buffer&&"function"==typeof i.Buffer.isBuffer?i.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var s=t("util/"),a=Object.prototype.hasOwnProperty,o=Array.prototype.slice,h="foo"===function(){}.name;function f(t){return Object.prototype.toString.call(t)}function l(t){return!n(t)&&"function"==typeof i.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer)))}var u=e.exports=b,c=/\s*function\s+([^\(\s]*)\s*/;function d(t){if(s.isFunction(t)){if(h)return t.name;var e=t.toString(),i=e.match(c);return i&&i[1]}}function p(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function g(t){if(h||!s.isFunction(t))return s.inspect(t);var e=d(t),i=e?": "+e:"";return"[Function"+i+"]"}function m(t,e,i,r,n){throw new u.AssertionError({message:i,actual:t,expected:e,operator:r,stackStartFunction:n})}function b(t,e){t||m(t,!0,e,"==",u.ok)}function _(t,e,i,a){if(t===e)return!0;if(n(t)&&n(e))return 0===r(t,e);if(s.isDate(t)&&s.isDate(e))return t.getTime()===e.getTime();if(s.isRegExp(t)&&s.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(l(t)&&l(e)&&f(t)===f(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===r(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(n(t)!==n(e))return!1;var h=(a=a||{actual:[],expected:[]}).actual.indexOf(t);return-1!==h&&h===a.expected.indexOf(e)||(a.actual.push(t),a.expected.push(e),function(t,e,i,r){if(null==t||null==e)return!1;if(s.isPrimitive(t)||s.isPrimitive(e))return t===e;if(i&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var n=w(t),a=w(e);if(n&&!a||!n&&a)return!1;if(n)return t=o.call(t),e=o.call(e),_(t,e,i);var h,f,l=k(t),u=k(e);if(l.length!==u.length)return!1;for(l.sort(),u.sort(),f=l.length-1;f>=0;f--)if(l[f]!==u[f])return!1;for(f=l.length-1;f>=0;f--)if(h=l[f],!_(t[h],e[h],i,r))return!1;return!0}(t,e,i,a))}return i?t===e:t==e}function w(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function y(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function v(t,e,i,r){var n;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(r=i,i=null),n=function(t){var e;try{t()}catch(t){e=t}return e}(e),r=(i&&i.name?" ("+i.name+").":".")+(r?" "+r:"."),t&&!n&&m(n,i,"Missing expected exception"+r);var a="string"==typeof r,o=!t&&s.isError(n),h=!t&&n&&!i;if((o&&a&&y(n,i)||h)&&m(n,i,"Got unwanted exception"+r),t&&n&&i&&!y(n,i)||!t&&n)throw n}u.AssertionError=function(t){var e;this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=p(g((e=this).actual),128)+" "+e.operator+" "+p(g(e.expected),128),this.generatedMessage=!0);var i=t.stackStartFunction||m;if(Error.captureStackTrace)Error.captureStackTrace(this,i);else{var r=new Error;if(r.stack){var n=r.stack,s=d(i),a=n.indexOf("\n"+s);if(a>=0){var o=n.indexOf("\n",a+1);n=n.substring(o+1)}this.stack=n}}},s.inherits(u.AssertionError,Error),u.fail=m,u.ok=b,u.equal=function(t,e,i){t!=e&&m(t,e,i,"==",u.equal)},u.notEqual=function(t,e,i){t==e&&m(t,e,i,"!=",u.notEqual)},u.deepEqual=function(t,e,i){_(t,e,!1)||m(t,e,i,"deepEqual",u.deepEqual)},u.deepStrictEqual=function(t,e,i){_(t,e,!0)||m(t,e,i,"deepStrictEqual",u.deepStrictEqual)},u.notDeepEqual=function(t,e,i){_(t,e,!1)&&m(t,e,i,"notDeepEqual",u.notDeepEqual)},u.notDeepStrictEqual=function t(e,i,r){_(e,i,!0)&&m(e,i,r,"notDeepStrictEqual",t)},u.strictEqual=function(t,e,i){t!==e&&m(t,e,i,"===",u.strictEqual)},u.notStrictEqual=function(t,e,i){t===e&&m(t,e,i,"!==",u.notStrictEqual)},u.throws=function(t,e,i){v(!0,t,e,i)},u.doesNotThrow=function(t,e,i){v(!1,t,e,i)},u.ifError=function(t){if(t)throw t};var k=Object.keys||function(t){var e=[];for(var i in t)a.call(t,i)&&e.push(i);return e}}).call(this,void 0!==K?K:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"util/":67}],24:[function(t,e,i){i.byteLength=function(t){return 3*t.length/4-f(t)},i.toByteArray=function(t){var e,i,r,a,o,h=t.length;a=f(t),o=new s(3*h/4-a),i=a>0?h-4:h;var l=0;for(e=0;e<i;e+=4)r=n[t.charCodeAt(e)]<<18|n[t.charCodeAt(e+1)]<<12|n[t.charCodeAt(e+2)]<<6|n[t.charCodeAt(e+3)],o[l++]=r>>16&255,o[l++]=r>>8&255,o[l++]=255&r;return 2===a?(r=n[t.charCodeAt(e)]<<2|n[t.charCodeAt(e+1)]>>4,o[l++]=255&r):1===a&&(r=n[t.charCodeAt(e)]<<10|n[t.charCodeAt(e+1)]<<4|n[t.charCodeAt(e+2)]>>2,o[l++]=r>>8&255,o[l++]=255&r),o},i.fromByteArray=function(t){for(var e,i=t.length,n=i%3,s="",a=[],o=0,h=i-n;o<h;o+=16383)a.push(l(t,o,o+16383>h?h:o+16383));return 1===n?(e=t[i-1],s+=r[e>>2],s+=r[e<<4&63],s+="=="):2===n&&(e=(t[i-2]<<8)+t[i-1],s+=r[e>>10],s+=r[e>>4&63],s+=r[e<<2&63],s+="="),a.push(s),a.join("")};for(var r=[],n=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=a.length;o<h;++o)r[o]=a[o],n[a.charCodeAt(o)]=o;function f(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function l(t,e,i){for(var n,s,a=[],o=e;o<i;o+=3)n=(t[o]<<16)+(t[o+1]<<8)+t[o+2],a.push(r[(s=n)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return a.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},{}],25:[function(t,e,i){},{}],26:[function(t,e,i){(function(e,r){var n=t("assert"),s=t("pako/lib/zlib/zstream"),a=t("pako/lib/zlib/deflate.js"),o=t("pako/lib/zlib/inflate.js"),h=t("pako/lib/zlib/constants");for(var f in h)i[f]=h[f];function l(t){if("number"!=typeof t||t<i.DEFLATE||t>i.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=t,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}i.NONE=0,i.DEFLATE=1,i.INFLATE=2,i.GZIP=3,i.GUNZIP=4,i.DEFLATERAW=5,i.INFLATERAW=6,i.UNZIP=7,l.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,n(this.init_done,"close before init"),n(this.mode<=i.UNZIP),this.mode===i.DEFLATE||this.mode===i.GZIP||this.mode===i.DEFLATERAW?a.deflateEnd(this.strm):this.mode!==i.INFLATE&&this.mode!==i.GUNZIP&&this.mode!==i.INFLATERAW&&this.mode!==i.UNZIP||o.inflateEnd(this.strm),this.mode=i.NONE,this.dictionary=null)},l.prototype.write=function(t,e,i,r,n,s,a){return this._write(!0,t,e,i,r,n,s,a)},l.prototype.writeSync=function(t,e,i,r,n,s,a){return this._write(!1,t,e,i,r,n,s,a)},l.prototype._write=function(t,s,a,o,h,f,l,u){if(n.equal(arguments.length,8),n(this.init_done,"write before init"),n(this.mode!==i.NONE,"already finalized"),n.equal(!1,this.write_in_progress,"write already in progress"),n.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,n.equal(!1,void 0===s,"must provide flush value"),this.write_in_progress=!0,s!==i.Z_NO_FLUSH&&s!==i.Z_PARTIAL_FLUSH&&s!==i.Z_SYNC_FLUSH&&s!==i.Z_FULL_FLUSH&&s!==i.Z_FINISH&&s!==i.Z_BLOCK)throw new Error("Invalid flush value");if(null==a&&(a=r.alloc(0),h=0,o=0),this.strm.avail_in=h,this.strm.input=a,this.strm.next_in=o,this.strm.avail_out=u,this.strm.output=f,this.strm.next_out=l,this.flush=s,!t)return this._process(),this._checkError()?this._afterSync():void 0;var c=this;return e.nextTick(function(){c._process(),c._after()}),this},l.prototype._afterSync=function(){var t=this.strm.avail_out,e=this.strm.avail_in;return this.write_in_progress=!1,[e,t]},l.prototype._process=function(){var t=null;switch(this.mode){case i.DEFLATE:case i.GZIP:case i.DEFLATERAW:this.err=a.deflate(this.strm,this.flush);break;case i.UNZIP:switch(this.strm.avail_in>0&&(t=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===t)break;if(31!==this.strm.input[t]){this.mode=i.INFLATE;break}if(this.gzip_id_bytes_read=1,t++,1===this.strm.avail_in)break;case 1:if(null===t)break;139===this.strm.input[t]?(this.gzip_id_bytes_read=2,this.mode=i.GUNZIP):this.mode=i.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case i.INFLATE:case i.GUNZIP:case i.INFLATERAW:for(this.err=o.inflate(this.strm,this.flush),this.err===i.Z_NEED_DICT&&this.dictionary&&(this.err=o.inflateSetDictionary(this.strm,this.dictionary),this.err===i.Z_OK?this.err=o.inflate(this.strm,this.flush):this.err===i.Z_DATA_ERROR&&(this.err=i.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===i.GUNZIP&&this.err===i.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=o.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},l.prototype._checkError=function(){switch(this.err){case i.Z_OK:case i.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===i.Z_FINISH)return this._error("unexpected end of file"),!1;break;case i.Z_STREAM_END:break;case i.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},l.prototype._after=function(){if(this._checkError()){var t=this.strm.avail_out,e=this.strm.avail_in;this.write_in_progress=!1,this.callback(e,t),this.pending_close&&this.close()}},l.prototype._error=function(t){this.strm.msg&&(t=this.strm.msg),this.onerror(t,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},l.prototype.init=function(t,e,r,s,a){n(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),n(t>=8&&t<=15,"invalid windowBits"),n(e>=-1&&e<=9,"invalid compression level"),n(r>=1&&r<=9,"invalid memlevel"),n(s===i.Z_FILTERED||s===i.Z_HUFFMAN_ONLY||s===i.Z_RLE||s===i.Z_FIXED||s===i.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(e,t,r,s,a),this._setDictionary()},l.prototype.params=function(){throw new Error("deflateParams Not supported")},l.prototype.reset=function(){this._reset(),this._setDictionary()},l.prototype._init=function(t,e,r,n,h){switch(this.level=t,this.windowBits=e,this.memLevel=r,this.strategy=n,this.flush=i.Z_NO_FLUSH,this.err=i.Z_OK,this.mode!==i.GZIP&&this.mode!==i.GUNZIP||(this.windowBits+=16),this.mode===i.UNZIP&&(this.windowBits+=32),this.mode!==i.DEFLATERAW&&this.mode!==i.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new s,this.mode){case i.DEFLATE:case i.GZIP:case i.DEFLATERAW:this.err=a.deflateInit2(this.strm,this.level,i.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case i.INFLATE:case i.GUNZIP:case i.INFLATERAW:case i.UNZIP:this.err=o.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==i.Z_OK&&this._error("Init error"),this.dictionary=h,this.write_in_progress=!1,this.init_done=!0},l.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=i.Z_OK,this.mode){case i.DEFLATE:case i.DEFLATERAW:this.err=a.deflateSetDictionary(this.strm,this.dictionary)}this.err!==i.Z_OK&&this._error("Failed to set dictionary")}},l.prototype._reset=function(){switch(this.err=i.Z_OK,this.mode){case i.DEFLATE:case i.DEFLATERAW:case i.GZIP:this.err=a.deflateReset(this.strm);break;case i.INFLATE:case i.INFLATERAW:case i.GUNZIP:this.err=o.inflateReset(this.strm)}this.err!==i.Z_OK&&this._error("Failed to reset stream")},i.Zlib=l}).call(this,t("_process"),t("buffer").Buffer)},{_process:47,assert:23,buffer:28,"pako/lib/zlib/constants":37,"pako/lib/zlib/deflate.js":39,"pako/lib/zlib/inflate.js":41,"pako/lib/zlib/zstream":45}],27:[function(t,e,i){(function(e){var r=t("buffer").Buffer,n=t("stream").Transform,s=t("./binding"),a=t("util"),o=t("assert").ok,h=t("buffer").kMaxLength,f="Cannot create final Buffer. It would be larger than 0x"+h.toString(16)+" bytes";s.Z_MIN_WINDOWBITS=8,s.Z_MAX_WINDOWBITS=15,s.Z_DEFAULT_WINDOWBITS=15,s.Z_MIN_CHUNK=64,s.Z_MAX_CHUNK=1/0,s.Z_DEFAULT_CHUNK=16384,s.Z_MIN_MEMLEVEL=1,s.Z_MAX_MEMLEVEL=9,s.Z_DEFAULT_MEMLEVEL=8,s.Z_MIN_LEVEL=-1,s.Z_MAX_LEVEL=9,s.Z_DEFAULT_LEVEL=s.Z_DEFAULT_COMPRESSION;for(var l=Object.keys(s),u=0;u<l.length;u++){var c=l[u];c.match(/^Z/)&&Object.defineProperty(i,c,{enumerable:!0,value:s[c],writable:!1})}for(var d={Z_OK:s.Z_OK,Z_STREAM_END:s.Z_STREAM_END,Z_NEED_DICT:s.Z_NEED_DICT,Z_ERRNO:s.Z_ERRNO,Z_STREAM_ERROR:s.Z_STREAM_ERROR,Z_DATA_ERROR:s.Z_DATA_ERROR,Z_MEM_ERROR:s.Z_MEM_ERROR,Z_BUF_ERROR:s.Z_BUF_ERROR,Z_VERSION_ERROR:s.Z_VERSION_ERROR},p=Object.keys(d),g=0;g<p.length;g++){var m=p[g];d[d[m]]=m}function b(t,e,i){var n=[],s=0;function a(){for(var e;null!==(e=t.read());)n.push(e),s+=e.length;t.once("readable",a)}function o(){var e,a=null;s>=h?a=new RangeError(f):e=r.concat(n,s),n=[],t.close(),i(a,e)}t.on("error",function(e){t.removeListener("end",o),t.removeListener("readable",a),i(e)}),t.on("end",o),t.end(e),a()}function _(t,e){if("string"==typeof e&&(e=r.from(e)),!r.isBuffer(e))throw new TypeError("Not a string or buffer");var i=t._finishFlushFlag;return t._processChunk(e,i)}function w(t){if(!(this instanceof w))return new w(t);S.call(this,t,s.DEFLATE)}function y(t){if(!(this instanceof y))return new y(t);S.call(this,t,s.INFLATE)}function v(t){if(!(this instanceof v))return new v(t);S.call(this,t,s.GZIP)}function k(t){if(!(this instanceof k))return new k(t);S.call(this,t,s.GUNZIP)}function E(t){if(!(this instanceof E))return new E(t);S.call(this,t,s.DEFLATERAW)}function x(t){if(!(this instanceof x))return new x(t);S.call(this,t,s.INFLATERAW)}function I(t){if(!(this instanceof I))return new I(t);S.call(this,t,s.UNZIP)}function C(t){return t===s.Z_NO_FLUSH||t===s.Z_PARTIAL_FLUSH||t===s.Z_SYNC_FLUSH||t===s.Z_FULL_FLUSH||t===s.Z_FINISH||t===s.Z_BLOCK}function S(t,e){var a=this;if(this._opts=t=t||{},this._chunkSize=t.chunkSize||i.Z_DEFAULT_CHUNK,n.call(this,t),t.flush&&!C(t.flush))throw new Error("Invalid flush flag: "+t.flush);if(t.finishFlush&&!C(t.finishFlush))throw new Error("Invalid flush flag: "+t.finishFlush);if(this._flushFlag=t.flush||s.Z_NO_FLUSH,this._finishFlushFlag=void 0!==t.finishFlush?t.finishFlush:s.Z_FINISH,t.chunkSize&&(t.chunkSize<i.Z_MIN_CHUNK||t.chunkSize>i.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+t.chunkSize);if(t.windowBits&&(t.windowBits<i.Z_MIN_WINDOWBITS||t.windowBits>i.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+t.windowBits);if(t.level&&(t.level<i.Z_MIN_LEVEL||t.level>i.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+t.level);if(t.memLevel&&(t.memLevel<i.Z_MIN_MEMLEVEL||t.memLevel>i.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+t.memLevel);if(t.strategy&&t.strategy!=i.Z_FILTERED&&t.strategy!=i.Z_HUFFMAN_ONLY&&t.strategy!=i.Z_RLE&&t.strategy!=i.Z_FIXED&&t.strategy!=i.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+t.strategy);if(t.dictionary&&!r.isBuffer(t.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new s.Zlib(e);var o=this;this._hadError=!1,this._handle.onerror=function(t,e){A(o),o._hadError=!0;var r=new Error(t);r.errno=e,r.code=i.codes[e],o.emit("error",r)};var h=i.Z_DEFAULT_COMPRESSION;"number"==typeof t.level&&(h=t.level);var f=i.Z_DEFAULT_STRATEGY;"number"==typeof t.strategy&&(f=t.strategy),this._handle.init(t.windowBits||i.Z_DEFAULT_WINDOWBITS,h,t.memLevel||i.Z_DEFAULT_MEMLEVEL,f,t.dictionary),this._buffer=r.allocUnsafe(this._chunkSize),this._offset=0,this._level=h,this._strategy=f,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!a._handle},configurable:!0,enumerable:!0})}function A(t,i){i&&e.nextTick(i),t._handle&&(t._handle.close(),t._handle=null)}function T(t){t.emit("close")}Object.defineProperty(i,"codes",{enumerable:!0,value:Object.freeze(d),writable:!1}),i.Deflate=w,i.Inflate=y,i.Gzip=v,i.Gunzip=k,i.DeflateRaw=E,i.InflateRaw=x,i.Unzip=I,i.createDeflate=function(t){return new w(t)},i.createInflate=function(t){return new y(t)},i.createDeflateRaw=function(t){return new E(t)},i.createInflateRaw=function(t){return new x(t)},i.createGzip=function(t){return new v(t)},i.createGunzip=function(t){return new k(t)},i.createUnzip=function(t){return new I(t)},i.deflate=function(t,e,i){return"function"==typeof e&&(i=e,e={}),b(new w(e),t,i)},i.deflateSync=function(t,e){return _(new w(e),t)},i.gzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),b(new v(e),t,i)},i.gzipSync=function(t,e){return _(new v(e),t)},i.deflateRaw=function(t,e,i){return"function"==typeof e&&(i=e,e={}),b(new E(e),t,i)},i.deflateRawSync=function(t,e){return _(new E(e),t)},i.unzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),b(new I(e),t,i)},i.unzipSync=function(t,e){return _(new I(e),t)},i.inflate=function(t,e,i){return"function"==typeof e&&(i=e,e={}),b(new y(e),t,i)},i.inflateSync=function(t,e){return _(new y(e),t)},i.gunzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),b(new k(e),t,i)},i.gunzipSync=function(t,e){return _(new k(e),t)},i.inflateRaw=function(t,e,i){return"function"==typeof e&&(i=e,e={}),b(new x(e),t,i)},i.inflateRawSync=function(t,e){return _(new x(e),t)},a.inherits(S,n),S.prototype.params=function(t,r,n){if(t<i.Z_MIN_LEVEL||t>i.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+t);if(r!=i.Z_FILTERED&&r!=i.Z_HUFFMAN_ONLY&&r!=i.Z_RLE&&r!=i.Z_FIXED&&r!=i.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+r);if(this._level!==t||this._strategy!==r){var a=this;this.flush(s.Z_SYNC_FLUSH,function(){o(a._handle,"zlib binding closed"),a._handle.params(t,r),a._hadError||(a._level=t,a._strategy=r,n&&n())})}else e.nextTick(n)},S.prototype.reset=function(){return o(this._handle,"zlib binding closed"),this._handle.reset()},S.prototype._flush=function(t){this._transform(r.alloc(0),"",t)},S.prototype.flush=function(t,i){var n=this,a=this._writableState;("function"==typeof t||void 0===t&&!i)&&(i=t,t=s.Z_FULL_FLUSH),a.ended?i&&e.nextTick(i):a.ending?i&&this.once("end",i):a.needDrain?i&&this.once("drain",function(){return n.flush(t,i)}):(this._flushFlag=t,this.write(r.alloc(0),"",i))},S.prototype.close=function(t){A(this,t),e.nextTick(T,this)},S.prototype._transform=function(t,e,i){var n,a=this._writableState,o=a.ending||a.ended,h=o&&(!t||a.length===t.length);return null===t||r.isBuffer(t)?this._handle?(h?n=this._finishFlushFlag:(n=this._flushFlag,t.length>=a.length&&(this._flushFlag=this._opts.flush||s.Z_NO_FLUSH)),void this._processChunk(t,n,i)):i(new Error("zlib binding closed")):i(new Error("invalid input"))},S.prototype._processChunk=function(t,e,i){var n=t&&t.length,s=this._chunkSize-this._offset,a=0,l=this,u="function"==typeof i;if(!u){var c,d=[],p=0;this.on("error",function(t){c=t}),o(this._handle,"zlib binding closed");do{var g=this._handle.writeSync(e,t,a,n,this._buffer,this._offset,s)}while(!this._hadError&&_(g[0],g[1]));if(this._hadError)throw c;if(p>=h)throw A(this),new RangeError(f);var m=r.concat(d,p);return A(this),m}o(this._handle,"zlib binding closed");var b=this._handle.write(e,t,a,n,this._buffer,this._offset,s);function _(h,f){if(this&&(this.buffer=null,this.callback=null),!l._hadError){var c=s-f;if(o(c>=0,"have should not go down"),c>0){var g=l._buffer.slice(l._offset,l._offset+c);l._offset+=c,u?l.push(g):(d.push(g),p+=g.length)}if((0===f||l._offset>=l._chunkSize)&&(s=l._chunkSize,l._offset=0,l._buffer=r.allocUnsafe(l._chunkSize)),0===f){if(a+=n-h,n=h,!u)return!0;var m=l._handle.write(e,t,a,n,l._buffer,l._offset,l._chunkSize);return m.callback=_,void(m.buffer=t)}if(!u)return!1;i()}}b.buffer=t,b.callback=_},a.inherits(w,S),a.inherits(y,S),a.inherits(v,S),a.inherits(k,S),a.inherits(E,S),a.inherits(x,S),a.inherits(I,S)}).call(this,t("_process"))},{"./binding":26,_process:47,assert:23,buffer:28,stream:63,util:67}],28:[function(t,e,i){var r=t("base64-js"),n=t("ieee754");i.Buffer=o,i.SlowBuffer=function(t){return+t!=t&&(t=0),o.alloc(+t)},i.INSPECT_MAX_BYTES=50;var s=2147483647;function a(t){if(t>s)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return e.__proto__=o.prototype,e}function o(t,e,i){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return h(t,e,i)}function h(t,e,i){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!o.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var i=0|d(t,e),r=a(i),n=r.write(t,e);return n!==i&&(r=r.slice(0,n)),r}(t,e);if(ArrayBuffer.isView(t))return u(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(P(t,ArrayBuffer)||t&&P(t.buffer,ArrayBuffer))return function(t,e,i){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(i||0))throw new RangeError('"length" is outside of buffer bounds');var r;return(r=void 0===e&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,e):new Uint8Array(t,e,i)).__proto__=o.prototype,r}(t,e,i);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return o.from(r,e,i);var n=function(t){if(o.isBuffer(t)){var e=0|c(t.length),i=a(e);return 0===i.length?i:(t.copy(i,0,0,e),i)}return void 0!==t.length?"number"!=typeof t.length||F(t.length)?a(0):u(t):"Buffer"===t.type&&Array.isArray(t.data)?u(t.data):void 0}(t);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return o.from(t[Symbol.toPrimitive]("string"),e,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function f(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return f(t),a(t<0?0:0|c(t))}function u(t){for(var e=t.length<0?0:0|c(t.length),i=a(e),r=0;r<e;r+=1)i[r]=255&t[r];return i}function c(t){if(t>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|t}function d(t,e){if(o.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||P(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var i=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return U(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return N(t).length;default:if(n)return r?-1:U(t).length;e=(""+e).toLowerCase(),n=!0}}function p(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function g(t,e,i,r,n){if(0===t.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),F(i=+i)&&(i=n?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(n)return-1;i=t.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof e&&(e=o.from(e,r)),o.isBuffer(e))return 0===e.length?-1:m(t,e,i,r,n);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):m(t,[e],i,r,n);throw new TypeError("val must be string, number or Buffer")}function m(t,e,i,r,n){var s,a=1,o=t.length,h=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;a=2,o/=2,h/=2,i/=2}function f(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(n){var l=-1;for(s=i;s<o;s++)if(f(t,s)===f(e,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===h)return l*a}else-1!==l&&(s-=s-l),l=-1}else for(i+h>o&&(i=o-h),s=i;s>=0;s--){for(var u=!0,c=0;c<h;c++)if(f(t,s+c)!==f(e,c)){u=!1;break}if(u)return s}return-1}function b(t,e,i,r){i=Number(i)||0;var n=t.length-i;r?(r=Number(r))>n&&(r=n):r=n;var s=e.length;r>s/2&&(r=s/2);for(var a=0;a<r;++a){var o=parseInt(e.substr(2*a,2),16);if(F(o))return a;t[i+a]=o}return a}function _(t,e,i,r){return M(U(e,t.length-i),t,i,r)}function w(t,e,i,r){return M(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,r)}function y(t,e,i,r){return w(t,e,i,r)}function v(t,e,i,r){return M(N(e),t,i,r)}function k(t,e,i,r){return M(function(t,e){for(var i,r,n,s=[],a=0;a<t.length&&!((e-=2)<0);++a)i=t.charCodeAt(a),r=i>>8,n=i%256,s.push(n),s.push(r);return s}(e,t.length-i),t,i,r)}function E(t,e,i){return 0===e&&i===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,i))}function x(t,e,i){i=Math.min(t.length,i);for(var r=[],n=e;n<i;){var s,a,o,h,f=t[n],l=null,u=f>239?4:f>223?3:f>191?2:1;if(n+u<=i)switch(u){case 1:f<128&&(l=f);break;case 2:128==(192&(s=t[n+1]))&&(h=(31&f)<<6|63&s)>127&&(l=h);break;case 3:s=t[n+1],a=t[n+2],128==(192&s)&&128==(192&a)&&(h=(15&f)<<12|(63&s)<<6|63&a)>2047&&(h<55296||h>57343)&&(l=h);break;case 4:s=t[n+1],a=t[n+2],o=t[n+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&(h=(15&f)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&h<1114112&&(l=h)}null===l?(l=65533,u=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),n+=u}return function(t){var e=t.length;if(e<=I)return String.fromCharCode.apply(String,t);for(var i="",r=0;r<e;)i+=String.fromCharCode.apply(String,t.slice(r,r+=I));return i}(r)}i.kMaxLength=s,o.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),o.poolSize=8192,o.from=function(t,e,i){return h(t,e,i)},o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,o.alloc=function(t,e,i){return function(t,e,i){return f(t),t<=0?a(t):void 0!==e?"string"==typeof i?a(t).fill(e,i):a(t).fill(e):a(t)}(t,e,i)},o.allocUnsafe=function(t){return l(t)},o.allocUnsafeSlow=function(t){return l(t)},o.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==o.prototype},o.compare=function(t,e){if(P(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),P(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(t)||!o.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var i=t.length,r=e.length,n=0,s=Math.min(i,r);n<s;++n)if(t[n]!==e[n]){i=t[n],r=e[n];break}return i<r?-1:r<i?1:0},o.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return o.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var r=o.allocUnsafe(e),n=0;for(i=0;i<t.length;++i){var s=t[i];if(P(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,n),n+=s.length}return r},o.byteLength=d,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)p(this,e,e+1);return this},o.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)p(this,e,e+3),p(this,e+1,e+2);return this},o.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)p(this,e,e+7),p(this,e+1,e+6),p(this,e+2,e+5),p(this,e+3,e+4);return this},o.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?x(this,0,t):function(t,e,i){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return A(this,e,i);case"utf8":case"utf-8":return x(this,e,i);case"ascii":return C(this,e,i);case"latin1":case"binary":return S(this,e,i);case"base64":return E(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,i);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(t){if(!o.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===o.compare(this,t)},o.prototype.inspect=function(){var t="",e=i.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},o.prototype.compare=function(t,e,i,r,n){if(P(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),e<0||i>t.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&e>=i)return 0;if(r>=n)return-1;if(e>=i)return 1;if(e>>>=0,i>>>=0,r>>>=0,n>>>=0,this===t)return 0;for(var s=n-r,a=i-e,h=Math.min(s,a),f=this.slice(r,n),l=t.slice(e,i),u=0;u<h;++u)if(f[u]!==l[u]){s=f[u],a=l[u];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},o.prototype.indexOf=function(t,e,i){return g(this,t,e,i,!0)},o.prototype.lastIndexOf=function(t,e,i){return g(this,t,e,i,!1)},o.prototype.write=function(t,e,i,r){if(void 0===e)r="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)r=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(i)?(i>>>=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-e;if((void 0===i||i>n)&&(i=n),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return b(this,t,e,i);case"utf8":case"utf-8":return _(this,t,e,i);case"ascii":return w(this,t,e,i);case"latin1":case"binary":return y(this,t,e,i);case"base64":return v(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,i);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function C(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(127&t[n]);return r}function S(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(t[n]);return r}function A(t,e,i){var r,n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var s="",a=e;a<i;++a)s+=(r=t[a])<16?"0"+r.toString(16):r.toString(16);return s}function T(t,e,i){for(var r=t.slice(e,i),n="",s=0;s<r.length;s+=2)n+=String.fromCharCode(r[s]+256*r[s+1]);return n}function B(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function R(t,e,i,r,n,s){if(!o.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<s)throw new RangeError('"value" argument is out of bounds');if(i+r>t.length)throw new RangeError("Index out of range")}function L(t,e,i,r,n,s){if(i+r>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function D(t,e,i,r,s){return e=+e,i>>>=0,s||L(t,0,i,4),n.write(t,e,i,r,23,4),i+4}function z(t,e,i,r,s){return e=+e,i>>>=0,s||L(t,0,i,8),n.write(t,e,i,r,52,8),i+8}o.prototype.slice=function(t,e){var i=this.length;(t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t);var r=this.subarray(t,e);return r.__proto__=o.prototype,r},o.prototype.readUIntLE=function(t,e,i){t>>>=0,e>>>=0,i||B(t,e,this.length);for(var r=this[t],n=1,s=0;++s<e&&(n*=256);)r+=this[t+s]*n;return r},o.prototype.readUIntBE=function(t,e,i){t>>>=0,e>>>=0,i||B(t,e,this.length);for(var r=this[t+--e],n=1;e>0&&(n*=256);)r+=this[t+--e]*n;return r},o.prototype.readUInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),this[t]},o.prototype.readUInt16LE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]|this[t+1]<<8},o.prototype.readUInt16BE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]<<8|this[t+1]},o.prototype.readUInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},o.prototype.readUInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},o.prototype.readIntLE=function(t,e,i){t>>>=0,e>>>=0,i||B(t,e,this.length);for(var r=this[t],n=1,s=0;++s<e&&(n*=256);)r+=this[t+s]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*e)),r},o.prototype.readIntBE=function(t,e,i){t>>>=0,e>>>=0,i||B(t,e,this.length);for(var r=e,n=1,s=this[t+--r];r>0&&(n*=256);)s+=this[t+--r]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*e)),s},o.prototype.readInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},o.prototype.readInt16LE=function(t,e){t>>>=0,e||B(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},o.prototype.readInt16BE=function(t,e){t>>>=0,e||B(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},o.prototype.readInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},o.prototype.readInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},o.prototype.readFloatLE=function(t,e){return t>>>=0,e||B(t,4,this.length),n.read(this,t,!0,23,4)},o.prototype.readFloatBE=function(t,e){return t>>>=0,e||B(t,4,this.length),n.read(this,t,!1,23,4)},o.prototype.readDoubleLE=function(t,e){return t>>>=0,e||B(t,8,this.length),n.read(this,t,!0,52,8)},o.prototype.readDoubleBE=function(t,e){return t>>>=0,e||B(t,8,this.length),n.read(this,t,!1,52,8)},o.prototype.writeUIntLE=function(t,e,i,r){if(t=+t,e>>>=0,i>>>=0,!r){var n=Math.pow(2,8*i)-1;R(this,t,e,i,n,0)}var s=1,a=0;for(this[e]=255&t;++a<i&&(s*=256);)this[e+a]=t/s&255;return e+i},o.prototype.writeUIntBE=function(t,e,i,r){if(t=+t,e>>>=0,i>>>=0,!r){var n=Math.pow(2,8*i)-1;R(this,t,e,i,n,0)}var s=i-1,a=1;for(this[e+s]=255&t;--s>=0&&(a*=256);)this[e+s]=t/a&255;return e+i},o.prototype.writeUInt8=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,1,255,0),this[e]=255&t,e+1},o.prototype.writeUInt16LE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},o.prototype.writeUInt16BE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},o.prototype.writeUInt32LE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},o.prototype.writeUInt32BE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},o.prototype.writeIntLE=function(t,e,i,r){if(t=+t,e>>>=0,!r){var n=Math.pow(2,8*i-1);R(this,t,e,i,n-1,-n)}var s=0,a=1,o=0;for(this[e]=255&t;++s<i&&(a*=256);)t<0&&0===o&&0!==this[e+s-1]&&(o=1),this[e+s]=(t/a>>0)-o&255;return e+i},o.prototype.writeIntBE=function(t,e,i,r){if(t=+t,e>>>=0,!r){var n=Math.pow(2,8*i-1);R(this,t,e,i,n-1,-n)}var s=i-1,a=1,o=0;for(this[e+s]=255&t;--s>=0&&(a*=256);)t<0&&0===o&&0!==this[e+s+1]&&(o=1),this[e+s]=(t/a>>0)-o&255;return e+i},o.prototype.writeInt8=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},o.prototype.writeInt16LE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},o.prototype.writeInt16BE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},o.prototype.writeInt32LE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},o.prototype.writeInt32BE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},o.prototype.writeFloatLE=function(t,e,i){return D(this,t,e,!0,i)},o.prototype.writeFloatBE=function(t,e,i){return D(this,t,e,!1,i)},o.prototype.writeDoubleLE=function(t,e,i){return z(this,t,e,!0,i)},o.prototype.writeDoubleBE=function(t,e,i){return z(this,t,e,!1,i)},o.prototype.copy=function(t,e,i,r){if(!o.isBuffer(t))throw new TypeError("argument should be a Buffer");if(i||(i=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-i&&(r=t.length-e+i);var n=r-i;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,i,r);else if(this===t&&i<e&&e<r)for(var s=n-1;s>=0;--s)t[s+e]=this[s+i];else Uint8Array.prototype.set.call(t,this.subarray(i,r),e);return n},o.prototype.fill=function(t,e,i,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){var n=t.charCodeAt(0);("utf8"===r&&n<128||"latin1"===r)&&(t=n)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var s;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(s=e;s<i;++s)this[s]=t;else{var a=o.isBuffer(t)?t:o.from(t,r),h=a.length;if(0===h)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(s=0;s<i-e;++s)this[s+e]=a[s%h]}return this};var O=/[^+\/0-9A-Za-z-_]/g;function U(t,e){var i;e=e||1/0;for(var r=t.length,n=null,s=[],a=0;a<r;++a){if((i=t.charCodeAt(a))>55295&&i<57344){if(!n){if(i>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&s.push(239,191,189);continue}n=i;continue}if(i<56320){(e-=3)>-1&&s.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(e-=3)>-1&&s.push(239,191,189);if(n=null,i<128){if((e-=1)<0)break;s.push(i)}else if(i<2048){if((e-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function N(t){return r.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(O,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function M(t,e,i,r){for(var n=0;n<r&&!(n+i>=e.length||n>=t.length);++n)e[n+i]=t[n];return n}function P(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function F(t){return t!=t}},{"base64-js":24,ieee754:31}],29:[function(t,e,i){(function(t){function e(t){return Object.prototype.toString.call(t)}i.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===e(t)},i.isBoolean=function(t){return"boolean"==typeof t},i.isNull=function(t){return null===t},i.isNullOrUndefined=function(t){return null==t},i.isNumber=function(t){return"number"==typeof t},i.isString=function(t){return"string"==typeof t},i.isSymbol=function(t){return"symbol"==typeof t},i.isUndefined=function(t){return void 0===t},i.isRegExp=function(t){return"[object RegExp]"===e(t)},i.isObject=function(t){return"object"==typeof t&&null!==t},i.isDate=function(t){return"[object Date]"===e(t)},i.isError=function(t){return"[object Error]"===e(t)||t instanceof Error},i.isFunction=function(t){return"function"==typeof t},i.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},i.isBuffer=t.isBuffer}).call(this,{isBuffer:t("../../is-buffer/index.js")})},{"../../is-buffer/index.js":33}],30:[function(t,e,i){var r=Object.create||function(t){var e=function(){};return e.prototype=t,new e},n=Object.keys||function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e);return e},s=Function.prototype.bind||function(t){var e=this;return function(){return e.apply(t,arguments)}};function a(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=r(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0;var o,h=10;try{var f={};Object.defineProperty&&Object.defineProperty(f,"x",{value:0}),o=0===f.x}catch(t){o=!1}function l(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function u(t,e,i,n){var s,a,o;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),o=a[e]):(a=t._events=r(null),t._eventsCount=0),o){if("function"==typeof o?o=a[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),!o.warned&&(s=l(t))&&s>0&&o.length>s){o.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=o.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",h.name,h.message)}}else o=a[e]=i,++t._eventsCount;return t}function c(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function d(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=s.call(c,r);return n.listener=i,r.wrapFn=n,n}function p(t,e,i){var r=t._events;if(!r)return[];var n=r[e];return n?"function"==typeof n?i?[n.listener||n]:[n]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(n):m(n,n.length):[]}function g(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function m(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}o?Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');h=t}}):a.defaultMaxListeners=h,a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(t){var e,i,r,n,s,a,o="error"===t;if(a=this._events)o=o&&null==a.error;else if(!o)return!1;if(o){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var h=new Error('Unhandled "error" event. ('+e+")");throw h.context=e,h}if(!(i=a[t]))return!1;var f="function"==typeof i;switch(r=arguments.length){case 1:!function(t,e,i){if(e)t.call(i);else for(var r=t.length,n=m(t,r),s=0;s<r;++s)n[s].call(i)}(i,f,this);break;case 2:!function(t,e,i,r){if(e)t.call(i,r);else for(var n=t.length,s=m(t,n),a=0;a<n;++a)s[a].call(i,r)}(i,f,this,arguments[1]);break;case 3:!function(t,e,i,r,n){if(e)t.call(i,r,n);else for(var s=t.length,a=m(t,s),o=0;o<s;++o)a[o].call(i,r,n)}(i,f,this,arguments[1],arguments[2]);break;case 4:!function(t,e,i,r,n,s){if(e)t.call(i,r,n,s);else for(var a=t.length,o=m(t,a),h=0;h<a;++h)o[h].call(i,r,n,s)}(i,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(r-1),s=1;s<r;s++)n[s-1]=arguments[s];!function(t,e,i,r){if(e)t.apply(i,r);else for(var n=t.length,s=m(t,n),a=0;a<n;++a)s[a].apply(i,r)}(i,f,this,n)}return!0},a.prototype.addListener=function(t,e){return u(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return u(this,t,e,!0)},a.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,d(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,d(this,t,e)),this},a.prototype.removeListener=function(t,e){var i,n,s,a,o;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(i=n[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=r(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(s=-1,a=i.length-1;a>=0;a--)if(i[a]===e||i[a].listener===e){o=i[a].listener,s=a;break}if(s<0)return this;0===s?i.shift():function(t,e){for(var i=e,r=i+1,n=t.length;r<n;i+=1,r+=1)t[i]=t[r];t.pop()}(i,s),1===i.length&&(n[t]=i[0]),n.removeListener&&this.emit("removeListener",t,o||e)}return this},a.prototype.removeAllListeners=function(t){var e,i,s;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=r(null),this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=r(null):delete i[t]),this;if(0===arguments.length){var a,o=n(i);for(s=0;s<o.length;++s)"removeListener"!==(a=o[s])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=r(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this},a.prototype.listeners=function(t){return p(this,t,!0)},a.prototype.rawListeners=function(t){return p(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):g.call(t,e)},a.prototype.listenerCount=g,a.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],31:[function(t,e,i){i.read=function(t,e,i,r,n){var s,a,o=8*n-r-1,h=(1<<o)-1,f=h>>1,l=-7,u=i?n-1:0,c=i?-1:1,d=t[e+u];for(u+=c,s=d&(1<<-l)-1,d>>=-l,l+=o;l>0;s=256*s+t[e+u],u+=c,l-=8);for(a=s&(1<<-l)-1,s>>=-l,l+=r;l>0;a=256*a+t[e+u],u+=c,l-=8);if(0===s)s=1-f;else{if(s===h)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),s-=f}return(d?-1:1)*a*Math.pow(2,s-r)},i.write=function(t,e,i,r,n,s){var a,o,h,f=8*s-n-1,l=(1<<f)-1,u=l>>1,c=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-a))<1&&(a--,h*=2),(e+=a+u>=1?c/h:c*Math.pow(2,1-u))*h>=2&&(a++,h/=2),a+u>=l?(o=0,a=l):a+u>=1?(o=(e*h-1)*Math.pow(2,n),a+=u):(o=e*Math.pow(2,u-1)*Math.pow(2,n),a=0));n>=8;t[i+d]=255&o,d+=p,o/=256,n-=8);for(a=a<<n|o,f+=n;f>0;t[i+d]=255&a,d+=p,a/=256,f-=8);t[i+d-p]|=128*g}},{}],32:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],33:[function(t,e,i){function r(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}e.exports=function(t){return null!=t&&(r(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&r(t.slice(0,0))}(t)||!!t._isBuffer)}},{}],34:[function(t,e,i){var r={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},{}],35:[function(t,e,i){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)n(i,r)&&(t[r]=i[r])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var s={arraySet:function(t,e,i,r,n){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+r),n);else for(var s=0;s<r;s++)t[n+s]=e[i+s]},flattenChunks:function(t){var e,i,r,n,s,a;for(r=0,e=0,i=t.length;e<i;e++)r+=t[e].length;for(a=new Uint8Array(r),n=0,e=0,i=t.length;e<i;e++)s=t[e],a.set(s,n),n+=s.length;return a}},a={arraySet:function(t,e,i,r,n){for(var s=0;s<r;s++)t[n+s]=e[i+s]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,s)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(r)},{}],36:[function(t,e,i){e.exports=function(t,e,i,r){for(var n=65535&t|0,s=t>>>16&65535|0,a=0;0!==i;){i-=a=i>2e3?2e3:i;do{n=n+e[r++]|0,s=s+n|0}while(--a);n%=65521,s%=65521}return n|s<<16|0}},{}],37:[function(t,e,i){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],38:[function(t,e,i){var r=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e,i,n){var s=r,a=n+i;t^=-1;for(var o=n;o<a;o++)t=t>>>8^s[255&(t^e[o])];return-1^t}},{}],39:[function(t,e,i){var r,n=t("../utils/common"),s=t("./trees"),a=t("./adler32"),o=t("./crc32"),h=t("./messages"),f=0,l=1,u=3,c=4,d=5,p=0,g=1,m=-2,b=-3,_=-5,w=-1,y=1,v=2,k=3,E=4,x=0,I=2,C=8,S=9,A=15,T=8,B=286,R=30,L=19,D=2*B+1,z=15,O=3,U=258,N=U+O+1,M=32,P=42,F=69,j=73,Z=91,H=103,W=113,G=666,q=1,Y=2,V=3,X=4,K=3;function Q(t,e){return t.msg=h[e],e}function J(t){return(t<<1)-(t>4?9:0)}function $(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(n.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function et(t,e){s._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,tt(t.strm)}function it(t,e){t.pending_buf[t.pending++]=e}function rt(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function nt(t,e){var i,r,n=t.max_chain_length,s=t.strstart,a=t.prev_length,o=t.nice_match,h=t.strstart>t.w_size-N?t.strstart-(t.w_size-N):0,f=t.window,l=t.w_mask,u=t.prev,c=t.strstart+U,d=f[s+a-1],p=f[s+a];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do{if(f[(i=e)+a]===p&&f[i+a-1]===d&&f[i]===f[s]&&f[++i]===f[s+1]){s+=2,i++;do{}while(f[++s]===f[++i]&&f[++s]===f[++i]&&f[++s]===f[++i]&&f[++s]===f[++i]&&f[++s]===f[++i]&&f[++s]===f[++i]&&f[++s]===f[++i]&&f[++s]===f[++i]&&s<c);if(r=U-(c-s),s=c-U,r>a){if(t.match_start=e,a=r,r>=o)break;d=f[s+a-1],p=f[s+a]}}}while((e=u[e&l])>h&&0!=--n);return a<=t.lookahead?a:t.lookahead}function st(t){var e,i,r,s,h,f,l,u,c,d,p=t.w_size;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-N)){n.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,i=t.hash_size,e=i;do{r=t.head[--e],t.head[e]=r>=p?r-p:0}while(--i);e=i=p;do{r=t.prev[--e],t.prev[e]=r>=p?r-p:0}while(--i);s+=p}if(0===t.strm.avail_in)break;if(f=t.strm,l=t.window,u=t.strstart+t.lookahead,c=s,d=void 0,(d=f.avail_in)>c&&(d=c),i=0===d?0:(f.avail_in-=d,n.arraySet(l,f.input,f.next_in,d,u),1===f.state.wrap?f.adler=a(f.adler,l,d,u):2===f.state.wrap&&(f.adler=o(f.adler,l,d,u)),f.next_in+=d,f.total_in+=d,d),t.lookahead+=i,t.lookahead+t.insert>=O)for(h=t.strstart-t.insert,t.ins_h=t.window[h],t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+O-1])&t.hash_mask,t.prev[h&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=h,h++,t.insert--,!(t.lookahead+t.insert<O)););}while(t.lookahead<N&&0!==t.strm.avail_in)}function at(t,e){for(var i,r;;){if(t.lookahead<N){if(st(t),t.lookahead<N&&e===f)return q;if(0===t.lookahead)break}if(i=0,t.lookahead>=O&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-N&&(t.match_length=nt(t,i)),t.match_length>=O)if(r=s._tr_tally(t,t.strstart-t.match_start,t.match_length-O),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=O){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=t.strstart<O-1?t.strstart:O-1,e===c?(et(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:Y}function ot(t,e){for(var i,r,n;;){if(t.lookahead<N){if(st(t),t.lookahead<N&&e===f)return q;if(0===t.lookahead)break}if(i=0,t.lookahead>=O&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=O-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-N&&(t.match_length=nt(t,i),t.match_length<=5&&(t.strategy===y||t.match_length===O&&t.strstart-t.match_start>4096)&&(t.match_length=O-1)),t.prev_length>=O&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-O,r=s._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-O),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=O-1,t.strstart++,r&&(et(t,!1),0===t.strm.avail_out))return q}else if(t.match_available){if((r=s._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return q}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=s._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<O-1?t.strstart:O-1,e===c?(et(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:Y}function ht(t,e,i,r,n){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=r,this.func=n}function ft(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=C,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*D),this.dyn_dtree=new n.Buf16(2*(2*R+1)),this.bl_tree=new n.Buf16(2*(2*L+1)),$(this.dyn_ltree),$(this.dyn_dtree),$(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(z+1),this.heap=new n.Buf16(2*B+1),$(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*B+1),$(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function lt(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=I,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?P:W,t.adler=2===e.wrap?0:1,e.last_flush=f,s._tr_init(e),p):Q(t,m)}function ut(t){var e,i=lt(t);return i===p&&((e=t.state).window_size=2*e.w_size,$(e.head),e.max_lazy_match=r[e.level].max_lazy,e.good_match=r[e.level].good_length,e.nice_match=r[e.level].nice_length,e.max_chain_length=r[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=O-1,e.match_available=0,e.ins_h=0),i}function ct(t,e,i,r,s,a){if(!t)return m;var o=1;if(e===w&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),s<1||s>S||i!==C||r<8||r>15||e<0||e>9||a<0||a>E)return Q(t,m);8===r&&(r=9);var h=new ft;return t.state=h,h.strm=t,h.wrap=o,h.gzhead=null,h.w_bits=r,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=s+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+O-1)/O),h.window=new n.Buf8(2*h.w_size),h.head=new n.Buf16(h.hash_size),h.prev=new n.Buf16(h.w_size),h.lit_bufsize=1<<s+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new n.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=e,h.strategy=a,h.method=i,ut(t)}r=[new ht(0,0,0,0,function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(st(t),0===t.lookahead&&e===f)return q;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+i;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,et(t,!1),0===t.strm.avail_out))return q;if(t.strstart-t.block_start>=t.w_size-N&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=0,e===c?(et(t,!0),0===t.strm.avail_out?V:X):(t.strstart>t.block_start&&(et(t,!1),t.strm.avail_out),q)}),new ht(4,4,8,4,at),new ht(4,5,16,8,at),new ht(4,6,32,32,at),new ht(4,4,16,16,ot),new ht(8,16,32,32,ot),new ht(8,16,128,128,ot),new ht(8,32,128,256,ot),new ht(32,128,258,1024,ot),new ht(32,258,258,4096,ot)],i.deflateInit=function(t,e){return ct(t,e,C,A,T,x)},i.deflateInit2=ct,i.deflateReset=ut,i.deflateResetKeep=lt,i.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?m:(t.state.gzhead=e,p):m},i.deflate=function(t,e){var i,n,a,h;if(!t||!t.state||e>d||e<0)return t?Q(t,m):m;if(n=t.state,!t.output||!t.input&&0!==t.avail_in||n.status===G&&e!==c)return Q(t,0===t.avail_out?_:m);if(n.strm=t,i=n.last_flush,n.last_flush=e,n.status===P)if(2===n.wrap)t.adler=0,it(n,31),it(n,139),it(n,8),n.gzhead?(it(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),it(n,255&n.gzhead.time),it(n,n.gzhead.time>>8&255),it(n,n.gzhead.time>>16&255),it(n,n.gzhead.time>>24&255),it(n,9===n.level?2:n.strategy>=v||n.level<2?4:0),it(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(it(n,255&n.gzhead.extra.length),it(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=o(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=F):(it(n,0),it(n,0),it(n,0),it(n,0),it(n,0),it(n,9===n.level?2:n.strategy>=v||n.level<2?4:0),it(n,K),n.status=W);else{var b=C+(n.w_bits-8<<4)<<8,w=-1;w=n.strategy>=v||n.level<2?0:n.level<6?1:6===n.level?2:3,b|=w<<6,0!==n.strstart&&(b|=M),b+=31-b%31,n.status=W,rt(n,b),0!==n.strstart&&(rt(n,t.adler>>>16),rt(n,65535&t.adler)),t.adler=1}if(n.status===F)if(n.gzhead.extra){for(a=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),tt(t),a=n.pending,n.pending!==n.pending_buf_size));)it(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=j)}else n.status=j;if(n.status===j)if(n.gzhead.name){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),tt(t),a=n.pending,n.pending===n.pending_buf_size)){h=1;break}h=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,it(n,h)}while(0!==h);n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),0===h&&(n.gzindex=0,n.status=Z)}else n.status=Z;if(n.status===Z)if(n.gzhead.comment){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),tt(t),a=n.pending,n.pending===n.pending_buf_size)){h=1;break}h=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,it(n,h)}while(0!==h);n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),0===h&&(n.status=H)}else n.status=H;if(n.status===H&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&tt(t),n.pending+2<=n.pending_buf_size&&(it(n,255&t.adler),it(n,t.adler>>8&255),t.adler=0,n.status=W)):n.status=W),0!==n.pending){if(tt(t),0===t.avail_out)return n.last_flush=-1,p}else if(0===t.avail_in&&J(e)<=J(i)&&e!==c)return Q(t,_);if(n.status===G&&0!==t.avail_in)return Q(t,_);if(0!==t.avail_in||0!==n.lookahead||e!==f&&n.status!==G){var y=n.strategy===v?function(t,e){for(var i;;){if(0===t.lookahead&&(st(t),0===t.lookahead)){if(e===f)return q;break}if(t.match_length=0,i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=0,e===c?(et(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:Y}(n,e):n.strategy===k?function(t,e){for(var i,r,n,a,o=t.window;;){if(t.lookahead<=U){if(st(t),t.lookahead<=U&&e===f)return q;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=O&&t.strstart>0&&(n=t.strstart-1,(r=o[n])===o[++n]&&r===o[++n]&&r===o[++n])){a=t.strstart+U;do{}while(r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&n<a);t.match_length=U-(a-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=O?(i=s._tr_tally(t,1,t.match_length-O),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=0,e===c?(et(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:Y}(n,e):r[n.level].func(n,e);if(y!==V&&y!==X||(n.status=G),y===q||y===V)return 0===t.avail_out&&(n.last_flush=-1),p;if(y===Y&&(e===l?s._tr_align(n):e!==d&&(s._tr_stored_block(n,0,0,!1),e===u&&($(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),tt(t),0===t.avail_out))return n.last_flush=-1,p}return e!==c?p:n.wrap<=0?g:(2===n.wrap?(it(n,255&t.adler),it(n,t.adler>>8&255),it(n,t.adler>>16&255),it(n,t.adler>>24&255),it(n,255&t.total_in),it(n,t.total_in>>8&255),it(n,t.total_in>>16&255),it(n,t.total_in>>24&255)):(rt(n,t.adler>>>16),rt(n,65535&t.adler)),tt(t),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?p:g)},i.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==P&&e!==F&&e!==j&&e!==Z&&e!==H&&e!==W&&e!==G?Q(t,m):(t.state=null,e===W?Q(t,b):p):m},i.deflateSetDictionary=function(t,e){var i,r,s,o,h,f,l,u,c=e.length;if(!t||!t.state)return m;if(i=t.state,2===(o=i.wrap)||1===o&&i.status!==P||i.lookahead)return m;for(1===o&&(t.adler=a(t.adler,e,c,0)),i.wrap=0,c>=i.w_size&&(0===o&&($(i.head),i.strstart=0,i.block_start=0,i.insert=0),u=new n.Buf8(i.w_size),n.arraySet(u,e,c-i.w_size,i.w_size,0),e=u,c=i.w_size),h=t.avail_in,f=t.next_in,l=t.input,t.avail_in=c,t.next_in=0,t.input=e,st(i);i.lookahead>=O;){r=i.strstart,s=i.lookahead-(O-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+O-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++}while(--s);i.strstart=r,i.lookahead=O-1,st(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=O-1,i.match_available=0,t.next_in=f,t.input=l,t.avail_in=h,i.wrap=o,p},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":35,"./adler32":36,"./crc32":38,"./messages":43,"./trees":44}],40:[function(t,e,i){e.exports=function(t,e){var i,r,n,s,a,o,h,f,l,u,c,d,p,g,m,b,_,w,y,v,k,E,x,I,C;i=t.state,r=t.next_in,I=t.input,n=r+(t.avail_in-5),s=t.next_out,C=t.output,a=s-(e-t.avail_out),o=s+(t.avail_out-257),h=i.dmax,f=i.wsize,l=i.whave,u=i.wnext,c=i.window,d=i.hold,p=i.bits,g=i.lencode,m=i.distcode,b=(1<<i.lenbits)-1,_=(1<<i.distbits)-1;t:do{p<15&&(d+=I[r++]<<p,p+=8,d+=I[r++]<<p,p+=8),w=g[d&b];e:for(;;){if(d>>>=y=w>>>24,p-=y,0==(y=w>>>16&255))C[s++]=65535&w;else{if(!(16&y)){if(0==(64&y)){w=g[(65535&w)+(d&(1<<y)-1)];continue e}if(32&y){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}v=65535&w,(y&=15)&&(p<y&&(d+=I[r++]<<p,p+=8),v+=d&(1<<y)-1,d>>>=y,p-=y),p<15&&(d+=I[r++]<<p,p+=8,d+=I[r++]<<p,p+=8),w=m[d&_];i:for(;;){if(d>>>=y=w>>>24,p-=y,!(16&(y=w>>>16&255))){if(0==(64&y)){w=m[(65535&w)+(d&(1<<y)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(k=65535&w,p<(y&=15)&&(d+=I[r++]<<p,(p+=8)<y&&(d+=I[r++]<<p,p+=8)),(k+=d&(1<<y)-1)>h){t.msg="invalid distance too far back",i.mode=30;break t}if(d>>>=y,p-=y,k>(y=s-a)){if((y=k-y)>l&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(E=0,x=c,0===u){if(E+=f-y,y<v){v-=y;do{C[s++]=c[E++]}while(--y);E=s-k,x=C}}else if(u<y){if(E+=f+u-y,(y-=u)<v){v-=y;do{C[s++]=c[E++]}while(--y);if(E=0,u<v){v-=y=u;do{C[s++]=c[E++]}while(--y);E=s-k,x=C}}}else if(E+=u-y,y<v){v-=y;do{C[s++]=c[E++]}while(--y);E=s-k,x=C}for(;v>2;)C[s++]=x[E++],C[s++]=x[E++],C[s++]=x[E++],v-=3;v&&(C[s++]=x[E++],v>1&&(C[s++]=x[E++]))}else{E=s-k;do{C[s++]=C[E++],C[s++]=C[E++],C[s++]=C[E++],v-=3}while(v>2);v&&(C[s++]=C[E++],v>1&&(C[s++]=C[E++]))}break}}break}}while(r<n&&s<o);r-=v=p>>3,d&=(1<<(p-=v<<3))-1,t.next_in=r,t.next_out=s,t.avail_in=r<n?n-r+5:5-(r-n),t.avail_out=s<o?o-s+257:257-(s-o),i.hold=d,i.bits=p}},{}],41:[function(t,e,i){var r=t("../utils/common"),n=t("./adler32"),s=t("./crc32"),a=t("./inffast"),o=t("./inftrees"),h=0,f=1,l=2,u=4,c=5,d=6,p=0,g=1,m=2,b=-2,_=-3,w=-4,y=-5,v=8,k=1,E=2,x=3,I=4,C=5,S=6,A=7,T=8,B=9,R=10,L=11,D=12,z=13,O=14,U=15,N=16,M=17,P=18,F=19,j=20,Z=21,H=22,W=23,G=24,q=25,Y=26,V=27,X=28,K=29,Q=30,J=31,$=32,tt=852,et=592,it=15;function rt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function nt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function st(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=k,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(tt),e.distcode=e.distdyn=new r.Buf32(et),e.sane=1,e.back=-1,p):b}function at(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,st(t)):b}function ot(t,e){var i,r;return t&&t.state?(r=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?b:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=i,r.wbits=e,at(t))):b}function ht(t,e){var i,r;return t?(r=new nt,t.state=r,r.window=null,(i=ot(t,e))!==p&&(t.state=null),i):b}var ft,lt,ut=!0;function ct(t){if(ut){var e;for(ft=new r.Buf32(512),lt=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(f,t.lens,0,288,ft,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(l,t.lens,0,32,lt,0,t.work,{bits:5}),ut=!1}t.lencode=ft,t.lenbits=9,t.distcode=lt,t.distbits=5}function dt(t,e,i,n){var s,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),n>=a.wsize?(r.arraySet(a.window,e,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((s=a.wsize-a.wnext)>n&&(s=n),r.arraySet(a.window,e,i-n,s,a.wnext),(n-=s)?(r.arraySet(a.window,e,i-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0}i.inflateReset=at,i.inflateReset2=ot,i.inflateResetKeep=st,i.inflateInit=function(t){return ht(t,it)},i.inflateInit2=ht,i.inflate=function(t,e){var i,tt,et,it,nt,st,at,ot,ht,ft,lt,ut,pt,gt,mt,bt,_t,wt,yt,vt,kt,Et,xt,It,Ct=0,St=new r.Buf8(4),At=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return b;(i=t.state).mode===D&&(i.mode=z),nt=t.next_out,et=t.output,at=t.avail_out,it=t.next_in,tt=t.input,st=t.avail_in,ot=i.hold,ht=i.bits,ft=st,lt=at,Et=p;t:for(;;)switch(i.mode){case k:if(0===i.wrap){i.mode=z;break}for(;ht<16;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}if(2&i.wrap&&35615===ot){i.check=0,St[0]=255&ot,St[1]=ot>>>8&255,i.check=s(i.check,St,2,0),ot=0,ht=0,i.mode=E;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&ot)<<8)+(ot>>8))%31){t.msg="incorrect header check",i.mode=Q;break}if((15&ot)!==v){t.msg="unknown compression method",i.mode=Q;break}if(ht-=4,kt=8+(15&(ot>>>=4)),0===i.wbits)i.wbits=kt;else if(kt>i.wbits){t.msg="invalid window size",i.mode=Q;break}i.dmax=1<<kt,t.adler=i.check=1,i.mode=512&ot?R:D,ot=0,ht=0;break;case E:for(;ht<16;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}if(i.flags=ot,(255&i.flags)!==v){t.msg="unknown compression method",i.mode=Q;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=Q;break}i.head&&(i.head.text=ot>>8&1),512&i.flags&&(St[0]=255&ot,St[1]=ot>>>8&255,i.check=s(i.check,St,2,0)),ot=0,ht=0,i.mode=x;case x:for(;ht<32;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}i.head&&(i.head.time=ot),512&i.flags&&(St[0]=255&ot,St[1]=ot>>>8&255,St[2]=ot>>>16&255,St[3]=ot>>>24&255,i.check=s(i.check,St,4,0)),ot=0,ht=0,i.mode=I;case I:for(;ht<16;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}i.head&&(i.head.xflags=255&ot,i.head.os=ot>>8),512&i.flags&&(St[0]=255&ot,St[1]=ot>>>8&255,i.check=s(i.check,St,2,0)),ot=0,ht=0,i.mode=C;case C:if(1024&i.flags){for(;ht<16;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}i.length=ot,i.head&&(i.head.extra_len=ot),512&i.flags&&(St[0]=255&ot,St[1]=ot>>>8&255,i.check=s(i.check,St,2,0)),ot=0,ht=0}else i.head&&(i.head.extra=null);i.mode=S;case S:if(1024&i.flags&&((ut=i.length)>st&&(ut=st),ut&&(i.head&&(kt=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),r.arraySet(i.head.extra,tt,it,ut,kt)),512&i.flags&&(i.check=s(i.check,tt,ut,it)),st-=ut,it+=ut,i.length-=ut),i.length))break t;i.length=0,i.mode=A;case A:if(2048&i.flags){if(0===st)break t;ut=0;do{kt=tt[it+ut++],i.head&&kt&&i.length<65536&&(i.head.name+=String.fromCharCode(kt))}while(kt&&ut<st);if(512&i.flags&&(i.check=s(i.check,tt,ut,it)),st-=ut,it+=ut,kt)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=T;case T:if(4096&i.flags){if(0===st)break t;ut=0;do{kt=tt[it+ut++],i.head&&kt&&i.length<65536&&(i.head.comment+=String.fromCharCode(kt))}while(kt&&ut<st);if(512&i.flags&&(i.check=s(i.check,tt,ut,it)),st-=ut,it+=ut,kt)break t}else i.head&&(i.head.comment=null);i.mode=B;case B:if(512&i.flags){for(;ht<16;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}if(ot!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Q;break}ot=0,ht=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=D;break;case R:for(;ht<32;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}t.adler=i.check=rt(ot),ot=0,ht=0,i.mode=L;case L:if(0===i.havedict)return t.next_out=nt,t.avail_out=at,t.next_in=it,t.avail_in=st,i.hold=ot,i.bits=ht,m;t.adler=i.check=1,i.mode=D;case D:if(e===c||e===d)break t;case z:if(i.last){ot>>>=7&ht,ht-=7&ht,i.mode=V;break}for(;ht<3;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}switch(i.last=1&ot,ht-=1,3&(ot>>>=1)){case 0:i.mode=O;break;case 1:if(ct(i),i.mode=j,e===d){ot>>>=2,ht-=2;break t}break;case 2:i.mode=M;break;case 3:t.msg="invalid block type",i.mode=Q}ot>>>=2,ht-=2;break;case O:for(ot>>>=7&ht,ht-=7&ht;ht<32;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}if((65535&ot)!=(ot>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Q;break}if(i.length=65535&ot,ot=0,ht=0,i.mode=U,e===d)break t;case U:i.mode=N;case N:if(ut=i.length){if(ut>st&&(ut=st),ut>at&&(ut=at),0===ut)break t;r.arraySet(et,tt,it,ut,nt),st-=ut,it+=ut,at-=ut,nt+=ut,i.length-=ut;break}i.mode=D;break;case M:for(;ht<14;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}if(i.nlen=257+(31&ot),ot>>>=5,ht-=5,i.ndist=1+(31&ot),ot>>>=5,ht-=5,i.ncode=4+(15&ot),ot>>>=4,ht-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Q;break}i.have=0,i.mode=P;case P:for(;i.have<i.ncode;){for(;ht<3;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}i.lens[At[i.have++]]=7&ot,ot>>>=3,ht-=3}for(;i.have<19;)i.lens[At[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,xt={bits:i.lenbits},Et=o(h,i.lens,0,19,i.lencode,0,i.work,xt),i.lenbits=xt.bits,Et){t.msg="invalid code lengths set",i.mode=Q;break}i.have=0,i.mode=F;case F:for(;i.have<i.nlen+i.ndist;){for(;Ct=i.lencode[ot&(1<<i.lenbits)-1],bt=Ct>>>16&255,_t=65535&Ct,!((mt=Ct>>>24)<=ht);){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}if(_t<16)ot>>>=mt,ht-=mt,i.lens[i.have++]=_t;else{if(16===_t){for(It=mt+2;ht<It;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}if(ot>>>=mt,ht-=mt,0===i.have){t.msg="invalid bit length repeat",i.mode=Q;break}kt=i.lens[i.have-1],ut=3+(3&ot),ot>>>=2,ht-=2}else if(17===_t){for(It=mt+3;ht<It;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}ht-=mt,kt=0,ut=3+(7&(ot>>>=mt)),ot>>>=3,ht-=3}else{for(It=mt+7;ht<It;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}ht-=mt,kt=0,ut=11+(127&(ot>>>=mt)),ot>>>=7,ht-=7}if(i.have+ut>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Q;break}for(;ut--;)i.lens[i.have++]=kt}}if(i.mode===Q)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=Q;break}if(i.lenbits=9,xt={bits:i.lenbits},Et=o(f,i.lens,0,i.nlen,i.lencode,0,i.work,xt),i.lenbits=xt.bits,Et){t.msg="invalid literal/lengths set",i.mode=Q;break}if(i.distbits=6,i.distcode=i.distdyn,xt={bits:i.distbits},Et=o(l,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,xt),i.distbits=xt.bits,Et){t.msg="invalid distances set",i.mode=Q;break}if(i.mode=j,e===d)break t;case j:i.mode=Z;case Z:if(st>=6&&at>=258){t.next_out=nt,t.avail_out=at,t.next_in=it,t.avail_in=st,i.hold=ot,i.bits=ht,a(t,lt),nt=t.next_out,et=t.output,at=t.avail_out,it=t.next_in,tt=t.input,st=t.avail_in,ot=i.hold,ht=i.bits,i.mode===D&&(i.back=-1);break}for(i.back=0;Ct=i.lencode[ot&(1<<i.lenbits)-1],bt=Ct>>>16&255,_t=65535&Ct,!((mt=Ct>>>24)<=ht);){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}if(bt&&0==(240&bt)){for(wt=mt,yt=bt,vt=_t;Ct=i.lencode[vt+((ot&(1<<wt+yt)-1)>>wt)],bt=Ct>>>16&255,_t=65535&Ct,!(wt+(mt=Ct>>>24)<=ht);){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}ot>>>=wt,ht-=wt,i.back+=wt}if(ot>>>=mt,ht-=mt,i.back+=mt,i.length=_t,0===bt){i.mode=Y;break}if(32&bt){i.back=-1,i.mode=D;break}if(64&bt){t.msg="invalid literal/length code",i.mode=Q;break}i.extra=15&bt,i.mode=H;case H:if(i.extra){for(It=i.extra;ht<It;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}i.length+=ot&(1<<i.extra)-1,ot>>>=i.extra,ht-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=W;case W:for(;Ct=i.distcode[ot&(1<<i.distbits)-1],bt=Ct>>>16&255,_t=65535&Ct,!((mt=Ct>>>24)<=ht);){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}if(0==(240&bt)){for(wt=mt,yt=bt,vt=_t;Ct=i.distcode[vt+((ot&(1<<wt+yt)-1)>>wt)],bt=Ct>>>16&255,_t=65535&Ct,!(wt+(mt=Ct>>>24)<=ht);){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}ot>>>=wt,ht-=wt,i.back+=wt}if(ot>>>=mt,ht-=mt,i.back+=mt,64&bt){t.msg="invalid distance code",i.mode=Q;break}i.offset=_t,i.extra=15&bt,i.mode=G;case G:if(i.extra){for(It=i.extra;ht<It;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}i.offset+=ot&(1<<i.extra)-1,ot>>>=i.extra,ht-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Q;break}i.mode=q;case q:if(0===at)break t;if(ut=lt-at,i.offset>ut){if((ut=i.offset-ut)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Q;break}ut>i.wnext?(ut-=i.wnext,pt=i.wsize-ut):pt=i.wnext-ut,ut>i.length&&(ut=i.length),gt=i.window}else gt=et,pt=nt-i.offset,ut=i.length;ut>at&&(ut=at),at-=ut,i.length-=ut;do{et[nt++]=gt[pt++]}while(--ut);0===i.length&&(i.mode=Z);break;case Y:if(0===at)break t;et[nt++]=i.length,at--,i.mode=Z;break;case V:if(i.wrap){for(;ht<32;){if(0===st)break t;st--,ot|=tt[it++]<<ht,ht+=8}if(lt-=at,t.total_out+=lt,i.total+=lt,lt&&(t.adler=i.check=i.flags?s(i.check,et,lt,nt-lt):n(i.check,et,lt,nt-lt)),lt=at,(i.flags?ot:rt(ot))!==i.check){t.msg="incorrect data check",i.mode=Q;break}ot=0,ht=0}i.mode=X;case X:if(i.wrap&&i.flags){for(;ht<32;){if(0===st)break t;st--,ot+=tt[it++]<<ht,ht+=8}if(ot!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Q;break}ot=0,ht=0}i.mode=K;case K:Et=g;break t;case Q:Et=_;break t;case J:return w;case $:default:return b}return t.next_out=nt,t.avail_out=at,t.next_in=it,t.avail_in=st,i.hold=ot,i.bits=ht,(i.wsize||lt!==t.avail_out&&i.mode<Q&&(i.mode<V||e!==u))&&dt(t,t.output,t.next_out,lt-t.avail_out),ft-=t.avail_in,lt-=t.avail_out,t.total_in+=ft,t.total_out+=lt,i.total+=lt,i.wrap&&lt&&(t.adler=i.check=i.flags?s(i.check,et,lt,t.next_out-lt):n(i.check,et,lt,t.next_out-lt)),t.data_type=i.bits+(i.last?64:0)+(i.mode===D?128:0)+(i.mode===j||i.mode===U?256:0),(0===ft&&0===lt||e===u)&&Et===p&&(Et=y),Et},i.inflateEnd=function(t){if(!t||!t.state)return b;var e=t.state;return e.window&&(e.window=null),t.state=null,p},i.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?b:(i.head=e,e.done=!1,p):b},i.inflateSetDictionary=function(t,e){var i,r=e.length;return t&&t.state?0!==(i=t.state).wrap&&i.mode!==L?b:i.mode===L&&n(1,e,r,0)!==i.check?_:dt(t,e,r,r)?(i.mode=J,w):(i.havedict=1,p):b},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":35,"./adler32":36,"./crc32":38,"./inffast":40,"./inftrees":42}],42:[function(t,e,i){var r=t("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,h,f,l,u,c){var d,p,g,m,b,_,w,y,v,k=c.bits,E=0,x=0,I=0,C=0,S=0,A=0,T=0,B=0,R=0,L=0,D=null,z=0,O=new r.Buf16(16),U=new r.Buf16(16),N=null,M=0;for(E=0;E<=15;E++)O[E]=0;for(x=0;x<h;x++)O[e[i+x]]++;for(S=k,C=15;C>=1&&0===O[C];C--);if(S>C&&(S=C),0===C)return f[l++]=20971520,f[l++]=20971520,c.bits=1,0;for(I=1;I<C&&0===O[I];I++);for(S<I&&(S=I),B=1,E=1;E<=15;E++)if(B<<=1,(B-=O[E])<0)return-1;if(B>0&&(0===t||1!==C))return-1;for(U[1]=0,E=1;E<15;E++)U[E+1]=U[E]+O[E];for(x=0;x<h;x++)0!==e[i+x]&&(u[U[e[i+x]]++]=x);if(0===t?(D=N=u,_=19):1===t?(D=n,z-=257,N=s,M-=257,_=256):(D=a,N=o,_=-1),L=0,x=0,E=I,b=l,A=S,T=0,g=-1,m=(R=1<<S)-1,1===t&&R>852||2===t&&R>592)return 1;for(;;){w=E-T,u[x]<_?(y=0,v=u[x]):u[x]>_?(y=N[M+u[x]],v=D[z+u[x]]):(y=96,v=0),d=1<<E-T,I=p=1<<A;do{f[b+(L>>T)+(p-=d)]=w<<24|y<<16|v|0}while(0!==p);for(d=1<<E-1;L&d;)d>>=1;if(0!==d?(L&=d-1,L+=d):L=0,x++,0==--O[E]){if(E===C)break;E=e[i+u[x]]}if(E>S&&(L&m)!==g){for(0===T&&(T=S),b+=I,B=1<<(A=E-T);A+T<C&&!((B-=O[A+T])<=0);)A++,B<<=1;if(R+=1<<A,1===t&&R>852||2===t&&R>592)return 1;f[g=L&m]=S<<24|A<<16|b-l|0}}return 0!==L&&(f[b+L]=E-T<<24|64<<16|0),c.bits=S,0}},{"../utils/common":35}],43:[function(t,e,i){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],44:[function(t,e,i){var r=t("../utils/common"),n=4,s=0,a=1,o=2;function h(t){for(var e=t.length;--e>=0;)t[e]=0}var f=0,l=1,u=2,c=29,d=256,p=d+1+c,g=30,m=19,b=2*p+1,_=15,w=16,y=7,v=256,k=16,E=17,x=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],T=new Array(2*(p+2));h(T);var B=new Array(2*g);h(B);var R=new Array(512);h(R);var L=new Array(256);h(L);var D=new Array(c);h(D);var z,O,U,N=new Array(g);function M(t,e,i,r,n){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=t&&t.length}function P(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function F(t){return t<256?R[t]:R[256+(t>>>7)]}function j(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function Z(t,e,i){t.bi_valid>w-i?(t.bi_buf|=e<<t.bi_valid&65535,j(t,t.bi_buf),t.bi_buf=e>>w-t.bi_valid,t.bi_valid+=i-w):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function H(t,e,i){Z(t,i[2*e],i[2*e+1])}function W(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1}function G(t,e,i){var r,n,s=new Array(_+1),a=0;for(r=1;r<=_;r++)s[r]=a=a+i[r-1]<<1;for(n=0;n<=e;n++){var o=t[2*n+1];0!==o&&(t[2*n]=W(s[o]++,o))}}function q(t){var e;for(e=0;e<p;e++)t.dyn_ltree[2*e]=0;for(e=0;e<g;e++)t.dyn_dtree[2*e]=0;for(e=0;e<m;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*v]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function Y(t){t.bi_valid>8?j(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function V(t,e,i,r){var n=2*e,s=2*i;return t[n]<t[s]||t[n]===t[s]&&r[e]<=r[i]}function X(t,e,i){for(var r=t.heap[i],n=i<<1;n<=t.heap_len&&(n<t.heap_len&&V(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!V(e,r,t.heap[n],t.depth));)t.heap[i]=t.heap[n],i=n,n<<=1;t.heap[i]=r}function K(t,e,i){var r,n,s,a,o=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],n=t.pending_buf[t.l_buf+o],o++,0===r?H(t,n,e):(s=L[n],H(t,s+d+1,e),0!==(a=I[s])&&(n-=D[s],Z(t,n,a)),s=F(--r),H(t,s,i),0!==(a=C[s])&&(r-=N[s],Z(t,r,a)))}while(o<t.last_lit);H(t,v,e)}function Q(t,e){var i,r,n,s=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,h=e.stat_desc.elems,f=-1;for(t.heap_len=0,t.heap_max=b,i=0;i<h;i++)0!==s[2*i]?(t.heap[++t.heap_len]=f=i,t.depth[i]=0):s[2*i+1]=0;for(;t.heap_len<2;)n=t.heap[++t.heap_len]=f<2?++f:0,s[2*n]=1,t.depth[n]=0,t.opt_len--,o&&(t.static_len-=a[2*n+1]);for(e.max_code=f,i=t.heap_len>>1;i>=1;i--)X(t,s,i);n=h;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],X(t,s,1),r=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=r,s[2*n]=s[2*i]+s[2*r],t.depth[n]=(t.depth[i]>=t.depth[r]?t.depth[i]:t.depth[r])+1,s[2*i+1]=s[2*r+1]=n,t.heap[1]=n++,X(t,s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,r,n,s,a,o,h=e.dyn_tree,f=e.max_code,l=e.stat_desc.static_tree,u=e.stat_desc.has_stree,c=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,p=e.stat_desc.max_length,g=0;for(s=0;s<=_;s++)t.bl_count[s]=0;for(h[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<b;i++)r=t.heap[i],(s=h[2*h[2*r+1]+1]+1)>p&&(s=p,g++),h[2*r+1]=s,r>f||(t.bl_count[s]++,a=0,r>=d&&(a=c[r-d]),o=h[2*r],t.opt_len+=o*(s+a),u&&(t.static_len+=o*(l[2*r+1]+a)));if(0!==g){do{for(s=p-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[p]--,g-=2}while(g>0);for(s=p;0!==s;s--)for(r=t.bl_count[s];0!==r;)(n=t.heap[--i])>f||(h[2*n+1]!==s&&(t.opt_len+=(s-h[2*n+1])*h[2*n],h[2*n+1]=s),r--)}}(t,e),G(s,f,t.bl_count)}function J(t,e,i){var r,n,s=-1,a=e[1],o=0,h=7,f=4;for(0===a&&(h=138,f=3),e[2*(i+1)+1]=65535,r=0;r<=i;r++)n=a,a=e[2*(r+1)+1],++o<h&&n===a||(o<f?t.bl_tree[2*n]+=o:0!==n?(n!==s&&t.bl_tree[2*n]++,t.bl_tree[2*k]++):o<=10?t.bl_tree[2*E]++:t.bl_tree[2*x]++,o=0,s=n,0===a?(h=138,f=3):n===a?(h=6,f=3):(h=7,f=4))}function $(t,e,i){var r,n,s=-1,a=e[1],o=0,h=7,f=4;for(0===a&&(h=138,f=3),r=0;r<=i;r++)if(n=a,a=e[2*(r+1)+1],!(++o<h&&n===a)){if(o<f)do{H(t,n,t.bl_tree)}while(0!=--o);else 0!==n?(n!==s&&(H(t,n,t.bl_tree),o--),H(t,k,t.bl_tree),Z(t,o-3,2)):o<=10?(H(t,E,t.bl_tree),Z(t,o-3,3)):(H(t,x,t.bl_tree),Z(t,o-11,7));o=0,s=n,0===a?(h=138,f=3):n===a?(h=6,f=3):(h=7,f=4)}}h(N);var tt=!1;function et(t,e,i,n){Z(t,(f<<1)+(n?1:0),3),function(t,e,i,n){Y(t),n&&(j(t,i),j(t,~i)),r.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i,!0)}i._tr_init=function(t){tt||(function(){var t,e,i,r,n,s=new Array(_+1);for(i=0,r=0;r<c-1;r++)for(D[r]=i,t=0;t<1<<I[r];t++)L[i++]=r;for(L[i-1]=r,n=0,r=0;r<16;r++)for(N[r]=n,t=0;t<1<<C[r];t++)R[n++]=r;for(n>>=7;r<g;r++)for(N[r]=n<<7,t=0;t<1<<C[r]-7;t++)R[256+n++]=r;for(e=0;e<=_;e++)s[e]=0;for(t=0;t<=143;)T[2*t+1]=8,t++,s[8]++;for(;t<=255;)T[2*t+1]=9,t++,s[9]++;for(;t<=279;)T[2*t+1]=7,t++,s[7]++;for(;t<=287;)T[2*t+1]=8,t++,s[8]++;for(G(T,p+1,s),t=0;t<g;t++)B[2*t+1]=5,B[2*t]=W(t,5);z=new M(T,I,d+1,p,_),O=new M(B,C,0,g,_),U=new M(new Array(0),S,0,m,y)}(),tt=!0),t.l_desc=new P(t.dyn_ltree,z),t.d_desc=new P(t.dyn_dtree,O),t.bl_desc=new P(t.bl_tree,U),t.bi_buf=0,t.bi_valid=0,q(t)},i._tr_stored_block=et,i._tr_flush_block=function(t,e,i,r){var h,f,c=0;t.level>0?(t.strm.data_type===o&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return s;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(e=32;e<d;e++)if(0!==t.dyn_ltree[2*e])return a;return s}(t)),Q(t,t.l_desc),Q(t,t.d_desc),c=function(t){var e;for(J(t,t.dyn_ltree,t.l_desc.max_code),J(t,t.dyn_dtree,t.d_desc.max_code),Q(t,t.bl_desc),e=m-1;e>=3&&0===t.bl_tree[2*A[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),h=t.opt_len+3+7>>>3,(f=t.static_len+3+7>>>3)<=h&&(h=f)):h=f=i+5,i+4<=h&&-1!==e?et(t,e,i,r):t.strategy===n||f===h?(Z(t,(l<<1)+(r?1:0),3),K(t,T,B)):(Z(t,(u<<1)+(r?1:0),3),function(t,e,i,r){var n;for(Z(t,e-257,5),Z(t,i-1,5),Z(t,r-4,4),n=0;n<r;n++)Z(t,t.bl_tree[2*A[n]+1],3);$(t,t.dyn_ltree,e-1),$(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),K(t,t.dyn_ltree,t.dyn_dtree)),q(t),r&&Y(t)},i._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(L[i]+d+1)]++,t.dyn_dtree[2*F(e)]++),t.last_lit===t.lit_bufsize-1},i._tr_align=function(t){Z(t,l<<1,3),H(t,v,T),function(t){16===t.bi_valid?(j(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":35}],45:[function(t,e,i){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],46:[function(t,e,i){(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports=function(e,i,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var s,a,o=arguments.length;switch(o){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,i)});case 3:return t.nextTick(function(){e.call(null,i,r)});case 4:return t.nextTick(function(){e.call(null,i,r,n)});default:for(s=new Array(o-1),a=0;a<s.length;)s[a++]=arguments[a];return t.nextTick(function(){e.apply(null,s)})}}:e.exports=t.nextTick}).call(this,t("_process"))},{_process:47}],47:[function(t,e,i){var r,n,s=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function h(t){if(r===setTimeout)return setTimeout(t,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(t){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var f,l=[],u=!1,c=-1;function d(){u&&f&&(u=!1,f.length?l=f.concat(l):c=-1,l.length&&p())}function p(){if(!u){var t=h(d);u=!0;for(var e=l.length;e;){for(f=l,l=[];++c<e;)f&&f[c].run();c=-1,e=l.length}f=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function m(){}s.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new g(t,e)),1!==l.length||u||h(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(t){return[]},s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],48:[function(t,e,i){e.exports=t("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":49}],49:[function(t,e,i){var r=t("process-nextick-args"),n=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};e.exports=u;var s=t("core-util-is");s.inherits=t("inherits");var a=t("./_stream_readable"),o=t("./_stream_writable");s.inherits(u,a);for(var h=n(o.prototype),f=0;f<h.length;f++){var l=h[f];u.prototype[l]||(u.prototype[l]=o.prototype[l])}function u(t){if(!(this instanceof u))return new u(t);a.call(this,t),o.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",c)}function c(){this.allowHalfOpen||this._writableState.ended||r(d,this)}function d(t){t.end()}Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),u.prototype._destroy=function(t,e){this.push(null),this.end(),r(e,t)}},{"./_stream_readable":51,"./_stream_writable":53,"core-util-is":29,inherits:32,"process-nextick-args":46}],50:[function(t,e,i){e.exports=s;var r=t("./_stream_transform"),n=t("core-util-is");function s(t){if(!(this instanceof s))return new s(t);r.call(this,t)}n.inherits=t("inherits"),n.inherits(s,r),s.prototype._transform=function(t,e,i){i(null,t)}},{"./_stream_transform":52,"core-util-is":29,inherits:32}],51:[function(t,e,i){(function(i,r){var n=t("process-nextick-args");e.exports=w;var s,a=t("isarray");w.ReadableState=_,t("events").EventEmitter;var o=function(t,e){return t.listeners(e).length},h=t("./internal/streams/stream"),f=t("safe-buffer").Buffer,l=r.Uint8Array||function(){},u=t("core-util-is");u.inherits=t("inherits");var c=t("util"),d=void 0;d=c&&c.debuglog?c.debuglog("stream"):function(){};var p,g=t("./internal/streams/BufferList"),m=t("./internal/streams/destroy");u.inherits(w,h);var b=["error","close","destroy","pause","resume"];function _(e,i){s=s||t("./_stream_duplex"),e=e||{},this.objectMode=!!e.objectMode,i instanceof s&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=t("string_decoder/").StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function w(e){if(s=s||t("./_stream_duplex"),!(this instanceof w))return new w(e);this._readableState=new _(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),h.call(this)}function y(t,e,i,r,n){var s,a=t._readableState;return null===e?(a.reading=!1,function(t,e){if(!e.ended){if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,x(t)}}(t,a)):(n||(s=function(t,e){var i,r;return r=e,f.isBuffer(r)||r instanceof l||"string"==typeof e||void 0===e||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}(a,e)),s?t.emit("error",s):a.objectMode||e&&e.length>0?("string"==typeof e||a.objectMode||Object.getPrototypeOf(e)===f.prototype||(e=function(t){return f.from(t)}(e)),r?a.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):v(t,a,e,!0):a.ended?t.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!i?(e=a.decoder.write(e),a.objectMode||0!==e.length?v(t,a,e,!1):C(t,a)):v(t,a,e,!1))):r||(a.reading=!1)),function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(a)}function v(t,e,i,r){e.flowing&&0===e.length&&!e.sync?(t.emit("data",i),t.read(0)):(e.length+=e.objectMode?1:i.length,r?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&x(t)),C(t,e)}Object.defineProperty(w.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),w.prototype.destroy=m.destroy,w.prototype._undestroy=m.undestroy,w.prototype._destroy=function(t,e){this.push(null),e(t)},w.prototype.push=function(t,e){var i,r=this._readableState;return r.objectMode?i=!0:"string"==typeof t&&((e=e||r.defaultEncoding)!==r.encoding&&(t=f.from(t,e),e=""),i=!0),y(this,t,e,!1,i)},w.prototype.unshift=function(t){return y(this,t,null,!0,!1)},w.prototype.isPaused=function(){return!1===this._readableState.flowing},w.prototype.setEncoding=function(e){return p||(p=t("string_decoder/").StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var k=8388608;function E(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=k?t=k:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function x(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(d("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?n(I,t):I(t))}function I(t){d("emit readable"),t.emit("readable"),B(t)}function C(t,e){e.readingMore||(e.readingMore=!0,n(S,t,e))}function S(t,e){for(var i=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(d("maybeReadMore read 0"),t.read(0),i!==e.length);)i=e.length;e.readingMore=!1}function A(t){d("readable nexttick read 0"),t.read(0)}function T(t,e){e.reading||(d("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),B(t),e.flowing&&!e.reading&&t.read(0)}function B(t){var e=t._readableState;for(d("flow",e.flowing);e.flowing&&null!==t.read(););}function R(t,e){return 0===e.length?null:(e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):i=function(t,e,i){var r;return t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():i?function(t,e){var i=e.head,r=1,n=i.data;for(t-=n.length;i=i.next;){var s=i.data,a=t>s.length?s.length:t;if(a===s.length?n+=s:n+=s.slice(0,t),0==(t-=a)){a===s.length?(++r,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=s.slice(a));break}++r}return e.length-=r,n}(t,e):function(t,e){var i=f.allocUnsafe(t),r=e.head,n=1;for(r.data.copy(i),t-=r.data.length;r=r.next;){var s=r.data,a=t>s.length?s.length:t;if(s.copy(i,i.length-t,0,a),0==(t-=a)){a===s.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=s.slice(a));break}++n}return e.length-=n,i}(t,e),r}(t,e.buffer,e.decoder),i);var i}function L(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,n(D,e,t))}function D(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function z(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}w.prototype.read=function(t){d("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return d("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?L(this):x(this),null;if(0===(t=E(t,e))&&e.ended)return 0===e.length&&L(this),null;var r,n=e.needReadable;return d("need readable",n),(0===e.length||e.length-t<e.highWaterMark)&&d("length less than watermark",n=!0),e.ended||e.reading?d("reading or ended",n=!1):n&&(d("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=E(i,e))),null===(r=t>0?R(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&L(this)),null!==r&&this.emit("data",r),r},w.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},w.prototype.pipe=function(t,e){var r=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=t;break;case 1:s.pipes=[s.pipes,t];break;default:s.pipes.push(t)}s.pipesCount+=1,d("pipe count=%d opts=%j",s.pipesCount,e);var h=(!e||!1!==e.end)&&t!==i.stdout&&t!==i.stderr,f=h?u:y;function l(e,i){d("onunpipe"),e===r&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,d("cleanup"),t.removeListener("close",_),t.removeListener("finish",w),t.removeListener("drain",c),t.removeListener("error",b),t.removeListener("unpipe",l),r.removeListener("end",u),r.removeListener("end",y),r.removeListener("data",m),p=!0,!s.awaitDrain||t._writableState&&!t._writableState.needDrain||c())}function u(){d("onend"),t.end()}s.endEmitted?n(f):r.once("end",f),t.on("unpipe",l);var c=function(t){return function(){var e=t._readableState;d("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&o(t,"data")&&(e.flowing=!0,B(t))}}(r);t.on("drain",c);var p=!1,g=!1;function m(e){d("ondata"),g=!1;var i=t.write(e);!1!==i||g||((1===s.pipesCount&&s.pipes===t||s.pipesCount>1&&-1!==z(s.pipes,t))&&!p&&(d("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,g=!0),r.pause())}function b(e){d("onerror",e),y(),t.removeListener("error",b),0===o(t,"error")&&t.emit("error",e)}function _(){t.removeListener("finish",w),y()}function w(){d("onfinish"),t.removeListener("close",_),y()}function y(){d("unpipe"),r.unpipe(t)}return r.on("data",m),function(t,e,i){if("function"==typeof t.prependListener)return t.prependListener(e,i);t._events&&t._events[e]?a(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i)}(t,"error",b),t.once("close",_),t.once("finish",w),t.emit("pipe",r),s.flowing||(d("pipe resume"),r.resume()),t},w.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i),this);if(!t){var r=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<n;s++)r[s].emit("unpipe",this,i);return this}var a=z(e.pipes,t);return-1===a?this:(e.pipes.splice(a,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i),this)},w.prototype.on=function(t,e){var i=h.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&x(this):n(A,this))}return i},w.prototype.addListener=w.prototype.on,w.prototype.resume=function(){var t=this._readableState;return t.flowing||(d("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,n(T,t,e))}(this,t)),this},w.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},w.prototype.wrap=function(t){var e=this._readableState,i=!1,r=this;for(var n in t.on("end",function(){if(d("wrapped end"),e.decoder&&!e.ended){var t=e.decoder.end();t&&t.length&&r.push(t)}r.push(null)}),t.on("data",function(n){if(d("wrapped data"),e.decoder&&(n=e.decoder.write(n)),(!e.objectMode||null!=n)&&(e.objectMode||n&&n.length)){var s=r.push(n);s||(i=!0,t.pause())}}),t)void 0===this[n]&&"function"==typeof t[n]&&(this[n]=function(e){return function(){return t[e].apply(t,arguments)}}(n));for(var s=0;s<b.length;s++)t.on(b[s],r.emit.bind(r,b[s]));return r._read=function(e){d("wrapped _read",e),i&&(i=!1,t.resume())},r},w._fromList=R}).call(this,t("_process"),void 0!==K?K:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":49,"./internal/streams/BufferList":54,"./internal/streams/destroy":55,"./internal/streams/stream":56,_process:47,"core-util-is":29,events:30,inherits:32,isarray:34,"process-nextick-args":46,"safe-buffer":62,"string_decoder/":57,util:25}],52:[function(t,e,i){e.exports=a;var r=t("./_stream_duplex"),n=t("core-util-is");function s(t){this.afterTransform=function(e,i){return function(t,e,i){var r=t._transformState;r.transforming=!1;var n=r.writecb;if(!n)return t.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=i&&t.push(i),n(e);var s=t._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&t._read(s.highWaterMark)}(t,e,i)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function a(t){if(!(this instanceof a))return new a(t);r.call(this,t),this._transformState=new s(this);var e=this;this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(t,i){o(e,t,i)}):o(e)})}function o(t,e,i){if(e)return t.emit("error",e);null!=i&&t.push(i);var r=t._writableState,n=t._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(n.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}n.inherits=t("inherits"),n.inherits(a,r),a.prototype.push=function(t,e){return this._transformState.needTransform=!1,r.prototype.push.call(this,t,e)},a.prototype._transform=function(t,e,i){throw new Error("_transform() is not implemented")},a.prototype._write=function(t,e,i){var r=this._transformState;if(r.writecb=i,r.writechunk=t,r.writeencoding=e,!r.transforming){var n=this._readableState;(r.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},a.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},a.prototype._destroy=function(t,e){var i=this;r.prototype._destroy.call(this,t,function(t){e(t),i.emit("close")})}},{"./_stream_duplex":49,"core-util-is":29,inherits:32}],53:[function(t,e,i){(function(i,r){var n=t("process-nextick-args");function s(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,i){var r=t.entry;for(t.entry=null;r;){var n=r.callback;e.pendingcb--,n(i),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}e.exports=b;var a,o=!i.browser&&["v0.10","v0.9."].indexOf(i.version.slice(0,5))>-1?setImmediate:n;b.WritableState=m;var h=t("core-util-is");h.inherits=t("inherits");var f,l={deprecate:t("util-deprecate")},u=t("./internal/streams/stream"),c=t("safe-buffer").Buffer,d=r.Uint8Array||function(){},p=t("./internal/streams/destroy");function g(){}function m(e,i){a=a||t("./_stream_duplex"),e=e||{},this.objectMode=!!e.objectMode,i instanceof a&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,h=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:h,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var f=!1===e.decodeStrings;this.decodeStrings=!f,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var i=t._writableState,r=i.sync,s=i.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(i),e)!function(t,e,i,r,s){--e.pendingcb,i?(n(s,r),n(E,t,e),t._writableState.errorEmitted=!0,t.emit("error",r)):(s(r),t._writableState.errorEmitted=!0,t.emit("error",r),E(t,e))}(t,i,r,e,s);else{var a=v(i);a||i.corked||i.bufferProcessing||!i.bufferedRequest||y(t,i),r?o(w,t,i,a,s):w(t,i,a,s)}}(i,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function b(e){if(a=a||t("./_stream_duplex"),!(f.call(b,this)||this instanceof a))return new b(e);this._writableState=new m(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),u.call(this)}function _(t,e,i,r,n,s,a){e.writelen=r,e.writecb=a,e.writing=!0,e.sync=!0,i?t._writev(n,e.onwrite):t._write(n,s,e.onwrite),e.sync=!1}function w(t,e,i,r){i||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,r(),E(t,e)}function y(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var r=e.bufferedRequestCount,n=new Array(r),a=e.corkedRequestsFree;a.entry=i;for(var o=0,h=!0;i;)n[o]=i,i.isBuf||(h=!1),i=i.next,o+=1;n.allBuffers=h,_(t,e,!0,e.length,n,"",a.finish),e.pendingcb++,e.lastBufferedRequest=null,a.next?(e.corkedRequestsFree=a.next,a.next=null):e.corkedRequestsFree=new s(e)}else{for(;i;){var f=i.chunk,l=i.encoding,u=i.callback,c=e.objectMode?1:f.length;if(_(t,e,!1,c,f,l,u),i=i.next,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequestCount=0,e.bufferedRequest=i,e.bufferProcessing=!1}function v(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function k(t,e){t._final(function(i){e.pendingcb--,i&&t.emit("error",i),e.prefinished=!0,t.emit("prefinish"),E(t,e)})}function E(t,e){var i=v(e);return i&&(function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,n(k,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),i}h.inherits(b,u),m.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(m.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(t){return!!f.call(this,t)||t&&t._writableState instanceof m}})):f=function(t){return t instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(t,e,i){var r,s=this._writableState,a=!1,o=(r=t,(c.isBuffer(r)||r instanceof d)&&!s.objectMode);return o&&!c.isBuffer(t)&&(t=function(t){return c.from(t)}(t)),"function"==typeof e&&(i=e,e=null),o?e="buffer":e||(e=s.defaultEncoding),"function"!=typeof i&&(i=g),s.ended?function(t,e){var i=new Error("write after end");t.emit("error",i),n(e,i)}(this,i):(o||function(t,e,i,r){var s=!0,a=!1;return null===i?a=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||e.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(t.emit("error",a),n(r,a),s=!1),s}(this,s,t,i))&&(s.pendingcb++,a=function(t,e,i,r,n,s){if(!i){var a=function(t,e,i){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=c.from(e,i)),e}(e,r,n);r!==a&&(i=!0,n="buffer",r=a)}var o=e.objectMode?1:r.length;e.length+=o;var h=e.length<e.highWaterMark;if(h||(e.needDrain=!0),e.writing||e.corked){var f=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:n,isBuf:i,callback:s,next:null},f?f.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else _(t,e,!1,o,r,n,s);return h}(this,s,o,t,e,i)),a},b.prototype.cork=function(){var t=this._writableState;t.corked++},b.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||y(this,t))},b.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},b.prototype._write=function(t,e,i){i(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(t,e,i){var r=this._writableState;"function"==typeof t?(i=t,t=null,e=null):"function"==typeof e&&(i=e,e=null),null!=t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(t,e,i){e.ending=!0,E(t,e),i&&(e.finished?n(i):t.once("finish",i)),e.ended=!0,t.writable=!1}(this,r,i)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),b.prototype.destroy=p.destroy,b.prototype._undestroy=p.undestroy,b.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,t("_process"),void 0!==K?K:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":49,"./internal/streams/destroy":55,"./internal/streams/stream":56,_process:47,"core-util-is":29,inherits:32,"process-nextick-args":46,"safe-buffer":62,"util-deprecate":64}],54:[function(t,e,i){var r=t("safe-buffer").Buffer;e.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i},t.prototype.concat=function(t){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var e,i,n,s=r.allocUnsafe(t>>>0),a=this.head,o=0;a;)e=a.data,i=s,n=o,e.copy(i,n),o+=a.data.length,a=a.next;return s},t}()},{"safe-buffer":62}],55:[function(t,e,i){var r=t("process-nextick-args");function n(t,e){t.emit("error",e)}e.exports={destroy:function(t,e){var i=this,s=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;s||a?e?e(t):!t||this._writableState&&this._writableState.errorEmitted||r(n,this,t):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(r(n,i,t),i._writableState&&(i._writableState.errorEmitted=!0)):e&&e(t)}))},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":46}],56:[function(t,e,i){e.exports=t("events").EventEmitter},{events:30}],57:[function(t,e,i){var r=t("safe-buffer").Buffer,n=r.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(r.isEncoding===n||!n(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=h,this.end=f,e=4;break;case"utf8":this.fillLast=o,e=4;break;case"base64":this.text=l,this.end=u,e=3;break;default:return this.write=c,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(e)}function a(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:-1}function o(t){var e=this.lastTotal-this.lastNeed,i=function(t,e,i){if(128!=(192&e[0]))return t.lastNeed=0,"�".repeat(i);if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�".repeat(i+1);if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�".repeat(i+2)}}(this,t,e);return void 0!==i?i:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function h(t,e){if((t.length-e)%2==0){var i=t.toString("utf16le",e);if(i){var r=i.charCodeAt(i.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function f(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,i)}return e}function l(t,e){var i=(t.length-e)%3;return 0===i?t.toString("base64",e):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-i))}function u(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function c(t){return t.toString(this.encoding)}function d(t){return t&&t.length?this.write(t):""}i.StringDecoder=s,s.prototype.write=function(t){if(0===t.length)return"";var e,i;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<t.length?e?e+this.text(t,i):this.text(t,i):e||""},s.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�".repeat(this.lastTotal-this.lastNeed):e},s.prototype.text=function(t,e){var i=function(t,e,i){var r=e.length-1;if(r<i)return 0;var n=a(e[r]);return n>=0?(n>0&&(t.lastNeed=n-1),n):--r<i?0:(n=a(e[r]))>=0?(n>0&&(t.lastNeed=n-2),n):--r<i?0:(n=a(e[r]))>=0?(n>0&&(2===n?n=0:t.lastNeed=n-3),n):0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=i;var r=t.length-(i-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)},s.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},{"safe-buffer":62}],58:[function(t,e,i){e.exports=t("./readable").PassThrough},{"./readable":59}],59:[function(t,e,i){(i=e.exports=t("./lib/_stream_readable.js")).Stream=i,i.Readable=i,i.Writable=t("./lib/_stream_writable.js"),i.Duplex=t("./lib/_stream_duplex.js"),i.Transform=t("./lib/_stream_transform.js"),i.PassThrough=t("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":49,"./lib/_stream_passthrough.js":50,"./lib/_stream_readable.js":51,"./lib/_stream_transform.js":52,"./lib/_stream_writable.js":53}],60:[function(t,e,i){e.exports=t("./readable").Transform},{"./readable":59}],61:[function(t,e,i){e.exports=t("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":53}],62:[function(t,e,i){var r=t("buffer"),n=r.Buffer;function s(t,e){for(var i in t)e[i]=t[i]}function a(t,e,i){return n(t,e,i)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(s(r,i),i.Buffer=a),s(n,a),a.from=function(t,e,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return n(t,e,i)},a.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=n(t);return void 0!==e?"string"==typeof i?r.fill(e,i):r.fill(e):r.fill(0),r},a.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n(t)},a.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},{buffer:28}],63:[function(t,e,i){e.exports=s;var r=t("events").EventEmitter,n=t("inherits");function s(){r.call(this)}n(s,r),s.Readable=t("readable-stream/readable.js"),s.Writable=t("readable-stream/writable.js"),s.Duplex=t("readable-stream/duplex.js"),s.Transform=t("readable-stream/transform.js"),s.PassThrough=t("readable-stream/passthrough.js"),s.Stream=s,s.prototype.pipe=function(t,e){var i=this;function n(e){t.writable&&!1===t.write(e)&&i.pause&&i.pause()}function s(){i.readable&&i.resume&&i.resume()}i.on("data",n),t.on("drain",s),t._isStdio||e&&!1===e.end||(i.on("end",o),i.on("close",h));var a=!1;function o(){a||(a=!0,t.end())}function h(){a||(a=!0,"function"==typeof t.destroy&&t.destroy())}function f(t){if(l(),0===r.listenerCount(this,"error"))throw t}function l(){i.removeListener("data",n),t.removeListener("drain",s),i.removeListener("end",o),i.removeListener("close",h),i.removeListener("error",f),t.removeListener("error",f),i.removeListener("end",l),i.removeListener("close",l),t.removeListener("close",l)}return i.on("error",f),t.on("error",f),i.on("end",l),i.on("close",l),t.on("close",l),t.emit("pipe",i),t}},{events:30,inherits:32,"readable-stream/duplex.js":48,"readable-stream/passthrough.js":58,"readable-stream/readable.js":59,"readable-stream/transform.js":60,"readable-stream/writable.js":61}],64:[function(t,e,i){(function(t){function i(e){try{if(!t.localStorage)return!1}catch(t){return!1}var i=t.localStorage[e];return null!=i&&"true"===String(i).toLowerCase()}e.exports=function(t,e){if(i("noDeprecation"))return t;var r=!1;return function(){if(!r){if(i("throwDeprecation"))throw new Error(e);i("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}}}).call(this,void 0!==K?K:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],65:[function(t,e,i){arguments[4][32][0].apply(i,arguments)},{dup:32}],66:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],67:[function(t,e,i){(function(e,r){var n=/%[sdj%]/g;i.format=function(t){if(!b(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(o(arguments[i]));return e.join(" ")}for(var i=1,r=arguments,s=r.length,a=String(t).replace(n,function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch(t){return"[Circular]"}default:return t}}),h=r[i];i<s;h=r[++i])g(h)||!y(h)?a+=" "+h:a+=" "+o(h);return a},i.deprecate=function(t,n){if(_(r.process))return function(){return i.deprecate(t,n).apply(this,arguments)};if(!0===e.noDeprecation)return t;var s=!1;return function(){if(!s){if(e.throwDeprecation)throw new Error(n);e.traceDeprecation?console.trace(n):console.error(n),s=!0}return t.apply(this,arguments)}};var s,a={};function o(t,e){var r={seen:[],stylize:f};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(e)?r.showHidden=e:e&&i._extend(r,e),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=h),l(r,t,r.depth)}function h(t,e){var i=o.styles[e];return i?"["+o.colors[i][0]+"m"+t+"["+o.colors[i][1]+"m":t}function f(t,e){return t}function l(t,e,r){if(t.customInspect&&e&&E(e.inspect)&&e.inspect!==i.inspect&&(!e.constructor||e.constructor.prototype!==e)){var n=e.inspect(r,t);return b(n)||(n=l(t,n,r)),n}var s=function(t,e){if(_(e))return t.stylize("undefined","undefined");if(b(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return m(e)?t.stylize(""+e,"number"):p(e)?t.stylize(""+e,"boolean"):g(e)?t.stylize("null","null"):void 0}(t,e);if(s)return s;var a=Object.keys(e),o=function(t){var e={};return t.forEach(function(t,i){e[t]=!0}),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(e)),k(e)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return u(e);if(0===a.length){if(E(e)){var h=e.name?": "+e.name:"";return t.stylize("[Function"+h+"]","special")}if(w(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(v(e))return t.stylize(Date.prototype.toString.call(e),"date");if(k(e))return u(e)}var f,y="",x=!1,I=["{","}"];if(d(e)&&(x=!0,I=["[","]"]),E(e)){var C=e.name?": "+e.name:"";y=" [Function"+C+"]"}return w(e)&&(y=" "+RegExp.prototype.toString.call(e)),v(e)&&(y=" "+Date.prototype.toUTCString.call(e)),k(e)&&(y=" "+u(e)),0!==a.length||x&&0!=e.length?r<0?w(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),f=x?function(t,e,i,r,n){for(var s=[],a=0,o=e.length;a<o;++a)S(e,String(a))?s.push(c(t,e,i,r,String(a),!0)):s.push("");return n.forEach(function(n){n.match(/^\d+$/)||s.push(c(t,e,i,r,n,!0))}),s}(t,e,r,o,a):a.map(function(i){return c(t,e,r,o,i,x)}),t.seen.pop(),function(t,e,i){return t.reduce(function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}(f,y,I)):I[0]+y+I[1]}function u(t){return"["+Error.prototype.toString.call(t)+"]"}function c(t,e,i,r,n,s){var a,o,h;if((h=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?o=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(o=t.stylize("[Setter]","special")),S(r,n)||(a="["+n+"]"),o||(t.seen.indexOf(h.value)<0?(o=g(i)?l(t,h.value,null):l(t,h.value,i-1)).indexOf("\n")>-1&&(o=s?o.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+o.split("\n").map(function(t){return"   "+t}).join("\n")):o=t.stylize("[Circular]","special")),_(a)){if(s&&n.match(/^\d+$/))return o;(a=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+o}function d(t){return Array.isArray(t)}function p(t){return"boolean"==typeof t}function g(t){return null===t}function m(t){return"number"==typeof t}function b(t){return"string"==typeof t}function _(t){return void 0===t}function w(t){return y(t)&&"[object RegExp]"===x(t)}function y(t){return"object"==typeof t&&null!==t}function v(t){return y(t)&&"[object Date]"===x(t)}function k(t){return y(t)&&("[object Error]"===x(t)||t instanceof Error)}function E(t){return"function"==typeof t}function x(t){return Object.prototype.toString.call(t)}function I(t){return t<10?"0"+t.toString(10):t.toString(10)}i.debuglog=function(t){if(_(s)&&(s=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!a[t])if(new RegExp("\\b"+t+"\\b","i").test(s)){var r=e.pid;a[t]=function(){var e=i.format.apply(i,arguments);console.error("%s %d: %s",t,r,e)}}else a[t]=function(){};return a[t]},i.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},i.isArray=d,i.isBoolean=p,i.isNull=g,i.isNullOrUndefined=function(t){return null==t},i.isNumber=m,i.isString=b,i.isSymbol=function(t){return"symbol"==typeof t},i.isUndefined=_,i.isRegExp=w,i.isObject=y,i.isDate=v,i.isError=k,i.isFunction=E,i.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},i.isBuffer=t("./support/isBuffer");var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function S(t,e){return Object.prototype.hasOwnProperty.call(t,e)}i.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[I(t.getHours()),I(t.getMinutes()),I(t.getSeconds())].join(":"),[t.getDate(),C[t.getMonth()],e].join(" ")),i.format.apply(i,arguments))},i.inherits=t("inherits"),i._extend=function(t,e){if(!e||!y(e))return t;for(var i=Object.keys(e),r=i.length;r--;)t[i[r]]=e[i[r]];return t}}).call(this,t("_process"),void 0!==K?K:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":66,_process:47,inherits:65}]},{},[20])(20)}(J={exports:{}},J.exports),J.exports);const tt=self.OffscreenCanvas?new OffscreenCanvas(0,0):null,et=tt?tt.getContext("2d"):null;class it extends x{constructor(t,e){super(t),this.getINCLChunkCallback=e,this.reset()}reset(){this.bs.setOffset(12),this.djbz=null,this.bg44arr=new Array,this.fg44=null,this.bgimage=null,this.fgimage=null,this.sjbz=null,this.fgbz=null,this.text=null,this.decoded=!1,this.isBackgroundCompletelyDecoded=!1,this.isFirstBgChunkDecoded=!1,this.info=null,this.iffchunks=[],this.dependencies=null}getDpi(){return this.info?this.info.dpi:this.init().info.dpi}getHeight(){return this.info?this.info.height:this.init().info.height}getWidth(){return this.info?this.info.width:this.init().info.width}async createPngObjectUrl(){var t=performance.now(),i=this.getImageData(),r=await async function(t){if(!tt)return null;tt.width=t.width,tt.height=t.height,et.putImageData(t,0,0);const e=await tt.convertToBlob();return tt.width=0,tt.height=0,e}(i);if(!r){const t=$.PNG.sync.write(this.getImageData());r=new Blob([t.buffer])}return e.IS_DEBUG&&console.log("Png creation time = ",performance.now()-t),{url:URL.createObjectURL(r),byteLength:r.size,width:this.getWidth(),height:this.getHeight(),dpi:this.getDpi()}}getDependencies(){if(this.info||this.dependencies)return this.dependencies;this.dependencies=[];for(var t=this.bs.fork();!t.isEmpty();){var e,i=t.readStr4(),r=t.getInt32();t.jump(-8);var n=t.fork(r+8);t.jump(8+r+(1&r?1:0)),"INCL"===i&&(e=new A(n),this.dependencies.push(e.ref))}return this.dependencies}init(){if(this.info)return this;if(this.dependencies=[],"INFO"!==(i=this.bs.readStr4()))throw new g("The very first chunk must be INFO chunk, but we got "+i+"!");var t=this.bs.getInt32();for(this.bs.jump(-8),this.info=new C(this.bs.fork(t+8)),this.bs.jump(8+t+(1&this.info.length)),this.iffchunks.push(this.info);!this.bs.isEmpty();){var e,i=this.bs.readStr4();t=this.bs.getInt32();this.bs.jump(-8);var r=this.bs.fork(t+8);if(this.bs.jump(8+t+(1&t)),t)if("FG44"==i)e=this.fg44=new I(r);else if("BG44"==i)this.bg44arr.push(e=new I(r));else if("Sjbz"==i)e=this.sjbz=new O(r);else if("INCL"===i){e=this.incl=new A(r);var n=this.getINCLChunkCallback(this.incl.ref);n&&("Djbz"===n.id?this.djbz=n:this.iffchunks.push(n)),this.dependencies.push(e.ref)}else if("CIDa"===i)try{e=new T(r)}catch(t){e=new B("CIDa",t)}else e="Djbz"===i?this.djbz=new L(r):"FGbz"===i?this.fgbz=new M(r):"TXTa"===i||"TXTz"===i?this.text=new X(r):new E(r);else e=new E(r);this.iffchunks.push(e)}return this}getRotation(){switch(this.info.flags){case 5:return 90;case 2:return 180;case 6:return 270;default:return 0}}rotateIfRequired(t){if(5===this.info.flags||6===this.info.flags){var e=new ImageData(this.info.height,this.info.width),i=new Uint32Array(e.data.buffer),r=new Uint32Array(t.data.buffer),n=this.info.height,s=this.info.width;if(6===this.info.flags)for(var a=0;a<s;a++)for(var o=n+(l=(s-a-1)*n),h=l,f=a;h<o;h++,f+=s)i[h]=r[f];else for(a=0;a<s;a++){var l;for(h=n+(l=a*n)-1,f=a;h>=l;h--,f+=s)i[h]=r[f]}return e}return 2===this.info.flags?(new Uint32Array(t.data.buffer).reverse(),t):t}getImageData(t=!0){const e=this._getImageData(),i=t?this.rotateIfRequired(e):e;return e.width*e.height>1e7&&this.reset(),i}_getImageData(){this.decode();var t,i,r,n,s,a=performance.now();if(!this.sjbz){if(this.bgimage)return this.bgimage.getImage();if(this.fgimage)return this.fgimage.getImage();var o=new ImageData(this.info.width,this.info.height);return o.data.fill(255),o}if(!this.bgimage&&!this.fgimage)return this.sjbz.getImage(this.fgbz);function h(t,e,i){return{writePixel(r,n,s){n[s]=t,n[1|s]=e,n[2|s]=i}}}return this.bgimage?(i=Math.round(this.info.width/this.bgimage.info.width),n=this.bgimage.pixelmap):(i=1,n=h(255,255,255)),this.fgimage?(t=Math.round(this.info.width/this.fgimage.info.width),r=this.fgimage.pixelmap):(t=1,r=h(0,0,0)),s=this.fgbz?this.createImageFromMaskImageAndBackgroundPixelMap(this.sjbz.getImage(this.fgbz,!0),n,i):this.createImageFromMaskImageAndPixelMaps(this.sjbz.getMaskImage(),r,n,t,i),e.IS_DEBUG&&console.log("DataImage creating time = ",performance.now()-a),s}createImageFromMaskImageAndPixelMaps(t,e,i,r,n){for(var s=t,a=s.data,o=(this.info.height-1)*this.info.width<<2,h=this.info.width<<2,f=0;f<this.info.height;f++){for(var l=f/n>>0,u=f/r>>0,c=i.width*l,d=e.width*u,p=o,g=0;g<this.info.width;g++)a[p]?i.writePixel(c+(g/n>>0),a,p):e.writePixel(d+(g/r>>0),a,p),p+=4;o-=h}return s}createImageFromMaskImageAndBackgroundPixelMap(t,e,i){for(var r=t.data,n=(this.info.height-1)*this.info.width<<2,s=this.info.width<<2,a=0;a<this.info.height;a++){for(var o=(a/i>>0)*e.width,h=n,f=0;f<this.info.width;f++)r[3|h]?e.writePixel(o+(f/i>>0),r,h):r[3|h]=255,h+=4;n-=s}return t}decodeForeground(){if(this.fg44){this.fgimage=new V;var t=new h(this.fg44.bs);this.fgimage.decodeChunk(t,this.fg44.header);var i=performance.now();this.fgimage.createPixelmap(),e.IS_DEBUG&&console.log("Foreground pixelmap creating time = ",performance.now()-i)}}decodeBackground(t=!1){if(!(this.isBackgroundCompletelyDecoded||this.isFirstBgChunkDecoded&&t)&&this.bg44arr.length){this.bgimage=this.bgimage||new V;for(var i=t?1:this.bg44arr.length,r=this.isFirstBgChunkDecoded?1:0;r<i;r++){var n=this.bg44arr[r],s=new h(n.bs),a=performance.now();this.bgimage.decodeChunk(s,n.header),e.IS_DEBUG&&console.log("Background chunk decoding time = ",performance.now()-a)}var o=performance.now();this.bgimage.createPixelmap(),e.IS_DEBUG&&console.log("Background pixelmap creating time = ",performance.now()-o),t?this.isFirstBgChunkDecoded=!0:this.isBackgroundCompletelyDecoded=!0}}decode(){if(this.decoded)return this.decodeBackground(),this;this.init();var t=performance.now();return this.sjbz&&this.sjbz.decode(this.djbz),e.IS_DEBUG&&console.log("Mask decoding time = ",performance.now()-t),t=performance.now(),this.decodeForeground(),e.IS_DEBUG&&console.log("Foreground decoding time = ",performance.now()-t),t=performance.now(),this.decodeBackground(),e.IS_DEBUG&&console.log("Background decoding time = ",performance.now()-t),this.decoded=!0,this}getBackgroundImageData(){return this.decode(),this.bg44arr.length?(this.bg44arr.forEach(t=>{var e=new h(t.bs);this.bgimage.decodeChunk(e,t.header)}),this.bgimage.getImage()):null}getForegroundImageData(){if(this.decode(),this.fg44){this.fgimage=new V;var t=new h(this.fg44.bs);return this.fgimage.decodeChunk(t,this.fg44.header),this.fgimage.getImage()}return null}getMaskImageData(){return this.decode(),this.sjbz&&this.sjbz.getImage(this.fgbz)}getText(){return this.init(),this.text?this.text.getText():""}getPageTextZone(){return this.init(),this.text?this.text.getPageZone():null}getNormalizedTextZones(){return this.init(),this.text?this.text.getNormalizedZones():null}toString(){this.init();var t=this.iffchunks.reduce((t,e)=>t+e.toString(),"");return super.toString(t)}}class rt extends E{constructor(t){if(super(t),this.dflags=t.byte(),this.isBundled=this.dflags>>7,this.nfiles=t.getInt16(),this.isBundled){this.offsets=new Int32Array(this.nfiles);for(var e=0;e<this.nfiles;e++)this.offsets[e]=t.getInt32()}this.sizes=new Uint32Array(this.nfiles),this.flags=new Uint8Array(this.nfiles),this.ids=new Array(this.nfiles),this.names=new Array(this.nfiles),this.titles=new Array(this.nfiles);var i=N.decodeByteStream(t.fork());for(e=0;e<this.nfiles;e++)this.sizes[e]=i.getUint24();for(e=0;e<this.nfiles;e++)this.flags[e]=i.byte();this.pagesIds=[],this.idToNameRegistry={};for(e=0;e<this.nfiles&&!i.isEmpty();e++)this.ids[e]=i.readStrNT(),this.names[e]=128&this.flags[e]?i.readStrNT():this.ids[e],this.titles[e]=64&this.flags[e]?i.readStrNT():this.ids[e],this.isPageIndex(e)&&this.pagesIds.push(this.ids[e]),this.idToNameRegistry[this.ids[e]]=this.names[e]}isPageIndex(t){return 1==(63&this.flags[t])}isThumbnailIndex(t){return 2==(63&this.flags[t])}getPageNameByItsNumber(t){return this.getComponentNameByItsId(this.pagesIds[t-1])}getPageNumberByItsId(t){const e=this.pagesIds.indexOf(t);return-1===e?null:e+1}getComponentNameByItsId(t){return this.idToNameRegistry[t]}getPagesQuantity(){return this.pagesIds.length}getFilesQuantity(){return this.nfiles}getMetadataStringByIndex(t){return`[id: "${this.ids[t]}", flag: ${this.flags[t]}, `+`offset: ${this.offsets?this.offsets[t]:"indirect"}, size: ${this.sizes[t]}]\n`}toString(){var t=super.toString();return t+=(this.isBundled?"Bundled":"Indirect")+"\n",(t+="FilesCount: "+this.nfiles+"\n")+"\n"}}class nt extends E{constructor(t){super(t),this.isDecoded=!1,this.contents=[],this.decodedBookmarkCounter=0}getContents(){return this.decode(),this.contents}decode(){if(!this.isDecoded){for(var t=N.decodeByteStream(this.bs),e=t.getUint16();this.decodedBookmarkCounter<e;)this.contents.push(this.decodeBookmark(t));this.isDecoded=!0}}decodeBookmark(t){var e=t.getUint8(),i=t.getInt24(),r=i?t.readStrUTF(i):"",n=t.getInt24(),s=n?t.readStrUTF(n):"";this.decodedBookmarkCounter++;var a={description:r,url:s};if(e){for(var o=new Array(e),h=0;h<e;h++)o[h]=this.decodeBookmark(t);a.children=o}return a}toString(){this.decode();var t="    ";return this.contents.reduce((e,i)=>e+function e(i,r=0){var n=t.repeat(r)+`${i.description} (${i.url})\n`;return i.children&&(n=i.children.reduce((t,i)=>t+e(i,r+1),n)),n}(i),super.toString())+"\n"}}class st{constructor(t){this.zp=t||new o,this.FREQMAX=4,this.CTXIDS=3,this.ctx=new Uint8Array(300),this.size=0,this.blocksize=0,this.FREQS0=1e5,this.FREQS1=1e6}blocksort(t){for(var e=t.length,i=new Array(t.length),r=0;r<e;i[r]=r++);i.sort((i,r)=>{for(var n=0;n<e;n++){if(i===this.markerpos)return-1;if(r===this.markerpos)return 1;var s=t[i%e]-t[r%e];if(s)return s;i++,r++}return 0});var n=new Uint8Array(e);for(r=0;r<e;r++){var s=i[r]-1;s>=0?n[r]=t[s]:(n[r]=0,this.markerpos=r)}return n}encode_raw(t,e){for(var i=1,r=1<<t;i<r;){var n=(e=(e&r-1)<<1)>>t;this.zp.encode(n),i=i<<1|n}}encode_binary(t,e,i){var r=1,n=1<<e;for(t--;r<n;){var s=(i=(i&n-1)<<1)>>e;this.zp.encode(s,this.ctx,t+r),r=r<<1|s}}encode(t){var e=new Uint8Array(t),i=e.length,r=i-1;this.markerpos=r,e=this.blocksort(e),r=this.markerpos,this.encode_raw(24,i);var n=0;i<this.FREQS0?(n=0,this.zp.encode(0)):i<this.FREQS1?(n=1,this.zp.encode(1),this.zp.encode(0)):(n=2,this.zp.encode(1),this.zp.encode(1));var s=new Uint8Array(256),a=new Uint8Array(256),o=new Uint32Array(this.FREQMAX),h=0;for(h=0;h<256;h++)s[h]=h;for(h=0;h<256;h++)a[s[h]]=h;var f,l=4;for(h=0;h<this.FREQMAX;h++)o[h]=0;var u=3;for(f=0;f<i;f++){var c,d=e[f],p=this.CTXIDS-1;p>u&&(p=u),u=a[d],f==r&&(u=256);var g=0;switch(0){default:if(c=0==u,this.zp.encode(c,this.ctx,g+p),c)break;if(g+=this.CTXIDS,c=1==u,this.zp.encode(c,this.ctx,g+p),c)break;if(g+=this.CTXIDS,c=u<4,this.zp.encode(c,this.ctx,g),c){this.encode_binary(g+1,1,u-2);break}if(g+=2,c=u<8,this.zp.encode(c,this.ctx,g),c){this.encode_binary(g+1,2,u-4);break}if(g+=4,c=u<16,this.zp.encode(c,this.ctx,g),c){this.encode_binary(g+1,3,u-8);break}if(g+=8,c=u<32,this.zp.encode(c,this.ctx,g),c){this.encode_binary(g+1,4,u-16);break}if(g+=16,c=u<64,this.zp.encode(c,this.ctx,g),c){this.encode_binary(g+1,5,u-32);break}if(g+=32,c=u<128,this.zp.encode(c,this.ctx,g),c){this.encode_binary(g+1,6,u-64);break}if(g+=64,c=u<256,this.zp.encode(c,this.ctx,g),c){this.encode_binary(g+1,7,u-128);break}continue}if((l+=l>>n)>268435456){l>>=24,o[0]>>=24,o[1]>>=24,o[2]>>=24,o[3]>>=24;for(var m=4;m<this.FREQMAX;m++)o[m]=o[m]>>24}var b=l;for(u<this.FREQMAX&&(b+=o[u]),m=u;m>=this.FREQMAX;m--)s[m]=s[m-1],a[s[m]]=m;for(;m>0&&b>=o[m-1];m--)s[m]=s[m-1],o[m]=o[m-1],a[s[m]]=m;s[m]=d,o[m]=b,a[s[m]]=m}return this.encode_raw(24,0),this.zp.eflush(),0}}class at{constructor(t){this.bsw=new a(t||1048576)}startDJVM(){this.bsw.writeStr("AT&T").writeStr("FORM").saveOffsetMark("fileSize").jump(4).writeStr("DJVM")}writeDirmChunk(t){this.dirm=t,this.bsw.writeStr("DIRM").saveOffsetMark("DIRMsize").jump(4),this.dirm.offsets=[],this.bsw.writeByte(t.dflags).writeInt16(t.flags.length).saveOffsetMark("DIRMoffsets").jump(4*t.flags.length);for(var e=new a,i=0;i<t.sizes.length;i++)e.writeInt24(t.sizes[i]);for(i=0;i<t.flags.length;i++)e.writeByte(t.flags[i]);for(i=0;i<t.ids.length;i++)e.writeStrNT(t.ids[i]),128&t.flags[i]&&e.writeStrNT(t.names[i]),64&t.flags[i]&&e.writeStrNT(t.titles[i]);e.writeByte(0);var r=e.getBuffer(),n=new a,s=new o(n);new st(s).encode(r);var h=n.getBuffer();this.bsw.writeBuffer(h),this.bsw.rewriteSize("DIRMsize")}get offset(){return this.bsw.offset}writeByte(t){return this.bsw.writeByte(t),this}writeStr(t){return this.bsw.writeStr(t),this}writeInt32(t){return this.bsw.writeInt32(t),this}writeFormChunkBS(t){1&this.bsw.offset&&this.bsw.writeByte(0);var e=this.bsw.offset;this.dirm.offsets.push(e),this.bsw.writeByteStream(t)}writeFormChunkBuffer(t){1&this.bsw.offset&&this.bsw.writeByte(0);var e=this.bsw.offset;this.dirm.offsets.push(e),this.bsw.writeBuffer(t)}writeChunk(t){1&this.bsw.offset&&this.bsw.writeByte(0),this.bsw.writeByteStream(t.bs)}getBuffer(){if(this.bsw.rewriteSize("fileSize"),this.dirm.offsets.length!==this.dirm.flags.length)throw new Error("Записаны не все страницы и словари !!!");for(var t=0;t<this.dirm.offsets.length;t++)this.bsw.rewriteInt32("DIRMoffsets",this.dirm.offsets[t]);return this.bsw.getBuffer()}}class ot extends x{}async function ht(t,e={}){let i;try{i=await function(t,e="arraybuffer"){return new Promise((i,r)=>{var n=new XMLHttpRequest;n.open("GET",t),n.responseType=e,n.onload=(t=>i(n)),n.onerror=(t=>r(n)),n.send()})}(t)}catch(i){throw new v({url:t,...e})}if(i.status&&200!==i.status)throw new y(i,{...e});return new U(i.response)}function ft(t,e=null,i=null){if("AT&T"!==t.readStr4())throw new g("The byte stream isn't a djvu file.",i);if(!e)return t.fork();let r=t.readStr4();const n=t.getInt32();if((r+=t.readStr4())!==e)throw new g(`Unexpected chunk id. Expected "${e}", but got "${r}"`,i);return t.jump(-12).fork(n+8)}async function lt(t,e){const i={pageNumber:t};return ft(await ht(e,i),null,i)}async function ut(t,e,i,r=null){const n={pageNumber:r,dependencyId:t};return ft(await ht(i+e,n),"FORMDJVI",n)}async function ct(t,e=null){const i={thumbnailId:e};return ft(await ht(t,i),"FORMTHUM",i)}const dt=52428800;class pt{constructor(t,{baseUrl:e=null,memoryLimit:i=dt}={}){if(this.buffer=t,this.baseUrl=e&&e.trim(),"string"==typeof this.baseUrl&&("/"!==this.baseUrl[this.baseUrl.length-1]&&(this.baseUrl+="/"),/^[A-Za-z]+:\/\//.test(this.baseUrl)||(this.baseUrl=location.origin&&new URL(this.baseUrl,location.origin).href)),this.memoryLimit=i,this.djvi={},this.getINCLChunkCallback=(t=>this.djvi[t].innerChunk),this.bs=new U(t),this.formatID=this.bs.readStr4(),"AT&T"!==this.formatID)throw new d;if(this.id=this.bs.readStr4(),this.length=this.bs.getInt32(),this.id+=this.bs.readStr4(),"FORMDJVM"===this.id)this._initMultiPageDocument();else{if("FORMDJVU"!==this.id)throw new g(`The id of the first chunk of the document should be either FORMDJVM or FORMDJVU, but there is ${this.id}`);this.bs.jump(-12),this.pages=[new it(this.bs.fork(this.length+8),this.getINCLChunkCallback)]}}_initMultiPageDocument(){this._readMetaDataChunk(),this._readContentsChunkIfExists(),this.pages=[],this.thumbs=[],this.dirm.isBundled?this._parseComponents():(this.pages=new Array(this.dirm.getPagesQuantity()),this.memoryUsage=this.bs.buffer.byteLength,this.loadedPageNumbers=[])}_readMetaDataChunk(){var t=this.bs.readStr4();if("DIRM"!==t)throw new g("The DIRM chunk must be the first but there is "+t+" instead!");var e=this.bs.getInt32();this.bs.jump(-8),this.dirm=new rt(this.bs.fork(e+8)),this.bs.jump(8+e+(1&e?1:0))}_readContentsChunkIfExists(){if(this.navm=null,this.bs.remainingLength()>8){var t=this.bs.readStr4(),e=this.bs.getInt32();this.bs.jump(-8),"NAVM"===t&&(this.navm=new nt(this.bs.fork(e+8)))}}_parseComponents(){this.dirmOrderedChunks=new Array(this.dirm.getFilesQuantity());for(var t=0;t<this.dirm.offsets.length;t++){this.bs.setOffset(this.dirm.offsets[t]);var e=this.bs.readStr4(),i=this.bs.getInt32();switch(e+=this.bs.readStr4(),this.bs.jump(-12),e){case"FORMDJVU":this.pages.push(this.dirmOrderedChunks[t]=new it(this.bs.fork(i+8),this.getINCLChunkCallback));break;case"FORMDJVI":this.dirmOrderedChunks[t]=this.djvi[this.dirm.ids[t]]=new z(this.bs.fork(i+8));break;case"FORMTHUM":this.thumbs.push(this.dirmOrderedChunks[t]=new ot(this.bs.fork(i+8)));break;default:console.error("Incorrect chunk ID: ",e)}}}getPagesSizes(){var t=this.pages.map(t=>({width:t.getWidth(),height:t.getHeight(),dpi:t.getDpi()}));return this.pages.forEach(t=>t.reset()),t}isBundled(){return!this.dirm||this.dirm.isBundled}getPagesQuantity(){return this.dirm?this.dirm.getPagesQuantity():1}getContents(){return this.navm?this.navm.getContents():null}getMemoryUsage(){return this.memoryUsage}getMemoryLimit(){return this.memoryLimit}setMemoryLimit(t=dt){this.memoryLimit=t}getPageNumberByUrl(t){if("#"!==t[0])return null;const e=t.slice(1);let i=this.dirm.getPageNumberByItsId(e);if(!i){const t=Math.round(Number(e));t>=1&&t<=this.pages.length&&(i=t)}return i||null}releaseMemoryIfRequired(t=null){if(!(this.memoryUsage<=this.memoryLimit)){for(;this.memoryUsage>this.memoryLimit&&this.loadedPageNumbers.length;){var e=this.loadedPageNumbers.shift();this.memoryUsage-=this.pages[e].bs.buffer.byteLength,this.pages[e]=null}if(this.memoryUsage>this.memoryLimit&&!this.loadedPageNumbers.length){this.resetLastRequestedPage();var i={};t&&t.forEach(t=>{i[t]=this.djvi[t],this.memoryUsage+=i[t].bs.buffer.byteLength}),Object.keys(this.djvi).forEach(t=>{this.memoryUsage-=this.djvi[t].bs.buffer.byteLength}),this.djvi=i}}}_getUrlByPageNumber(t){return this.baseUrl+this.dirm.getPageNameByItsNumber(t)}async getPage(t){var e=this.pages[t-1];if(this.lastRequestedPage&&this.lastRequestedPage!==e&&this.lastRequestedPage.reset(),this.lastRequestedPage=e,e){if(!this.isOnePageDependenciesLoaded&&"FORMDJVU"===this.id){var i=e.getDependencies();i.length&&await this._loadDependencies(i,1),this.isOnePageDependenciesLoaded=!0}}else{if(t<1||t>this.pages.length||this.isBundled())throw new p(t);{if(null===this.baseUrl)throw new _;const e=await lt(t,this._getUrlByPageNumber(t)),i=new it(e,this.getINCLChunkCallback);this.memoryUsage+=e.buffer.byteLength,await this._loadDependencies(i.getDependencies(),t),this.releaseMemoryIfRequired(i.getDependencies()),this.pages[t-1]=i,this.loadedPageNumbers.push(t-1),this.lastRequestedPage=i}}return this.lastRequestedPage}async _loadDependencies(t,e=null){var i=t.filter(t=>!this.djvi[t]);i.length&&await Promise.all(i.map(async t=>{const i=await ut(t,this.dirm?this.dirm.getComponentNameByItsId(t):t,this.baseUrl,e);this.djvi[t]=new z(i),this.memoryUsage+=i.buffer.byteLength}))}getPageUnsafe(t){return this.pages[t-1]}resetLastRequestedPage(){this.lastRequestedPage&&this.lastRequestedPage.reset(),this.lastRequestedPage=null}countFiles(){var t=0,e=this.bs.clone();for(e.jump(16);!e.isEmpty();){var i=e.readStr4(),r=e.getInt32();e.jump(r+(1&r?1:0)),"FORM"===i&&t++}return t}toString(t){var e=this.formatID+"\n";if(this.dirm)if(e+=this.id+" "+this.length+"\n\n",e+=this.dirm.toString(),e+=this.navm?this.navm.toString():"",this.isBundled())this.dirmOrderedChunks.forEach((t,i)=>{e+=this.dirm.getMetadataStringByIndex(i)+t.toString()});else for(let t=0;t<this.dirm.getFilesQuantity();t++)e+=this.dirm.getMetadataStringByIndex(t);else e+=this.pages[0].toString();return t?e.replace(/\n/g,"<br>").replace(/\s/g,"&nbsp;"):e}createObjectURL(){var t=new Blob([this.bs.buffer]);return URL.createObjectURL(t)}slice(t=1,i=this.pages.length){const r=new at;r.startDJVM();const n={dflags:this.dirm.dflags,flags:[],names:[],titles:[],sizes:[],ids:[]},s=[],a=i-t+1,o={},h=this.dirm.getFilesQuantity();for(let e=0,i=0,r=0;e<h&&r<a;e++){if(!(1==(63&this.dirm.flags[e])))continue;if(++i<t)continue;r++;const n=new U(this.buffer,this.dirm.offsets[e],this.dirm.sizes[e]),s=new it(n).getDependencies();for(const t of s)o[t]=1}for(let e=0,i=0,r=0;e<h&&r<a;e++){const a=1==(63&this.dirm.flags[e]);if(a){if(++i<t)continue;r++}(this.dirm.ids[e]in o||a)&&(n.flags.push(this.dirm.flags[e]),n.sizes.push(this.dirm.sizes[e]),n.ids.push(this.dirm.ids[e]),n.names.push(this.dirm.names[e]),n.titles.push(this.dirm.titles[e]),s.push(new U(this.buffer,this.dirm.offsets[e],this.dirm.sizes[e])))}r.writeDirmChunk(n),this.navm&&r.writeChunk(this.navm);for(const t of s)r.writeFormChunkBS(t);const f=r.getBuffer();return e.IS_DEBUG&&console.log("New Buffer size = ",f.byteLength),new pt(f)}static concat(t,e){var i={},r=t.pages.length+e.pages.length;i.dflags=129,i.flags=[],i.sizes=[],i.ids=[];var n=[],s=new Set;if(t.dirm)for(var a=0;a<t.pages.length;a++)i.flags.push(t.dirm.flags[a]),i.sizes.push(t.dirm.sizes[a]),i.ids.push(t.dirm.ids[a]),s.add(t.dirm.ids[a]),n.push(t.pages[a]);else i.flags.push(1),i.sizes.push(t.pages[0].bs.length),i.ids.push("single"),s.add("single"),n.push(t.pages[0]);if(e.dirm)for(a=0;a<e.pages.length;a++){i.flags.push(e.dirm.flags[a]),i.sizes.push(e.dirm.sizes[a]);for(o=e.dirm.ids[a],h=0;s.has(o);)o=e.dirm.ids[a]+h.toString(),h++;i.ids.push(o),s.add(o),n.push(e.pages[a])}else{i.flags.push(1),i.sizes.push(e.pages[0].bs.length);for(var o="single2",h=0;s.has(o);)o="single2"+h.toString(),h++;i.ids.push(o),n.push(e.pages[0])}var f=new at;f.startDJVM(),f.writeDirmChunk(i);for(a=0;a<r;a++)f.writeFormChunkBS(n[a].bs);return new pt(f.getBuffer())}}function gt(){return gt.url||(gt.url=URL.createObjectURL(new Blob(["("+t.toString()+")();"],{type:"application/javascript"}))),gt.url}Object.assign(pt.prototype,{bundle:async function(t=(()=>{})){const e=new at;e.startDJVM();const i={dflags:128|this.dirm.dflags,flags:[],names:[],titles:[],sizes:[],ids:[]},r=[],n=this.dirm.getFilesQuantity(),s=n+3;let a=0;const o=function(t=4){const e=[];let i=0;const r=async()=>{if(!e.length||i>=t)return;const n=e.shift();try{i++,await n()}finally{i--,r()}};return t=>new Promise((i,n)=>{e.push(()=>t().then(i,n)),r()})}(4);let h=0;const f=[];for(let e=0;e<n;e++)f.push(o(async()=>{let i;return this.dirm.isPageIndex(e)?(a++,i=await lt(a,this._getUrlByPageNumber(a))):i=this.dirm.isThumbnailIndex(e)?await ct(this.baseUrl+this.dirm.getComponentNameByItsId(this.dirm.ids[e]),this.dirm.ids[e]):await ut(this.dirm.ids[e],this.dirm.getComponentNameByItsId(this.dirm.ids[e]),this.baseUrl),t(++h/s),{flags:this.dirm.flags[e],id:this.dirm.ids[e],name:this.dirm.names[e],title:this.dirm.titles[e],bs:i}}));for(const t of await Promise.all(f))i.flags.push(t.flags),i.ids.push(t.id),i.names.push(t.names),i.titles.push(t.title),i.sizes.push(t.bs.length),r.push(t.bs);e.writeDirmChunk(i),this.navm&&e.writeChunk(this.navm),t((s-2)/s);for(let t=0;t<r.length;t++)e.writeFormChunkBS(r[t]),r[t]=null;t((s-1)/s);const l=e.getBuffer();return t(1),new this.constructor(l)}});class mt{static instance(t,e=[],i=[]){var r=new Proxy(mt.emptyFunc,{get:(n,s)=>{switch(s){case"_":return{funcs:e,args:i};case"run":return()=>t.run(r);default:return mt.instance(t,[...e,s],i)}},apply:(r,n,s)=>mt.instance(t,e,[...i,s])});return r}static emptyFunc(){}}class bt extends P{constructor(t){super(),this.width=t.width,this.height=t.height,this.inverseWaveletTransform(t),this.createBlocks(t)}inverseWaveletTransform(t){for(var e=1;e<32;e<<=1)this.filter_fh(e,t),this.filter_fv(e,t);return t}filter_fv(t,e){for(var i=Math.floor((e.height-1)/t),r=0;r<e.width;r+=t){for(var n=1;n<=i;n+=2)e[n*t][r]-=n-3>=0&&n+3<=i?9*(e[(n-1)*t][r]+e[(n+1)*t][r])-(e[(n-3)*t][r]+e[(n+3)*t][r])+8>>4:n+1<=i?e[(n-1)*t][r]+e[(n+1)*t][r]+1>>1:e[(n-1)*t][r];for(n=0;n<=i;n+=2){var s,a,o,h;s=n-1<0?0:e[(n-1)*t][r],o=n-3<0?0:e[(n-3)*t][r],a=n+1>i?0:e[(n+1)*t][r],h=n+3>i?0:e[(n+3)*t][r],e[n*t][r]+=9*(s+a)-(o+h)+16>>5}}}filter_fh(t,e){for(var i=Math.floor((e.width-1)/t),r=0;r<e.height;r+=t){for(var n=1;n<=i;n+=2)e[r][n*t]-=n-3>=0&&n+3<=i?9*(e[r][(n-1)*t]+e[r][(n+1)*t])-(e[r][(n-3)*t]+e[r][(n+3)*t])+8>>4:n+1<=i?e[r][(n-1)*t]+e[r][(n+1)*t]+1>>1:e[r][(n-1)*t];for(n=0;n<=i;n+=2){var s,a,o,h;s=n-1<0?0:e[r][(n-1)*t],o=n-3<0?0:e[r][(n-3)*t],a=n+1>i?0:e[r][(n+1)*t],h=n+3>i?0:e[r][(n+3)*t],e[r][n*t]+=9*(s+a)-(o+h)+16>>5}}}createBlocks(t){var e=Math.ceil(this.height/32),i=Math.ceil(this.width/32),r=e*i,n=new ArrayBuffer(r<<11);this.blocks=[];for(var s=0;s<e;s++)for(var a=0;a<i;a++){for(var o=new W(n,s*i+a<<11,!0),h=0;h<1024;h++){var f=0;t[this.zigzagRow[h]+32*s]&&(f=(f=t[this.zigzagRow[h]+32*s][this.zigzagCol[h]+32*a])||0),o.setCoef(h,f)}this.blocks.push(o)}n=new ArrayBuffer(r<<11),this.eblocks=new Array(r);for(h=0;h<r;h++)this.eblocks[h]=new W(n,h<<11,!0)}encodeSlice(t){if(this.zp=t,!this.is_null_slice())for(var e=0;e<this.blocks.length;e++){var i=this.blocks[e],r=this.eblocks[e];this.preliminaryFlagComputation(i,r),this.blockBandEncodingPass()&&(this.bucketEncodingPass(r),this.newlyActiveCoefficientEncodingPass(i,r)),this.previouslyActiveCoefficientEncodingPass(i,r)}return this.finish_code_slice()}previouslyActiveCoefficientEncodingPass(t,e){for(var i=0,r=this.quant_hi[this.curband],n=this.getBandBuckets(this.curband),s=n.from;s<=n.to;s++,i++)for(var a=0;a<16;a++)if(this.coeffstate[i][a]&this.ACTIVE){this.curband||(r=this.quant_lo[a]);var o=Math.abs(t.buckets[s][a]),h=e.buckets[s][a],f=o>=h?1:0;h<=3*r?this.zp.encode(f,this.inreaseCoefCtx,0):this.zp.IWencode(f),e.buckets[s][a]=h-(f?0:r)+(r>>1)}}newlyActiveCoefficientEncodingPass(t,e){for(var i=0,r=this.getBandBuckets(this.curband),n=this.quant_hi[this.curband],s=r.from;s<=r.to;s++,i++)if(this.bucketstate[i]&this.NEW){var a=0;this.bucketstate[i]&this.ACTIVE&&(a=8);for(var o=t.buckets[s],h=e.buckets[s],f=0,l=0;l<16;l++)this.coeffstate[i][l]&this.UNK&&f++;for(l=0;l<16;l++)if(this.coeffstate[i][l]&this.UNK){var u=Math.min(7,f);this.zp.encode(this.coeffstate[i][l]&this.NEW?1:0,this.activateCoefCtx,a+u),this.coeffstate[i][l]&this.NEW&&(this.zp.IWencode(o[l]<0?1:0),f=0,this.curband||(n=this.quant_lo[l]),h[l]=n+(n>>1)-(n>>3),h[l]=n+(n>>1)),f&&f--}}}bucketEncodingPass(t){for(var e=this.getBandBuckets(this.curband),i=0,r=e.from;r<=e.to;r++,i++)if(this.bucketstate[i]&this.UNK){var n=0;if(this.curband){for(var s=4*r,a=s;a<s+4;a++)t.getCoef(a)&&n++;4===n&&n--}this.bbstate&this.ACTIVE&&(n|=4),this.zp.encode(this.bucketstate[i]&this.NEW?1:0,this.decodeCoefCtx,n+8*this.curband)}}blockBandEncodingPass(){var t=this.getBandBuckets(this.curband);return t.to-t.from+1<16||this.bbstate&this.ACTIVE?this.bbstate|=this.NEW:this.bbstate&this.UNK&&this.zp.encode(this.bbstate&this.NEW?1:0,this.decodeBucketCtx,0),this.bbstate&this.NEW}preliminaryFlagComputation(t,e){this.bbstate=0;var i=0,r=this.getBandBuckets(this.curband),n=this.quant_hi[this.curband];if(this.curband)for(var s=0,a=r.from;a<=r.to;a++,s++){i=0;for(var o=t.buckets[a],h=e.buckets[a],f=0;f<o.length;f++)h[f]?this.coeffstate[s][f]=this.ACTIVE:o[f]>=n||o[f]<=-n?this.coeffstate[s][f]=this.UNK|this.NEW:this.coeffstate[s][f]=this.UNK,i|=this.coeffstate[s][f];this.bucketstate[s]=i,this.bbstate|=i}else{for(o=t.buckets[0],h=e.buckets[0],f=0;f<o.length;f++)n=this.quant_lo[f],this.coeffstate[0][f]!==this.ZERO&&(h[f]?this.coeffstate[0][f]=this.ACTIVE:o[f]>=n||o[f]<=-n?this.coeffstate[0][f]=this.UNK|this.NEW:this.coeffstate[0][f]=this.UNK),i|=this.coeffstate[0][f];this.bucketstate[0]=i,this.bbstate|=i}}}class _t{constructor(t,e,i){this.slicenumber=t||100,this.grayscale=i||0,this.delayInit=127&e||0,this.onprocess=void 0}get width(){return this.imageData.width}get height(){return this.imageData.height}startMultiPageDocument(){this.dw=new at,this.dw.startDJVM(),this.pageBuffers=[];var t={};this.dirm=t,t.offsets=[],t.dflags=129,t.flags=[],t.ids=[],t.sizes=[]}addPageToDocument(t){var e=new a;this.writeImagePage(e,t);var i=e.getBuffer();this.pageBuffers.push(i),this.dirm.flags.push(1),this.dirm.ids.push("p"+this.dirm.ids.length),this.dirm.sizes.push(i.byteLength)}endMultiPageDocument(){this.dw.writeDirmChunk(this.dirm);for(var t=this.pageBuffers.length,e=0;e<t;e++)this.dw.writeFormChunkBuffer(this.pageBuffers.shift());var i=this.dw.getBuffer();return delete this.dw,delete this.pageBuffers,delete this.dirm,i}createMultiPageDocument(t){var e=new at;e.startDJVM();var i=t.length,r=new Array(t.length),n={};this.dirm=n,n.offsets=[],n.dflags=129,n.flags=new Array(t.length),n.ids=new Array(t.length),n.sizes=new Array(t.length);for(var s=new a,o=0;o<t.length;o++){this.writeImagePage(s,t[o]);var h=s.getBuffer();r[o]=h,s.reset(),n.flags[o]=1,n.ids[o]="p"+o,n.sizes[o]=h.byteLength,this.onprocess&&this.onprocess((o+1)/i)}e.writeDirmChunk(n);for(o=0;o<t.length;o++)e.writeFormChunkBuffer(r[o]);return new pt(e.getBuffer())}writeImagePage(t,e){t.writeStr("FORM").saveOffsetMark("formSize").jump(4).writeStr("DJVU"),t.writeStr("INFO").writeInt32(10).writeInt16(e.width).writeInt16(e.height).writeByte(24).writeByte(0).writeByte(100).writeByte(0).writeByte(22).writeByte(1),t.writeStr("BG44").saveOffsetMark("BG44Size").jump(4),t.writeByte(0).writeByte(this.slicenumber).writeByte(this.grayscale<<7|1).writeByte(2).writeUint16(e.width).writeUint16(e.height).writeByte(this.delayInit);var i,r,n=new bt(this.RGBtoY(e));this.grayscale||(r=new bt(this.RGBtoCb(e)),i=new bt(this.RGBtoCr(e)));for(var s=new o(t),a=0;a<this.slicenumber;a++)n.encodeSlice(s),r&&i&&a>=this.delayInit&&(r.encodeSlice(s),i.encodeSlice(s));s.eflush(),t.rewriteSize("formSize"),t.rewriteSize("BG44Size")}createOnePageDocument(t){var e=new a(10240);return e.writeStr("AT&T"),this.writeImagePage(e,t),new pt(e.getBuffer())}RGBtoY(t){var e=new Int32Array(256),i=new Int32Array(256),r=new Int32Array(256),n=t.data,s=t.width,a=t.height,o=new H(s,a);if(this.grayscale)for(var h=0;h<n.length;h++)n[h]=255-n[h];for(var f=0;f<256;f++)e[f]=65536*f*this.rgb_to_ycc[0][0],i[f]=65536*f*this.rgb_to_ycc[0][1],r[f]=65536*f*this.rgb_to_ycc[0][2];for(h=0;h<a;h++)for(var l=0;l<s;l++){var u=(a-h-1)*s+l<<2,c=e[n[u]]+i[n[u+1]]+r[n[u+2]]+32768;o[h][l]=(c>>16)-128<<this.iw_shift}return o}RGBtoCb(t){for(var e=new Int32Array(256),i=new Int32Array(256),r=new Int32Array(256),n=t.data,s=t.width,a=t.height,o=new H(s,a),h=0;h<256;h++)e[h]=65536*h*this.rgb_to_ycc[2][0],i[h]=65536*h*this.rgb_to_ycc[2][1],r[h]=65536*h*this.rgb_to_ycc[2][2];for(var f=0;f<a;f++)for(var l=0;l<s;l++){var u=(a-f-1)*s+l<<2,c=e[n[u]]+i[n[u+1]]+r[n[u+2]]+32768;o[f][l]=Math.max(-128,Math.min(127,c>>16))<<this.iw_shift}return o}RGBtoCr(t){for(var e=new Int32Array(256),i=new Int32Array(256),r=new Int32Array(256),n=t.data,s=t.width,a=t.height,o=new H(s,a),h=0;h<256;h++)e[h]=65536*h*this.rgb_to_ycc[1][0],i[h]=65536*h*this.rgb_to_ycc[1][1],r[h]=65536*h*this.rgb_to_ycc[1][2];for(var f=0;f<a;f++)for(var l=0;l<s;l++){var u=(a-f-1)*s+l<<2,c=e[n[u]]+i[n[u+1]]+r[n[u+2]]+32768;o[f][l]=Math.max(-128,Math.min(127,c>>16))<<this.iw_shift}return o}}return _t.prototype.iw_shift=6,_t.prototype.rgb_to_ycc=[[.304348,.608696,.086956],[.463768,-.405797,-.057971],[-.173913,-.347826,.521739]],self.document||function(){var t,e;function i(t){return t.map(t=>t&&"object"==typeof t&&t.hyperCallback?(...e)=>postMessage({action:"hyperCallback",id:t.id,args:e}):t)}addEventListener("error",t=>{console.error(t),postMessage("error")}),addEventListener("unhandledrejection",t=>{console.error(t),postMessage("unhandledrejection")}),onmessage=async function({data:t}){if(t.action)return r[t.action](t);try{const{data:i,transferList:n}=await r[t.command](t)||{};try{postMessage({command:t.command,...i,...t.sendBackData?{sendBackData:t.sendBackData}:null},n&&n.length?n:void 0)}catch(e){throw new m(t.data)}}catch(i){console.error(i);var e=i instanceof c?i:{code:k.UNEXPECTED_ERROR,name:i.name,message:i.message};e.commandObject=t,postMessage({command:"Error",error:e,a:()=>{},...t.sendBackData?{sendBackData:t.sendBackData}:null})}};var r={async run(e){const r=await Promise.all(e.data.map(async e=>{for(var r=t,n=0;n<e.funcs.length;n++){if("function"!=typeof r[e.funcs[n]])throw new b(e);r=await r[e.funcs[n]](...i(e.args[n]))}return r}));var n=[],s=r.map(t=>(function(t,e){return t instanceof ArrayBuffer?(e.push(t),t):t instanceof ImageData?(e.push(t.data.buffer),{width:t.width,height:t.height,buffer:t.data.buffer}):t instanceof pt?(e.push(t.buffer),t.buffer):t})(t,n));return{data:{result:1===s.length?s[0]:s},transferList:n}},revokeObjectURL(t){URL.revokeObjectURL(t.url)},startMultiPageDocument(t){(e=new _t(t.slicenumber,t.delayInit,t.grayscale)).startMultiPageDocument()},addPageToDocument(t){var i=new ImageData(new Uint8ClampedArray(t.simpleImage.buffer),t.simpleImage.width,t.simpleImage.height);e.addPageToDocument(i)},endMultiPageDocument(t){var i=e.endMultiPageDocument();return{data:{buffer:i},transferList:[i]}},createDocumentFromPictures(t){for(var e=t.images,i=new Array(e.length),r=0;r<e.length;r++)i[r]=new ImageData(new Uint8ClampedArray(e[r].buffer),e[r].width,e[r].height);var n=new _t(t.slicenumber,t.delayInit,t.grayscale);n.onprocess=(t=>{postMessage({action:"Process",percent:t})});var s=n.createMultyPageDocument(i);return{data:{buffer:s.buffer},transferList:[s.buffer]}},createDocument(e){t=new pt(e.buffer,e.options)}}}(),Object.assign({},e,{Worker:class{constructor(t=gt()){this.path=t,this.reset()}reset(){this.terminate(),this.worker=new Worker(this.path),this.worker.onmessage=(t=>this.messageHandler(t)),this.worker.onerror=(t=>this.errorHandler(t)),this.promiseCallbacks=null,this.currentPromise=null,this.promiseMap=new Map,this.isWorking=!1,this.commandCounter=0,this.currentCommandId=null,this.hyperCallbacks={},this.hyperCallbackCounter=0}registerHyperCallback(t){const e=this.hyperCallbackCounter++;return this.hyperCallbacks[e]=t,{hyperCallback:!0,id:e}}unregisterHyperCallback(t){delete this.hyperCallbacks[t]}terminate(){this.worker&&this.worker.terminate()}get doc(){return mt.instance(this)}errorHandler(t){console.error("DjVu.js Worker error!",t)}cancelTask(t){this.promiseMap.delete(t)||this.currentPromise===t&&this.dropCurrentTask()}dropCurrentTask(){this.currentPromise=null,this.promiseCallbacks=null,this.currentCommandId=null}emptyTaskQueue(){this.promiseMap.clear()}cancelAllTasks(){this.emptyTaskQueue(),this.dropCurrentTask()}createNewPromise(t,e){var i,r=new Promise((t,e)=>{i={resolve:t,reject:e}});return this.promiseMap.set(r,{callbacks:i,commandObj:t,transferList:e}),this.runNextTask(),r}prepareCommandObject(t){if(!(t.data instanceof Array))return t;const e=[];for(const{args:i}of t.data)for(const t of i)for(let i=0;i<t.length;i++)if("function"==typeof t[i]){const r=this.registerHyperCallback(t[i]);t[i]=r,e.push(r.id)}return e.length&&(t.sendBackData={...t.sendBackData,hyperCallbackIds:e}),t}runNextTask(){if(!this.isWorking){var t=this.promiseMap.entries().next().value;if(t){const[e,{callbacks:i,commandObj:r,transferList:n}]=t;this.promiseCallbacks=i,this.currentPromise=e,this.currentCommandId=this.commandCounter++,r.sendBackData={commandId:this.currentCommandId},this.worker.postMessage(this.prepareCommandObject(r),n),this.isWorking=!0,this.promiseMap.delete(e)}else this.dropCurrentTask()}}isTaskInProcess(t){return this.currentPromise===t}isTaskInQueue(t){return this.promiseMap.has(t)||this.isTaskInProcess(t)}processAction(t){switch(t.action){case"Process":this.onprocess&&this.onprocess(t.percent);break;case"hyperCallback":this.hyperCallbacks[t.id]&&this.hyperCallbacks[t.id](...t.args)}}messageHandler({data:t}){if(t.action)return this.processAction(t);this.isWorking=!1;const e=this.promiseCallbacks;if((t.sendBackData&&t.sendBackData.commandId)!==this.currentCommandId&&null!==this.currentCommandId)return void("unhandledrejection"===t||"error"===t?(console.warn("DjVu.js: "+t+" occurred in the worker!"),this.runNextTask()):console.warn("DjVu.js: Something strange came from the worker.",t));if(this.runNextTask(),!e)return;const{resolve:i,reject:r}=e;switch(t.command){case"Error":r(t.error);break;case"createDocument":case"startMultiPageDocument":case"addPageToDocument":i();break;case"createDocumentFromPictures":case"endMultiPageDocument":i(t.buffer);break;case"run":i(t.result?t.result.length&&t.result.map?t.result.map(t=>this.restoreValueAfterTransfer(t)):this.restoreValueAfterTransfer(t.result):t.result);break;default:console.error("Unexpected message from DjVuWorker: ",t)}t.sendBackData&&t.sendBackData.hyperCallbackIds&&t.sendBackData.hyperCallbackIds.forEach(t=>this.unregisterHyperCallback(t))}restoreValueAfterTransfer(t){return t&&t.width&&t.height&&t.buffer?new ImageData(new Uint8ClampedArray(t.buffer),t.width,t.height):t}run(...t){const e=t.map(t=>t._);return this.createNewPromise({command:"run",data:e})}revokeObjectURL(t){this.worker.postMessage({action:this.revokeObjectURL.name,url:t})}startMultiPageDocument(t,e,i){return this.createNewPromise({command:"startMultiPageDocument",slicenumber:t,delayInit:e,grayscale:i})}addPageToDocument(t){var e={buffer:t.data.buffer,width:t.width,height:t.height};return this.createNewPromise({command:"addPageToDocument",simpleImage:e},[e.buffer])}endMultiPageDocument(){return this.createNewPromise({command:"endMultiPageDocument"})}createDocument(t,e){return this.createNewPromise({command:"createDocument",buffer:t,options:e},[t])}createDocumentFromPictures(t,e,i,r){for(var n=new Array(t.length),s=new Array(t.length),a=0;a<t.length;a++)n[a]={buffer:t[a].data.buffer,width:t[a].width,height:t[a].height},s[a]=t[a].data.buffer;return this.createNewPromise({command:"createDocumentFromPictures",images:n,slicenumber:e,delayInit:i,grayscale:r},s)}},Document:pt,ErrorCodes:k})}return Object.assign(t(),{DjVuScript:t})}();